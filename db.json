{"meta":{"version":1,"warehouse":"5.0.1"},"models":{"Asset":[{"_id":"themes\\fluid\\source\\css\\gitalk.css","path":"css/gitalk.css","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\css\\highlight-dark.styl","path":"css/highlight-dark.styl","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\css\\highlight.styl","path":"css/highlight.styl","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\css\\main.styl","path":"css/main.styl","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\img\\avatar.png","path":"img/avatar.png","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\img\\default.png","path":"img/default.png","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\img\\fluid.png","path":"img/fluid.png","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\img\\loading.gif","path":"img/loading.gif","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\img\\police_beian.png","path":"img/police_beian.png","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\js\\boot.js","path":"js/boot.js","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\js\\color-schema.js","path":"js/color-schema.js","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\js\\events.js","path":"js/events.js","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\js\\img-lazyload.js","path":"js/img-lazyload.js","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\js\\leancloud.js","path":"js/leancloud.js","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\js\\local-search.js","path":"js/local-search.js","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\js\\plugins.js","path":"js/plugins.js","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\js\\utils.js","path":"js/utils.js","modified":0,"renderable":1},{"_id":"themes\\fluid\\source\\xml\\local-search.xml","path":"xml/local-search.xml","modified":0,"renderable":1},{"_id":"source\\resource\\openvpn.sh","path":"resource/openvpn.sh","modified":0,"renderable":0},{"_id":"source\\resource\\安卓逆向｜高版本安卓（7.0+）用 Fiddler 无法抓到 HTTPS 包问题解决方案刚开始学习安卓逆向的小伙伴肯定都 - 掘金.html","path":"resource/安卓逆向｜高版本安卓（7.0+）用 Fiddler 无法抓到 HTTPS 包问题解决方案刚开始学习安卓逆向的小伙伴肯定都 - 掘金.html","modified":0,"renderable":0},{"_id":"source\\resource\\mihomo-linux-amd64-v1.18.6.deb","path":"resource/mihomo-linux-amd64-v1.18.6.deb","modified":1,"renderable":0}],"Cache":[{"_id":"source\\about\\index.md","hash":"3577e59d048ecdfa83f9d1b09a14ea50be1d74bf","modified":1719471059998},{"_id":"source\\tags\\index.md","hash":"b3200194dcaa3b5da90c0a8bb6ae23d51baa9b9d","modified":1739859753979},{"_id":"source\\_posts\\linux\\github-将远程仓库更新到自己的仓库中.md","hash":"3766afd6630d4305a15e3aefa8f8e9109df8a58b","modified":1739860260556},{"_id":"source\\_posts\\java\\Application-toolkit-trace-cross-thread.md","hash":"2fdc545353b40c9aab63da97e53ca2e22b5f38df","modified":1739860260542},{"_id":"source\\_posts\\linux\\docker修改应用为自动启动.md","hash":"7ceb9b6af02d29dd7e8229e846ec65d22eb09f21","modified":1739860260549},{"_id":"source\\categories\\index.md","hash":"68b2a0f13693c21cebe78abcef95bd75f8bd96c8","modified":1739859597546},{"_id":"source\\_posts\\linux\\linux下实现钉钉告警.md","hash":"02a39f163bbb1ec9be76556c7f37160aa5813039","modified":1739860260569},{"_id":"source\\_posts\\linux\\linux下通过端口找到进程.md","hash":"be6e54a6ee19174844428a0c844af67b77dfd106","modified":1739860260562},{"_id":"source\\_posts\\linux\\nginx配置上传文件大小.md","hash":"1c8fb6a8d2e36d7595312505e768f8fb6fdf2f40","modified":1739860152455},{"_id":"source\\_posts\\linux\\openvpn-部署脚本.md","hash":"18d714937de1cf37d2ed55c1534bc5eef75f7887","modified":1740216991520},{"_id":"source\\_posts\\linux\\openvpn中使用client1访问xxx域名时，走client2的网络流量来访问.md","hash":"8490a9048f7220859f595218be6c6298377c83d2","modified":1739860121773},{"_id":"source\\_posts\\linux\\tcp6-如何-改成tcp4.md","hash":"186c75e01df9906083f376c59a25ddca562958ef","modified":1739860080123},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容.md","hash":"7da506ff5879263c882a4de74e177e1a942bdc88","modified":1739860007395},{"_id":"source\\_posts\\linux\\在linux上使用代理.md","hash":"4e35f5b10e669ffce850c3f579ba47d248e5e4d6","modified":1740217194462},{"_id":"source\\_posts\\linux\\对linux磁盘进行无损扩容.md","hash":"6442714735bf0d19a4bfcdffe1031bc00767db89","modified":1739859913114},{"_id":"source\\_posts\\redis\\解读redis分布式锁核心逻辑.md","hash":"b9040ed1a8fe2dca4e9e49ef235c0ba9650a32e2","modified":1739859880765},{"_id":"source\\_posts\\mysql\\select-for-update用法的好处.md","hash":"41b930e730fab5fe47160c767eb428a11a16aa22","modified":1739860110279},{"_id":"source\\_posts\\spring-boot\\spring-state-machine.md","hash":"3b570f14fe6aa4b11143e8c2202eb94f40662690","modified":1739860080116},{"_id":"source\\_posts\\交易\\交易下单时金额变化.md","hash":"a8c2f0177708c73940d89b54e265efb188c6fcde","modified":1739860053022},{"_id":"source\\_posts\\分享\\学习it网站推荐.md","hash":"e7261ce540646cc0d21028f9f37ef729676b4d2b","modified":1739859933700},{"_id":"source\\_posts\\计算机考试\\设信道带宽为16kHz-信噪比为30dB-则该信道的信道容量大约为.md","hash":"f7b08d6b83d7a59e8f2870369b55cad640c065d1","modified":1739859880777},{"_id":"source\\_posts\\黑客\\亿赛通电子文档安全管理系统XStream反序列化漏洞任意文件上传利用.md","hash":"e27d1b450cfe0c33a51d90520b850426bdab97bc","modified":1739860028573},{"_id":"source\\_posts\\spring-boot\\使用切面或拦截器打印异常日志.md","hash":"c6553d5557c2d035a4e7af381ea373db94682a0c","modified":1739860007387},{"_id":"source\\_posts\\linux\\openvpn-部署脚本\\openvpn.sh","hash":"87de7e0b919a17c8192e6f57c2ce55f23f216714","modified":1723017349544},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200410.png","hash":"f33b4b69c8133bb6f7522812a7f594ff854c9ce3","modified":1722945851808},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806195901.png","hash":"73207df7ab09af55aee8c66a9f9a9816c5f0420e","modified":1722945546325},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200518.png","hash":"6e0ab0e5b70c7856073043ae78573bf39d993af3","modified":1722945920307},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_-m-m1AZh7M.png","hash":"06326b2f927af11f2f6b92c74a8c0a927dcd1c77","modified":1719370387878},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_RtiUPlWbme.png","hash":"0facd847ec0640c285287074d407aa7321a6841a","modified":1719370387919},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_bUw4GOE3i3.png","hash":"971882befb7ce49cdc0b9b35141c78f28f1b57a5","modified":1719370387965},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_qBL4LWSs2U.png","hash":"8cb6d4fc5c472da02a61a45a2effc3e70d890f1d","modified":1719370387981},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_tMLd_Cap6a.png","hash":"ef3b3bf0189dd4e5fc0b0e0fcdde2d5d7f38d0b3","modified":1719370387998},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200853.png","hash":"934df7f58206364d1129777a1e317f357e0b4056","modified":1722946134988},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_PEAqPgamQe.png","hash":"251aee9da55d0cf769bc29e54fbf659c06b1051c","modified":1719370387896},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_zZOb0Uu1MN.png","hash":"8872b7055947069ca0a107a046adb3e21e675d33","modified":1719370388013},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\img.png","hash":"f365826c725e6f50d07f8cb29615e8d4a259d58c","modified":1722946018310},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200831.png","hash":"c754552bfa50ed9de26bcf12bb37a75ca139626d","modified":1722946114203},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200924.png","hash":"262fe8b58283ec1070ba000ff1732e04b028a346","modified":1722946166462},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200913.png","hash":"60bceb6c601ccdd49ad3b4c679511a9b16b30aea","modified":1722946155289},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200751.png","hash":"3e549a4f07a3b94277edc03d6d04ae7ae673d6da","modified":1722946085151},{"_id":"themes\\fluid\\source\\css\\_pages\\_tag\\tag.styl","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1719284523549},{"_id":"themes\\fluid\\.editorconfig","hash":"33218fbd623feb43edf5f99f15965392cecc44a6","modified":1719284522472},{"_id":"themes\\fluid\\.eslintrc","hash":"4bc2b19ce2b8c4d242f97d4ccf2d741e68ab0097","modified":1719284522480},{"_id":"themes\\fluid\\.gitattributes","hash":"a54f902957d49356376b59287b894b1a3d7a003f","modified":1719284522486},{"_id":"themes\\fluid\\.gitignore","hash":"ae3bfcb89777657c5dfb5169d91445dcb0e5ab98","modified":1719284522492},{"_id":"themes\\fluid\\LICENSE","hash":"26f9356fd6e84b5a88df6d9014378f41b65ba209","modified":1719284522497},{"_id":"themes\\fluid\\_config.yml","hash":"033bbe4a3c26784171f1072988b461bf0d8b2717","modified":1739870379412},{"_id":"themes\\fluid\\package.json","hash":"c640b57695b7b6002399711f1a7708b0f6c05b84","modified":1719284522522},{"_id":"themes\\fluid\\README.md","hash":"ff9b0e1fb9dba665af2f1e4a577f8cb9e840464b","modified":1719368853803},{"_id":"themes\\fluid\\languages\\de.yml","hash":"0e7d455d9e004ff15d8924b7a0c35cea25ee5b1d","modified":1719284522603},{"_id":"themes\\fluid\\languages\\en.yml","hash":"cb11b39f44ea069652c9647179606b6cecc98d50","modified":1719284522611},{"_id":"themes\\fluid\\languages\\eo.yml","hash":"a556251cc50a5680578c03f1efbf252b1f4ab860","modified":1719284522617},{"_id":"themes\\fluid\\languages\\es.yml","hash":"7112594259c88c04714be152af7fd377687dad40","modified":1719284522624},{"_id":"themes\\fluid\\languages\\ja.yml","hash":"3dd6d20f8d26585a7c154a8e59fe8d5d902f4c6a","modified":1719284522630},{"_id":"themes\\fluid\\languages\\ru.yml","hash":"7dc78f22696649a4c68dc65a9b52d9a992fa82a0","modified":1719284522637},{"_id":"themes\\fluid\\languages\\zh-CN.yml","hash":"2253e1bc61694b3bdc5e434ea2660d13d941b50e","modified":1719284522644},{"_id":"themes\\fluid\\languages\\zh-HK.yml","hash":"80ed400a7adaa92ea54fc7f5d534c9af795bed00","modified":1719284522651},{"_id":"themes\\fluid\\languages\\zh-TW.yml","hash":"596d031dff3826ae8e4ffc8931fff28977b73247","modified":1719284522656},{"_id":"themes\\fluid\\layout\\404.ejs","hash":"b84d575c7b7f778b4cb64e89ad3d0aed4a896820","modified":1719284522668},{"_id":"themes\\fluid\\layout\\about.ejs","hash":"163bee643e6a38912d3ae70923c83c48d57222e7","modified":1719284522675},{"_id":"themes\\fluid\\layout\\archive.ejs","hash":"7c1f44005849791feae4abaa10fae4cb983d3277","modified":1719284522681},{"_id":"themes\\fluid\\layout\\categories.ejs","hash":"13859726c27b6c79b5876ec174176d0f9c1ee164","modified":1719284522688},{"_id":"themes\\fluid\\layout\\category.ejs","hash":"f099161b738a16a32253f42085b5444f902018ed","modified":1719284522695},{"_id":"themes\\fluid\\layout\\index.ejs","hash":"33c3317cdcee062789de2336dd8d0cc7f86d3650","modified":1719284522700},{"_id":"themes\\fluid\\layout\\layout.ejs","hash":"7e0023474128fbe4d68c467704c41f1712432415","modified":1719284522706},{"_id":"themes\\fluid\\layout\\links.ejs","hash":"1cac32ec4579aaf7b9fa39d317497331d4c5e1dd","modified":1719284522712},{"_id":"themes\\fluid\\layout\\page.ejs","hash":"ed5007a3feb8f14d3d2843271bfb298eb0c56219","modified":1719284522718},{"_id":"themes\\fluid\\layout\\post.ejs","hash":"9bf0d357a607a282f3b9cb04525a4df0cc2a8b76","modified":1719284522724},{"_id":"themes\\fluid\\layout\\tag.ejs","hash":"9d686364c4d16a1a9219471623af452035c5b966","modified":1719284522728},{"_id":"themes\\fluid\\layout\\tags.ejs","hash":"1d06af34b6cf1d8a20d2eb565e309326ceba309f","modified":1719284522734},{"_id":"themes\\fluid\\.github\\ISSUE_TEMPLATE\\bug_report.md","hash":"554c0d0e086a0784d83ee71c83f8bceeb60aecc8","modified":1719284522536},{"_id":"themes\\fluid\\.github\\ISSUE_TEMPLATE\\feature_request_zh.md","hash":"ed08574b196447376dd74411cca664ac9227a5d4","modified":1719284522556},{"_id":"themes\\fluid\\.github\\ISSUE_TEMPLATE\\feature_request.md","hash":"c134dd57ffd269b93402ccfffe7dbe0f0b583bec","modified":1719284522550},{"_id":"themes\\fluid\\.github\\ISSUE_TEMPLATE\\question.md","hash":"ab5eab9e3ff889c4ba7fd82846e7f5b7ae15bebc","modified":1719284522562},{"_id":"themes\\fluid\\.github\\ISSUE_TEMPLATE\\bug_report_zh.md","hash":"c8b0d49c49e3c88872fd3b37909345ff5b2b6aa0","modified":1719284522544},{"_id":"themes\\fluid\\.github\\ISSUE_TEMPLATE\\question_zh.md","hash":"fff07ce0472afc368d388637cb9d438195da9b5b","modified":1719284522569},{"_id":"themes\\fluid\\.github\\workflows\\cr.yaml","hash":"19a8a00f5ba9607d82265572fe1202b64a8b0822","modified":1719284522577},{"_id":"themes\\fluid\\.github\\workflows\\limit.yaml","hash":"f8bd2edeb4424ee7a055b31583445d5d5dff91a4","modified":1719284522586},{"_id":"themes\\fluid\\.github\\workflows\\publish.yaml","hash":"6f02e6440d88629229556e3fd47d0280fe2240db","modified":1719284522594},{"_id":"themes\\fluid\\layout\\_partials\\archive-list.ejs","hash":"7520fbf91f762207c2ab06b2c293235cd5b23905","modified":1719284522742},{"_id":"themes\\fluid\\layout\\_partials\\category-chains.ejs","hash":"18309584aab83bc4deb20723ebad832149dd2e24","modified":1719284522748},{"_id":"themes\\fluid\\layout\\_partials\\category-list.ejs","hash":"f8d2f1907450e61968e6d54443e9be8138196a77","modified":1719284522754},{"_id":"themes\\fluid\\layout\\_partials\\comments.ejs","hash":"d707c47b2638c94e489bc43d4cfd098b7c58447f","modified":1719284522761},{"_id":"themes\\fluid\\layout\\_partials\\css.ejs","hash":"85f6e051550907681ab4ed2e268ac8f6e9ebf931","modified":1719284522768},{"_id":"themes\\fluid\\layout\\_partials\\footer.ejs","hash":"10ccfb8eef4e16182183c9a3e175c90d5b6397d3","modified":1719284522775},{"_id":"themes\\fluid\\layout\\_partials\\head.ejs","hash":"7b7b1d098726e86687a15fe3d520d178577ffcae","modified":1719284522782},{"_id":"themes\\fluid\\layout\\_partials\\header.ejs","hash":"0d5e397d30051e5fbabe7b47cfd1f1e6a5820af1","modified":1719284522787},{"_id":"themes\\fluid\\layout\\_partials\\markdown-plugins.ejs","hash":"fc4bdf7de0cf1a66d0e5e4fba1b31d6f7ed49468","modified":1719284522793},{"_id":"themes\\fluid\\layout\\_partials\\paginator.ejs","hash":"0f38a2c238169edcb63fc46c23bfc529ff3859b7","modified":1719284522799},{"_id":"themes\\fluid\\layout\\_partials\\scripts.ejs","hash":"da5810785105e5075861593c7ac22c7aa9665a72","modified":1719284522804},{"_id":"themes\\fluid\\layout\\_partials\\search.ejs","hash":"70e1c929e084ca8a2648cedabf29b372511ea2b8","modified":1719284522810},{"_id":"themes\\fluid\\scripts\\events\\index.js","hash":"79de5a379b28cad759a49048351c7f6b8915bd7d","modified":1719284523000},{"_id":"themes\\fluid\\scripts\\filters\\default-injects.js","hash":"b2013ae8e189cd07ebc8a2ff48a78e153345210f","modified":1719284523050},{"_id":"themes\\fluid\\scripts\\filters\\locals.js","hash":"58d0fec976f6b1d35e7ea03edc45414088acf05c","modified":1719284523055},{"_id":"themes\\fluid\\scripts\\filters\\post-filter.js","hash":"82bb06686158ebe160a631c79f156cd4fde35656","modified":1719284523061},{"_id":"themes\\fluid\\scripts\\generators\\index-generator.js","hash":"9159fc22fa84a7b605dd15fe4104f01fe9c71147","modified":1719284523068},{"_id":"themes\\fluid\\scripts\\generators\\local-search.js","hash":"9ac5ddad06e9b0e6015ce531430018182a4bc0fa","modified":1719284523075},{"_id":"themes\\fluid\\scripts\\generators\\pages.js","hash":"d3e75f53c59674d171309e50702954671f31f1a4","modified":1719284523079},{"_id":"themes\\fluid\\scripts\\helpers\\date.js","hash":"9bda6382f61b40a20c24af466fe10c8366ebb74c","modified":1719284523087},{"_id":"themes\\fluid\\scripts\\helpers\\engine.js","hash":"d3a231d106795ce99cb0bc77eb65f9ae44515933","modified":1719284523093},{"_id":"themes\\fluid\\scripts\\helpers\\export-config.js","hash":"8e67b522c47aa250860e3fe2c733f1f958a506c0","modified":1719284523099},{"_id":"themes\\fluid\\scripts\\helpers\\import.js","hash":"ca53e8dbf7d44cfd372cfa79ac60f35a7d5b0076","modified":1719284523105},{"_id":"themes\\fluid\\scripts\\helpers\\injects.js","hash":"1ad2ae6b11bd8806ee7dd6eb7140d8b54a95d613","modified":1719284523111},{"_id":"themes\\fluid\\scripts\\helpers\\page.js","hash":"4607607445233b3029ef20ed5e91de0da0a7f9c5","modified":1719284523116},{"_id":"themes\\fluid\\scripts\\helpers\\scope.js","hash":"d41d9d658fcb54964b388598e996747aadb85b0f","modified":1719284523123},{"_id":"themes\\fluid\\scripts\\helpers\\url.js","hash":"2a6a8288176d0e0f6ec008056bf2745a86e8943e","modified":1719284523128},{"_id":"themes\\fluid\\scripts\\helpers\\utils.js","hash":"966689d7c5e4320008285395fbaa2751f6209be5","modified":1719284523134},{"_id":"themes\\fluid\\scripts\\helpers\\wordcount.js","hash":"4d48c424e47ff9a17a563167ea5f480890267adf","modified":1719284523141},{"_id":"themes\\fluid\\scripts\\tags\\button.js","hash":"3eb43a8cdea0a64576ad6b31b4df6c2bf5698d4c","modified":1719284523149},{"_id":"themes\\fluid\\scripts\\tags\\checkbox.js","hash":"0857aa86db2a711ae5c77218a9e3fa686d0e87b1","modified":1719284523156},{"_id":"themes\\fluid\\scripts\\tags\\fold.js","hash":"73e4fd12ce3e47981479391ed354b7d9d3279f70","modified":1719284523162},{"_id":"themes\\fluid\\scripts\\tags\\group-image.js","hash":"4aeebb797026f1df25646a5d69f7fde79b1bcd26","modified":1719284523168},{"_id":"themes\\fluid\\scripts\\tags\\label.js","hash":"f05a6d32cca79535b22907dc03edb9d3fa2d8176","modified":1719284523174},{"_id":"themes\\fluid\\scripts\\tags\\mermaid.js","hash":"75160561e1ef3603b6d2ad2938464ab1cb77fd38","modified":1719284523180},{"_id":"themes\\fluid\\scripts\\tags\\note.js","hash":"e3b456a079e5dc0032473b516c865b20f83d2c26","modified":1719284523188},{"_id":"themes\\fluid\\scripts\\utils\\compare-versions.js","hash":"dbbc928c914fc2bd242cd66aa0c45971aec13a5d","modified":1719284523197},{"_id":"themes\\fluid\\scripts\\utils\\crypto.js","hash":"ae4ad8a188ef5b3fa6818b01629fc962b3de8551","modified":1719284523203},{"_id":"themes\\fluid\\scripts\\utils\\object.js","hash":"33b57e4decdc5e75c518859f168c8ba80b2c665b","modified":1719284523210},{"_id":"themes\\fluid\\scripts\\utils\\url-join.js","hash":"718aab5e7b2059a06b093ca738de420d9afa44ba","modified":1719284523222},{"_id":"themes\\fluid\\scripts\\utils\\resolve.js","hash":"8c4a8b62aa8608f12f1e9046231dff04859dc3e9","modified":1719284523215},{"_id":"themes\\fluid\\source\\css\\gitalk.css","hash":"a57b3cc8e04a0a4a27aefa07facf5b5e7bca0e76","modified":1719284523237},{"_id":"themes\\fluid\\source\\css\\highlight-dark.styl","hash":"45695ef75c31a4aa57324dd408b7e2327a337018","modified":1719284523242},{"_id":"themes\\fluid\\source\\css\\highlight.styl","hash":"a9efc52a646a9e585439c768557e3e3c9e3326dc","modified":1719284523247},{"_id":"themes\\fluid\\source\\css\\main.styl","hash":"855ae5fe229c51afa57f7645f6997a27a705d7e4","modified":1719284523252},{"_id":"themes\\fluid\\source\\img\\fluid.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":1719284523612},{"_id":"themes\\fluid\\source\\img\\loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1719284523621},{"_id":"themes\\fluid\\source\\js\\boot.js","hash":"38bd26c6b7acdafda86dda3560e6a3ca488d3c76","modified":1719284523646},{"_id":"themes\\fluid\\source\\js\\color-schema.js","hash":"c5939d14065d38c86e16d1642e154dde5a23e830","modified":1719284523654},{"_id":"themes\\fluid\\source\\js\\events.js","hash":"5891534506b959a2f559f29e122baa3eb9159d93","modified":1719284523663},{"_id":"themes\\fluid\\source\\js\\img-lazyload.js","hash":"cbdeca434ec4da51f488c821d51b4d23c73294af","modified":1719284523671},{"_id":"themes\\fluid\\source\\js\\leancloud.js","hash":"eff77c7a5c399fcaefda48884980571e15243fc9","modified":1719284523678},{"_id":"themes\\fluid\\source\\js\\local-search.js","hash":"b9945f76f8682f3ec32edfb285b26eb559f7b7e8","modified":1719284523685},{"_id":"themes\\fluid\\source\\js\\plugins.js","hash":"c34916291e392a774ff3e85c55badb83e8661297","modified":1719284523693},{"_id":"themes\\fluid\\source\\js\\utils.js","hash":"b82e7c289a66dfd36064470fd41c0e96fc598b43","modified":1719284523701},{"_id":"themes\\fluid\\source\\xml\\local-search.xml","hash":"8c96ba6a064705602ce28d096fd7dd9069630a55","modified":1719284523730},{"_id":"themes\\fluid\\layout\\_partials\\comments\\changyan.ejs","hash":"c9b2d68ed3d375f1953e7007307d2a3f75ed6249","modified":1719284522818},{"_id":"themes\\fluid\\layout\\_partials\\comments\\cusdis.ejs","hash":"5f9dc012be27040bbe874d0c093c0d53958cc987","modified":1719284522824},{"_id":"themes\\fluid\\layout\\_partials\\comments\\discuss.ejs","hash":"98d065b58ce06b7d18bff3c974e96fa0f34ae03a","modified":1719284522830},{"_id":"themes\\fluid\\layout\\_partials\\comments\\disqus.ejs","hash":"aab4a4d24c55231a37db308ae94414319cecdd9b","modified":1719284522835},{"_id":"themes\\fluid\\layout\\_partials\\comments\\giscus.ejs","hash":"95f8b866b158eff9352c381c243b332a155a5110","modified":1719284522842},{"_id":"themes\\fluid\\layout\\_partials\\comments\\gitalk.ejs","hash":"843bc141a4545eb20d1c92fb63c85d459b4271ec","modified":1719284522847},{"_id":"themes\\fluid\\layout\\_partials\\comments\\livere.ejs","hash":"2264758fed57542a7389c7aa9f00f1aefa17eb87","modified":1719284522852},{"_id":"themes\\fluid\\layout\\_partials\\comments\\remark42.ejs","hash":"d4e9532feeb02aed61bd15eda536b5b631454dac","modified":1719284522858},{"_id":"themes\\fluid\\layout\\_partials\\comments\\twikoo.ejs","hash":"d84bcb5ccd78470a60c067fc914ac0ac67ac8777","modified":1719284522863},{"_id":"themes\\fluid\\layout\\_partials\\comments\\utterances.ejs","hash":"c7ccf7f28308334a6da6f5425b141a24b5eca0e2","modified":1719284522868},{"_id":"themes\\fluid\\layout\\_partials\\comments\\valine.ejs","hash":"19ba937553dddd317f827d682661a1066a7b1f30","modified":1719284522875},{"_id":"themes\\fluid\\layout\\_partials\\comments\\waline.ejs","hash":"12727da7cf3ac83443270f550be4d1c06135b52b","modified":1719284522880},{"_id":"themes\\fluid\\layout\\_partials\\footer\\beian.ejs","hash":"4fb9b5dd3f3e41a586d6af44e5069afe7c81fff2","modified":1719284522889},{"_id":"themes\\fluid\\layout\\_partials\\footer\\statistics.ejs","hash":"454d8dd4c39f9494ebeb03ca0746f5bc122af76a","modified":1719284522893},{"_id":"themes\\fluid\\layout\\_partials\\header\\banner.ejs","hash":"e07757b59e7b89eea213d0e595cb5932f812fd32","modified":1719284522900},{"_id":"themes\\fluid\\layout\\_partials\\header\\navigation.ejs","hash":"37d750428772d7c71ba36ce0c2540780d90fadea","modified":1719284522905},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\analytics.ejs","hash":"4f68c80bd1395e2f6d11e373116e54de11cb62e8","modified":1719284522912},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\anchorjs.ejs","hash":"40181442d3a2b8734783a0ad7caf2d2522e3f2ab","modified":1719284522916},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\fancybox.ejs","hash":"9d1ea2a46b8c8ad8c168594d578f40764818ef13","modified":1719284522929},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\highlight.ejs","hash":"7529dd215b09d3557804333942377b9e20fa554e","modified":1719284522934},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\math.ejs","hash":"dcbf9a381ee76f2f1f75fcbc22c50a502ec85023","modified":1719284522939},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\encrypt.ejs","hash":"0fff24cf5bf99fbe5c56c292e2eac4a89bf29db4","modified":1719284522925},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\code-widget.ejs","hash":"3a505cba37942badf62a56bbb8b605b72af330aa","modified":1719284522921},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\nprogress.ejs","hash":"4c2d39ce816b8a6dcd6b53113c8695f8bd650a23","modified":1719284522952},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\moment.ejs","hash":"4ff3fb1b60ccc95a0af3bbdbd0757fedefc088b5","modified":1719284522947},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\mermaid.ejs","hash":"03ac02762f801970d1c4e73d6ec8d4c503780e50","modified":1719284522943},{"_id":"themes\\fluid\\layout\\_partials\\plugins\\typed.ejs","hash":"f345374885cd6a334f09a11f59c443b5d577c06c","modified":1719284522956},{"_id":"themes\\fluid\\layout\\_partials\\post\\category-bar.ejs","hash":"8772bce97ed297e7a88523f4e939ed6436c22f87","modified":1719284522962},{"_id":"themes\\fluid\\layout\\_partials\\post\\copyright.ejs","hash":"529f3069742b3d338c769ba2d836e7f3c342a09d","modified":1719284522967},{"_id":"themes\\fluid\\layout\\_partials\\post\\meta-top.ejs","hash":"ce6e9f578f4faa45840abddf8f46af3f4b69c177","modified":1719284522975},{"_id":"themes\\fluid\\layout\\_partials\\post\\sidebar-left.ejs","hash":"9992c99b3eb728ad195970e1b84d665f2c8691c4","modified":1719284522980},{"_id":"themes\\fluid\\layout\\_partials\\post\\sidebar-right.ejs","hash":"d5fcc9b60e02f869a29a8c17a16a6028ecc1e6d8","modified":1719284522984},{"_id":"themes\\fluid\\layout\\_partials\\post\\toc.ejs","hash":"635a89060fbf72eeda066fc4bd0a97462f069417","modified":1719284522989},{"_id":"themes\\fluid\\layout\\_partials\\post\\meta-bottom.ejs","hash":"375974ec017696e294dc12469fb0ae257800dc2d","modified":1719284522971},{"_id":"themes\\fluid\\scripts\\events\\lib\\compatible-configs.js","hash":"ef474d1fa5bbafc52619ced0f9dc7eaf2affb363","modified":1719284523009},{"_id":"themes\\fluid\\scripts\\events\\lib\\footnote.js","hash":"c19ac8050b82c3676b0332a56099ccfcc36d9d52","modified":1719284523015},{"_id":"themes\\fluid\\scripts\\events\\lib\\hello.js","hash":"0874d09075432900d711d146e245a500a578498a","modified":1719372022330},{"_id":"themes\\fluid\\scripts\\events\\lib\\injects.js","hash":"5ae4b07204683e54b5a1b74e931702bbce2ac23e","modified":1719284523031},{"_id":"themes\\fluid\\scripts\\events\\lib\\lazyload.js","hash":"9ba0d4bc224e22af8a5a48d6ff13e5a0fcfee2a4","modified":1719284523036},{"_id":"themes\\fluid\\scripts\\events\\lib\\highlight.js","hash":"a5fe1deccb73b5f578797dbb11038efc15f63ce8","modified":1719284523025},{"_id":"themes\\fluid\\scripts\\events\\lib\\merge-configs.js","hash":"7c944c43b2ece5dd84859bd9d1fe955d13427387","modified":1719284523040},{"_id":"themes\\fluid\\source\\css\\_functions\\base.styl","hash":"2e46f3f4e2c9fe34c1ff1c598738fc7349ae8188","modified":1719284523260},{"_id":"themes\\fluid\\source\\css\\_mixins\\base.styl","hash":"542e306ee9494e8a78e44d6d7d409605d94caeb3","modified":1719284523270},{"_id":"themes\\fluid\\source\\css\\_pages\\pages.styl","hash":"b8e887bc7fb3b765a1f8ec9448eff8603a41984f","modified":1719284523278},{"_id":"themes\\fluid\\source\\css\\_variables\\base.styl","hash":"4ed5f0ae105ef4c7dd92eaf652ceda176c38e502","modified":1719284523567},{"_id":"themes\\fluid\\source\\css\\_pages\\_about\\about.styl","hash":"97fe42516ea531fdad771489b68aa8b2a7f6ae46","modified":1719284523286},{"_id":"themes\\fluid\\source\\css\\_pages\\_archive\\archive.styl","hash":"c475e6681546d30350eaed11f23081ecae80c375","modified":1719284523295},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\color-schema.styl","hash":"85492ef64d7e5f70f0f7e46d570bbc911e686d7e","modified":1719284523310},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\keyframes.styl","hash":"94065ea50f5bef7566d184f2422f6ac20866ba22","modified":1719284523323},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\base.styl","hash":"643284c567665f96915f0b64e59934dda315f74d","modified":1719284523304},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\inline.styl","hash":"411a3fa3f924a87e00ff04d18b5c83283b049a4d","modified":1719284523316},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\print.styl","hash":"166afbc596ea4b552bad7290ec372d25ec34db7b","modified":1719284523328},{"_id":"themes\\fluid\\source\\css\\_pages\\_category\\category-bar.styl","hash":"cc6df43fef6bb3efecbfdd8b9e467424a1dea581","modified":1719284523471},{"_id":"themes\\fluid\\source\\css\\_pages\\_category\\category-chain.styl","hash":"0cdf7ef50dfd0669d3b257821384ff31cd81b7c9","modified":1719284523479},{"_id":"themes\\fluid\\source\\css\\_pages\\_index\\index.styl","hash":"25fb6fa4c783b847c632584c49a7e1593cdb2f5d","modified":1719284523496},{"_id":"themes\\fluid\\source\\css\\_pages\\_links\\links.styl","hash":"5c7f2044e3f1da05a3229537c06bd879836f8d6e","modified":1719284523509},{"_id":"themes\\fluid\\source\\css\\_pages\\_category\\category-list.styl","hash":"7edfe1b571ecca7d08f5f4dbcf76f4ffdcfbf0b5","modified":1719284523484},{"_id":"themes\\fluid\\source\\css\\_pages\\_post\\comment.styl","hash":"780f3788e7357bcd3f3262d781cb91bb53976a93","modified":1719284523519},{"_id":"themes\\fluid\\source\\css\\_pages\\_post\\highlight.styl","hash":"4df764d298fe556e501db4afc2b05686fe6ebcfb","modified":1719284523524},{"_id":"themes\\fluid\\source\\css\\_pages\\_post\\markdown.styl","hash":"1e3d3a82721e7c10bcfcecec6d81cf2979039452","modified":1719284523530},{"_id":"themes\\fluid\\source\\css\\_pages\\_post\\post-tag.styl","hash":"c96d36aa8fe20f0c3c1a29ee2473cd8064b10f73","modified":1719284523540},{"_id":"themes\\fluid\\source\\css\\_pages\\_post\\post-page.styl","hash":"cd432a6411ccac7df47e6a300fb1a872cfc763e7","modified":1719284523535},{"_id":"themes\\fluid\\source\\css\\_pages\\_tag\\tags.styl","hash":"65bfc01c76abc927fa1a23bf2422892b0d566c3f","modified":1719284523554},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\anchorjs.styl","hash":"e0cebda4a6f499aff75e71417d88caa7ceb13b94","modified":1719284523339},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\board.styl","hash":"4397037fc3f0033dbe546c33cd9dbdabd8cb1632","modified":1719284523352},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\banner.styl","hash":"7a0bd629bc234fc75e3cc8e3715ffada92f09e73","modified":1719284523345},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\code-widget.styl","hash":"b66ab013f0f37d724a149b85b3c7432afcf460ad","modified":1719284523359},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\copyright.styl","hash":"26f71a9cd60d96bb0cb5bbdf58150b8e524d9707","modified":1719284523365},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\footer.styl","hash":"2caaca71dd1ff63d583099ed817677dd267b457e","modified":1719284523371},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\header.styl","hash":"c4459248c66ea1326feed021179b847ae91d465f","modified":1719284523384},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\footnote.styl","hash":"ae9289cc89649af2042907f8a003303b987f3404","modified":1719284523376},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\modal.styl","hash":"adf6c1e5c8e1fb41c77ce6e2258001df61245aa2","modified":1719284523390},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\noscript.styl","hash":"0cf2f2bb44f456150d428016675d5876a9d2e2aa","modified":1719284523405},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\pagination.styl","hash":"8bb1b68e5f3552cb48c2ffa31edbc53646a8fb4c","modified":1719284523413},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\ngrogress.styl","hash":"5d225357b4a58d46118e6616377168336ed44cb2","modified":1719284523397},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\scroll-btn.styl","hash":"f0e429a27fa8a7658fcbddbb4d4dbe4afa12499a","modified":1719284523430},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\qrcode.styl","hash":"78704a94c0436097abfb0e0a57abeb3429c749b7","modified":1719284523421},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\toc.styl","hash":"9e7452aa2372153f25d7a4675c9d36d281a65d24","modified":1719284523453},{"_id":"themes\\fluid\\source\\css\\_pages\\_base\\_widget\\search.styl","hash":"10f7e91a91e681fb9fe46f9df7707b9ef78707c8","modified":1719284523441},{"_id":"themes\\fluid\\source\\img\\avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":1719284523588},{"_id":"themes\\fluid\\source\\img\\police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1719284523635},{"_id":"themes\\fluid\\source\\img\\default.png","hash":"167a12978d80371cf578c8a2e45c24a2eb25b6fb","modified":1719284523602},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_SOZXE0ImbY.png","hash":"e72edf2eb3099761c51818c99464bbf5d2812395","modified":1719370387945},{"_id":"source\\resource\\安卓逆向｜高版本安卓（7.0+）用 Fiddler 无法抓到 HTTPS 包问题解决方案刚开始学习安卓逆向的小伙伴肯定都 - 掘金.html","hash":"e4702391c782a82dfabaccac4b932539327a5735","modified":1727170637506},{"_id":"source\\_posts\\linux\\在linux上使用代理\\mihomo-linux-amd64-v1.18.6.deb","hash":"bc855430f0b8f7b2637a13f6e8d5e75f39070ab1","modified":1721912142425},{"_id":"public/local-search.xml","hash":"771db5ef868617d2544aa164b55bfef3eb8809ab","modified":1740104588468},{"_id":"public/about/index.html","hash":"c04b18d71803d7e9bce5bf85a72773d0ffa6d890","modified":1739861933464},{"_id":"public/tags/index.html","hash":"6393020e4da318a254b537f40be5a4ad19162497","modified":1740104588468},{"_id":"public/categories/linux/index.html","hash":"249db4cda9d9eb0fc95ba7cb9c681e48c92c41d7","modified":1740104588468},{"_id":"public/categories/Java/index.html","hash":"6c3ba0a29f4d1ffba60412e49cf17adae8b7af71","modified":1739861933464},{"_id":"public/categories/clash/index.html","hash":"d1efd839c642966c273282b30bd3046f6ed4d077","modified":1739861933464},{"_id":"public/categories/redis/index.html","hash":"b99969db69d6fe7d91e231932cfb23b03116bc58","modified":1739861933464},{"_id":"public/categories/spring-boot/index.html","hash":"59d7c98fc93e23a05fdd19517e0b6f556b687610","modified":1739861933464},{"_id":"public/categories/mysql/index.html","hash":"cd1c62cc1cf5143f3e385409f5031d7d3b1e602e","modified":1740104588468},{"_id":"public/categories/交易/index.html","hash":"e73233d47963d1991f8cfb8f80218fece39c48f5","modified":1739861933464},{"_id":"public/categories/分享/index.html","hash":"73cd0e6680eb2890b855f0af57a4b877649c7e4d","modified":1739861933464},{"_id":"public/categories/index.html","hash":"01e33aa006d66653a64ce5fb9deaa81a848541dd","modified":1740104588468},{"_id":"public/2024/10/22/计算机考试/设信道带宽为16kHz-信噪比为30dB-则该信道的信道容量大约为/index.html","hash":"3dd1185f3131e8cbf6ee3d0160d935aaa515ef5e","modified":1740104588468},{"_id":"public/2024/10/10/linux/openvpn中使用client1访问xxx域名时，走client2的网络流量来访问/index.html","hash":"478c75f30e9635339bab34913c39fa188795eb5f","modified":1740104588468},{"_id":"public/2024/09/29/黑客/亿赛通电子文档安全管理系统XStream反序列化漏洞任意文件上传利用/index.html","hash":"2d83f5dfa3f0e57cc957b28a52219cb1c2790336","modified":1740104588468},{"_id":"public/2024/09/19/spring-boot/spring-state-machine/index.html","hash":"c564db77bfba006009812065d3b2295c0bc1d7e9","modified":1740104588468},{"_id":"public/2024/09/11/java/Application-toolkit-trace-cross-thread/index.html","hash":"5504910c0517ad19970913427d9ef7f6697f98d6","modified":1740104588468},{"_id":"public/2024/09/11/交易/交易下单时金额变化/index.html","hash":"3adc42e1032b53c00eb1270989456e111043ac5e","modified":1740104588468},{"_id":"public/2024/08/13/linux/github-将远程仓库更新到自己的仓库中/index.html","hash":"65d26e8fb227ad897f0d4ccb460054e436fe58f7","modified":1740104588468},{"_id":"public/2024/08/09/linux/linux下通过端口找到进程/index.html","hash":"848c13233396a037683f360bfd0d4fe2deb4b50d","modified":1740104588468},{"_id":"public/2024/08/07/linux/openvpn-部署脚本/index.html","hash":"dddecb2a2cbad983a2ca05f97771f0cad235f959","modified":1740104588468},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/index.html","hash":"213858e41247228e94b423cab7a425535edf05fa","modified":1740104588468},{"_id":"public/2024/08/05/linux/对linux磁盘进行无损扩容/index.html","hash":"3fe92befbc4145fb768960fa10859a3efdbd3c01","modified":1740104588468},{"_id":"public/2024/07/30/redis/解读redis分布式锁核心逻辑/index.html","hash":"8f6d31d68ea3bfbec592e246183a32d4bcc55319","modified":1740104588468},{"_id":"public/2024/07/26/spring-boot/使用切面或拦截器打印异常日志/index.html","hash":"89990d839504927895b12b9968840884f8f934c7","modified":1740104588468},{"_id":"public/2024/07/26/linux/在linux上使用代理/index.html","hash":"fa77c4c4c8a0d0dc784e190985e1a8d63f8abc8d","modified":1740104588468},{"_id":"public/2024/07/25/mysql/select-for-update用法的好处/index.html","hash":"eb111ffb53e32f78d53505d4a7a1a33924a604a0","modified":1740104588468},{"_id":"public/2024/07/25/linux/tcp6-如何-改成tcp4/index.html","hash":"e61e52e784d460cd7a27bcfdc7ff15be2a5eb757","modified":1740104588468},{"_id":"public/2024/07/24/linux/nginx配置上传文件大小/index.html","hash":"6a04133e557fe4e482492d35fc878dd47fe7f5a4","modified":1740104588468},{"_id":"public/2024/07/23/linux/docker修改应用为自动启动/index.html","hash":"48191115518cf6581eae6e918703d4eaac8042db","modified":1740104588468},{"_id":"public/2024/07/23/linux/linux下实现钉钉告警/index.html","hash":"6a7e8cb49520eff61dbaf49c725a5284dfd5af5d","modified":1740104588468},{"_id":"public/2024/06/26/分享/学习it网站推荐/index.html","hash":"4f564b5fc1d217f18cd6c4997ccd1ba8bd8bb373","modified":1740104588468},{"_id":"public/categories/计算机考试/index.html","hash":"daa6939b4a757e4895b52c2a60c5e1ea8e3baf3f","modified":1739861933464},{"_id":"public/categories/黑客/index.html","hash":"05af9303d12fb017f6b961b36846ccce8e2b23c1","modified":1739861933464},{"_id":"public/archives/index.html","hash":"dac2b2b4ab249da527f90b651f8f7da0714a6379","modified":1740104588468},{"_id":"public/archives/page/2/index.html","hash":"aaa932c8e8e171008a9adb3a98389218eb75fcbf","modified":1740104588468},{"_id":"public/archives/2024/index.html","hash":"3779c80173539cf2159b23373abf2ab231a2e077","modified":1740104588468},{"_id":"public/archives/2024/page/2/index.html","hash":"77c5727e0f4bc01ddae97aa433744752742d2c69","modified":1740104588468},{"_id":"public/archives/2024/06/index.html","hash":"9456ff6f4ebfe542ae0a8fd38f99376203544d7f","modified":1740104588468},{"_id":"public/archives/2024/07/index.html","hash":"e4eef7867427e638ad0515358c1bed9592eca690","modified":1740104588468},{"_id":"public/archives/2024/08/index.html","hash":"dd8d0ea102708773f0b0919ffb798e15fe0db9c7","modified":1740104588468},{"_id":"public/archives/2024/09/index.html","hash":"23bfe9834e93a3ae28724618f5b0c3b8d52180bd","modified":1740104588468},{"_id":"public/archives/2024/10/index.html","hash":"c771313c14836f207db2561f09f3d5bd3964ca93","modified":1740104588468},{"_id":"public/tags/docker/index.html","hash":"70f6b45391d51d9f1e7215a713465d07a19c293c","modified":1739861933464},{"_id":"public/tags/并发/index.html","hash":"dc6fdedc6a4db44f50968511c95ac79b8816e1c7","modified":1739861933464},{"_id":"public/tags/git/index.html","hash":"bb2f563e9b72962b7f09538c86725d3ca293f72b","modified":1739861933464},{"_id":"public/tags/报警/index.html","hash":"c4f4486386ee7f0fe9110b2cd8922da46630b345","modified":1739861933464},{"_id":"public/tags/查找进程/index.html","hash":"6d18d41db8288b4d3d767dc2b8949ff6c79efd57","modified":1739861933464},{"_id":"public/tags/openvpn/index.html","hash":"f3490d36caa68862b901a7bbbd0d63fb7164b0aa","modified":1739861933464},{"_id":"public/tags/网络/index.html","hash":"959324a2d30742afdb850241e91058dfdc8b8b16","modified":1739861933464},{"_id":"public/tags/nginx/index.html","hash":"9ae278ad67c43cffdf51af660781000863adb04b","modified":1739861933464},{"_id":"public/tags/扩容磁盘/index.html","hash":"cba20b9b3b1c450d51afa28e9e0d45710995b82e","modified":1739861933464},{"_id":"public/tags/翻墙/index.html","hash":"38549f27b5ee1331c5757f618014b21adda32b45","modified":1739861933464},{"_id":"public/tags/lua表达式/index.html","hash":"3b2bbfa4bb3e3dca5148f2c1ada4c10e0e3e0af2","modified":1739861933464},{"_id":"public/tags/状态机/index.html","hash":"baa6ed1bb9720839b77d800536782aff4e562dc5","modified":1739861933464},{"_id":"public/tags/打印异常日志/index.html","hash":"28439b8a70178e85598de9068df1379fc4dd5d82","modified":1739861933464},{"_id":"public/tags/事务/index.html","hash":"32297ce4b1800254899d510ba34b1cf2765757f4","modified":1739861933464},{"_id":"public/tags/账户资金/index.html","hash":"8dd262e40bfa06e56413f77856cd82459cd0fb43","modified":1739861933464},{"_id":"public/tags/网站资源/index.html","hash":"28b5e194955f573a5c914614df2620e226a4f474","modified":1739861933464},{"_id":"public/tags/自学公式/index.html","hash":"7cbb44ededc0904c372a18ebf001414cc952dba3","modified":1739861933464},{"_id":"public/tags/漏洞/index.html","hash":"0af6444de9d449ad76a34355c67515886a77f6ee","modified":1739861933464},{"_id":"public/404.html","hash":"1fb6f2c76bae1a0c94d7f939f7d0f6c5b2968712","modified":1739861933464},{"_id":"public/links/index.html","hash":"a5483b8dffa6cc442d156c9ec31150fbf4abd3a3","modified":1739861933464},{"_id":"public/index.html","hash":"34f4061a9ac2006331db6e834229ae0a54ad6a85","modified":1740104588468},{"_id":"public/page/2/index.html","hash":"1af9c3f47b7bac94fc848667accfed19719c9ed6","modified":1740104588468},{"_id":"public/img/police_beian.png","hash":"90efded6baa2dde599a9d6b1387973e8e64923ea","modified":1739861933464},{"_id":"public/img/loading.gif","hash":"2d2fc0f947940f98c21afafef39ecf226a2e8d55","modified":1739861933464},{"_id":"public/img/fluid.png","hash":"64b215db2cb3af98fe639e94537cb5209f959c78","modified":1739861933464},{"_id":"public/img/avatar.png","hash":"fe739a158cc128f70f780eb5fa96f388b81d478f","modified":1739861933464},{"_id":"public/xml/local-search.xml","hash":"8c96ba6a064705602ce28d096fd7dd9069630a55","modified":1739861933464},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/微信截图_20240806200410.png","hash":"f33b4b69c8133bb6f7522812a7f594ff854c9ce3","modified":1739861933464},{"_id":"public/2024/08/07/linux/openvpn-部署脚本/openvpn.sh","hash":"87de7e0b919a17c8192e6f57c2ce55f23f216714","modified":1739861933464},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/微信截图_20240806195901.png","hash":"73207df7ab09af55aee8c66a9f9a9816c5f0420e","modified":1739861933464},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/微信截图_20240806200518.png","hash":"6e0ab0e5b70c7856073043ae78573bf39d993af3","modified":1739861933464},{"_id":"public/2024/06/26/分享/学习it网站推荐/image_-m-m1AZh7M.png","hash":"06326b2f927af11f2f6b92c74a8c0a927dcd1c77","modified":1739861933464},{"_id":"public/2024/06/26/分享/学习it网站推荐/image_bUw4GOE3i3.png","hash":"971882befb7ce49cdc0b9b35141c78f28f1b57a5","modified":1739861933464},{"_id":"public/2024/06/26/分享/学习it网站推荐/image_RtiUPlWbme.png","hash":"0facd847ec0640c285287074d407aa7321a6841a","modified":1739861933464},{"_id":"public/2024/06/26/分享/学习it网站推荐/image_qBL4LWSs2U.png","hash":"8cb6d4fc5c472da02a61a45a2effc3e70d890f1d","modified":1739861933464},{"_id":"public/2024/06/26/分享/学习it网站推荐/image_tMLd_Cap6a.png","hash":"ef3b3bf0189dd4e5fc0b0e0fcdde2d5d7f38d0b3","modified":1739861933464},{"_id":"public/css/gitalk.css","hash":"a57b3cc8e04a0a4a27aefa07facf5b5e7bca0e76","modified":1739861933464},{"_id":"public/css/highlight.css","hash":"04d4ddbb5e1d1007447c2fe293ee05aae9b9563e","modified":1739861933464},{"_id":"public/js/boot.js","hash":"38bd26c6b7acdafda86dda3560e6a3ca488d3c76","modified":1739861933464},{"_id":"public/js/events.js","hash":"5891534506b959a2f559f29e122baa3eb9159d93","modified":1739861933464},{"_id":"public/css/highlight-dark.css","hash":"902294bada4323c0f51502d67cba8c3a0298952f","modified":1739861933464},{"_id":"public/js/img-lazyload.js","hash":"cbdeca434ec4da51f488c821d51b4d23c73294af","modified":1739861933464},{"_id":"public/js/leancloud.js","hash":"eff77c7a5c399fcaefda48884980571e15243fc9","modified":1739861933464},{"_id":"public/js/color-schema.js","hash":"c5939d14065d38c86e16d1642e154dde5a23e830","modified":1739861933464},{"_id":"public/js/local-search.js","hash":"b9945f76f8682f3ec32edfb285b26eb559f7b7e8","modified":1739861933464},{"_id":"public/js/plugins.js","hash":"c34916291e392a774ff3e85c55badb83e8661297","modified":1739861933464},{"_id":"public/js/utils.js","hash":"b82e7c289a66dfd36064470fd41c0e96fc598b43","modified":1739861933464},{"_id":"public/css/main.css","hash":"7d7590cfe0261084ad357d5f51cb14d13db826d8","modified":1739861933464},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/微信截图_20240806200853.png","hash":"934df7f58206364d1129777a1e317f357e0b4056","modified":1739861933464},{"_id":"public/2024/06/26/分享/学习it网站推荐/image_PEAqPgamQe.png","hash":"251aee9da55d0cf769bc29e54fbf659c06b1051c","modified":1739861933464},{"_id":"public/2024/06/26/分享/学习it网站推荐/image_zZOb0Uu1MN.png","hash":"8872b7055947069ca0a107a046adb3e21e675d33","modified":1739861933464},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/img.png","hash":"f365826c725e6f50d07f8cb29615e8d4a259d58c","modified":1739861933464},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/微信截图_20240806200831.png","hash":"c754552bfa50ed9de26bcf12bb37a75ca139626d","modified":1739861933464},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/微信截图_20240806200924.png","hash":"262fe8b58283ec1070ba000ff1732e04b028a346","modified":1739861933464},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/微信截图_20240806200913.png","hash":"60bceb6c601ccdd49ad3b4c679511a9b16b30aea","modified":1739861933464},{"_id":"public/2024/08/06/linux/使用图形化对linux磁盘进行扩容/微信截图_20240806200751.png","hash":"3e549a4f07a3b94277edc03d6d04ae7ae673d6da","modified":1739861933464},{"_id":"public/img/default.png","hash":"167a12978d80371cf578c8a2e45c24a2eb25b6fb","modified":1739861933464},{"_id":"public/2024/06/26/分享/学习it网站推荐/image_SOZXE0ImbY.png","hash":"e72edf2eb3099761c51818c99464bbf5d2812395","modified":1739861933464},{"_id":"public/resource/安卓逆向｜高版本安卓（7.0+）用 Fiddler 无法抓到 HTTPS 包问题解决方案刚开始学习安卓逆向的小伙伴肯定都 - 掘金.html","hash":"e4702391c782a82dfabaccac4b932539327a5735","modified":1739861933464},{"_id":"public/2024/07/26/linux/在linux上使用代理/mihomo-linux-amd64-v1.18.6.deb","hash":"bc855430f0b8f7b2637a13f6e8d5e75f39070ab1","modified":1739861933464},{"_id":"source\\_posts\\docker\\docker常用命令.md","hash":"264d1ff13084b51f5c92441d072b11ea276132ef","modified":1740036442473},{"_id":"source\\_posts\\mysql\\mysql-数据备份脚本.md","hash":"0c8cce143bb9684f7d34b83596edb6038db8920c","modified":1740036442479},{"_id":"source\\_posts\\linux\\linux-常用命令.md","hash":"f988529a9470350da50409fadd820a19cb5fb56f","modified":1740045044189},{"_id":"public/archives/page/3/index.html","hash":"cd3e330c0c571f5d7f8d55f58e8750baa66fe645","modified":1740104588468},{"_id":"public/archives/2025/index.html","hash":"79c44ea5fef5a86445158ba58f51315b6d0d61d9","modified":1740104588468},{"_id":"public/archives/2025/02/index.html","hash":"36e02b0da85ba42e471fc33a57ac0dd9f2043edb","modified":1740104588468},{"_id":"public/page/3/index.html","hash":"bc44263215940b98a2fb009cff5a8462e4eaab50","modified":1740104588468},{"_id":"public/tags/命令/index.html","hash":"2c8ec8f46e156be0a602e358d6ac0dfd8c67eb8f","modified":1740104588468},{"_id":"public/tags/备份/index.html","hash":"4f0ad4ef65f93fc77c638826f2afe74afa022037","modified":1740104588468},{"_id":"public/tags/常用命令/index.html","hash":"9d166fd2e1048308afbd6f8bd798d689cb43f7c7","modified":1740104588468},{"_id":"public/categories/linux/page/2/index.html","hash":"c11918c6d804aa35aa877ba581fa933accd6a8a0","modified":1740104588468},{"_id":"public/2025/02/20/linux/linux-常用命令/index.html","hash":"3d3c6741f70c46153638c77c829aeb673e66bde6","modified":1740104588468},{"_id":"public/2025/02/20/docker/docker常用命令/index.html","hash":"19548ddcccfbb7c9410e5d24e0c6e7112d2e445e","modified":1740104588468},{"_id":"public/2025/02/19/mysql/mysql-数据备份脚本/index.html","hash":"60bbb2b884b66e3e6adf6feba644e2f2d402f112","modified":1740104588468},{"_id":"public/categories/docker/index.html","hash":"70ff6e25120e33f78581043ca028a0c188821547","modified":1740104588468},{"_id":"source\\resource\\openvpn.sh","hash":"87de7e0b919a17c8192e6f57c2ce55f23f216714","modified":1723017349544},{"_id":"source\\_posts\\resource\\openvpn.sh","hash":"87de7e0b919a17c8192e6f57c2ce55f23f216714","modified":1723017349544},{"_id":"source\\_posts\\resource\\安卓逆向｜高版本安卓（7.0+）用 Fiddler 无法抓到 HTTPS 包问题解决方案刚开始学习安卓逆向的小伙伴肯定都 - 掘金.html","hash":"e4702391c782a82dfabaccac4b932539327a5735","modified":1727170637506},{"_id":"source\\resource\\mihomo-linux-amd64-v1.18.6.deb","hash":"bc855430f0b8f7b2637a13f6e8d5e75f39070ab1","modified":1721912142425}],"Category":[{"name":"linux","_id":"cm7a4vg3e00048gjd06hy2h43"},{"name":"Java","_id":"cm7a4vg3h000a8gjd3voefj9i"},{"name":"clash","_id":"cm7a4vg3m000x8gjd72fv3rf5"},{"name":"redis","_id":"cm7a4vg3o00158gjd63c26pva"},{"name":"spring-boot","_id":"cm7a4vg3p001c8gjd06e2bmte"},{"name":"mysql","_id":"cm7a4vg3q001j8gjdhjcm7m4z"},{"name":"交易","_id":"cm7a4vg3u00258gjd73fqfv6b"},{"name":"分享","_id":"cm7a4vg3v00298gjd4qfxd6s7"},{"name":"计算机考试","_id":"cm7a4vg3v002d8gjd0nuw8psq"},{"name":"黑客","_id":"cm7a4vg3w002h8gjda7ds706c"},{"name":"docker","_id":"cm7e5cdy600011gjdb312c8y3"}],"Data":[],"Page":[{"title":"about","date":"2020-02-23T11:20:33.000Z","layout":"about","_content":"\n一刹牵着你 一瞬飞万里\n一秒心动过 一世不忘记\n\n一息间妳的吻幻化我的发肤\n一息间妳的爱让我找到转机\n\n成就这一躺生命旅程不舍不弃\n成就这一个心愿准我跟着妳\n然后找一个境地跟妳相伴一起\n无惧这一切崩坏黑暗 跨越生死\n\n飞过千万里 天已经渐晚\n衰退的视觉 倒退的时间\n\n看不到 靠感觉亦会捉紧你手\n想不起你的脸 但我心跟着走\n\n延续这一躺生命旅程不舍不弃\n延续这一个心愿准我跟着妳\n然后找一个境地跟妳相伴一起\n无惧这一切崩坏黑暗 让我守着妳\n\n忘掉这一切生命色相都认得妳\n能用心于记忆内搜索 感受妳\n明白我跟妳生命线已相连不死\n能在远方再生没了期又再一～起\n\n今世 因为妳来","source":"about/index.md","raw":"---\ntitle: about\ndate: 2020-02-23 19:20:33\nlayout: about\n---\n\n一刹牵着你 一瞬飞万里\n一秒心动过 一世不忘记\n\n一息间妳的吻幻化我的发肤\n一息间妳的爱让我找到转机\n\n成就这一躺生命旅程不舍不弃\n成就这一个心愿准我跟着妳\n然后找一个境地跟妳相伴一起\n无惧这一切崩坏黑暗 跨越生死\n\n飞过千万里 天已经渐晚\n衰退的视觉 倒退的时间\n\n看不到 靠感觉亦会捉紧你手\n想不起你的脸 但我心跟着走\n\n延续这一躺生命旅程不舍不弃\n延续这一个心愿准我跟着妳\n然后找一个境地跟妳相伴一起\n无惧这一切崩坏黑暗 让我守着妳\n\n忘掉这一切生命色相都认得妳\n能用心于记忆内搜索 感受妳\n明白我跟妳生命线已相连不死\n能在远方再生没了期又再一～起\n\n今世 因为妳来","updated":"2024-06-27T06:50:59.998Z","path":"about/index.html","comments":1,"_id":"cm7a4vg3a00008gjd6uk9hx2w","content":"<p>一刹牵着你 一瞬飞万里<br>一秒心动过 一世不忘记</p>\n<p>一息间妳的吻幻化我的发肤<br>一息间妳的爱让我找到转机</p>\n<p>成就这一躺生命旅程不舍不弃<br>成就这一个心愿准我跟着妳<br>然后找一个境地跟妳相伴一起<br>无惧这一切崩坏黑暗 跨越生死</p>\n<p>飞过千万里 天已经渐晚<br>衰退的视觉 倒退的时间</p>\n<p>看不到 靠感觉亦会捉紧你手<br>想不起你的脸 但我心跟着走</p>\n<p>延续这一躺生命旅程不舍不弃<br>延续这一个心愿准我跟着妳<br>然后找一个境地跟妳相伴一起<br>无惧这一切崩坏黑暗 让我守着妳</p>\n<p>忘掉这一切生命色相都认得妳<br>能用心于记忆内搜索 感受妳<br>明白我跟妳生命线已相连不死<br>能在远方再生没了期又再一～起</p>\n<p>今世 因为妳来</p>\n","excerpt":"","more":"<p>一刹牵着你 一瞬飞万里<br>一秒心动过 一世不忘记</p>\n<p>一息间妳的吻幻化我的发肤<br>一息间妳的爱让我找到转机</p>\n<p>成就这一躺生命旅程不舍不弃<br>成就这一个心愿准我跟着妳<br>然后找一个境地跟妳相伴一起<br>无惧这一切崩坏黑暗 跨越生死</p>\n<p>飞过千万里 天已经渐晚<br>衰退的视觉 倒退的时间</p>\n<p>看不到 靠感觉亦会捉紧你手<br>想不起你的脸 但我心跟着走</p>\n<p>延续这一躺生命旅程不舍不弃<br>延续这一个心愿准我跟着妳<br>然后找一个境地跟妳相伴一起<br>无惧这一切崩坏黑暗 让我守着妳</p>\n<p>忘掉这一切生命色相都认得妳<br>能用心于记忆内搜索 感受妳<br>明白我跟妳生命线已相连不死<br>能在远方再生没了期又再一～起</p>\n<p>今世 因为妳来</p>\n"},{"title":"分类","date":"2025-02-18T06:19:20.000Z","type":"categories","_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\ndate: 2025-02-18 14:19:20\ntype: categories\n---\n","updated":"2025-02-18T06:19:57.546Z","path":"categories/index.html","comments":1,"layout":"page","_id":"cm7a4vg3d00028gjda5xw5zmp","content":"","excerpt":"","more":""},{"title":"标签","date":"2025-02-18T06:21:40.000Z","type":"tags","_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\ndate: 2025-02-18 14:21:40\ntype: tags\n---\n","updated":"2025-02-18T06:22:33.979Z","path":"tags/index.html","comments":1,"layout":"page","_id":"cm7a4vg3f00068gjdbn9yhtfa","content":"","excerpt":"","more":""}],"Post":[{"title":"docker修改应用为自动启动","date":"2024-07-23T06:39:38.000Z","_content":"是的，Docker 提供了一种简单的方法来配置容器在系统启动时自动启动，这就是使用 `docker update` 命令配置容器的重启策略。\n\n以下是如何使用 `docker update` 命令来配置现有的容器在系统启动时自动启动：\n\n```bash\ndocker update --restart unless-stopped <container_name_or_id>\n```\n\n例如，如果你的容器名为 `mysql-container`，你可以这样配置：\n\n```bash\ndocker update --restart unless-stopped mysql-container\n```\n\n这样配置后，当系统重启时，Docker 会根据 `unless-stopped` 策略自动重启该容器。以下是一些常用的重启策略：\n\n- `no`: 容器不会自动重启（默认值）。\n- `on-failure`: 仅当容器退出状态非零时才重启。\n- `always`: 无论退出状态如何，总是重启容器。\n- `unless-stopped`: 容器除非被手动停止，否则总是重启。\n\n### 示例\n\n以下是一个完整的示例，展示如何启动一个新的 MySQL 容器并配置其在系统重启时自动启动：\n\n1. 启动一个 MySQL 容器：\n\n    ```bash\n    docker run -d \\\n        --name mysql-container \\\n        -e MYSQL_ROOT_PASSWORD=my-secret-pw \\\n        -v /my/own/datadir:/var/lib/mysql \\\n        mysql:latest\n    ```\n\n2. 配置容器的重启策略：\n\n    ```bash\n    docker update --restart unless-stopped mysql-container\n    ```\n\n### 检查容器重启策略\n\n你可以使用以下命令来检查容器的重启策略：\n\n```bash\ndocker inspect -f '{{ .HostConfig.RestartPolicy.Name }}' mysql-container\n```\n\n这将输出容器的当前重启策略。\n\n### 使用 Docker Compose\n\n如果你使用 Docker Compose，可以在 `docker-compose.yml` 文件中配置重启策略：\n\n```yaml\nversion: '3.8'\n\nservices:\n  mysql:\n    image: mysql:latest\n    container_name: mysql-container\n    environment:\n      MYSQL_ROOT_PASSWORD: my-secret-pw\n    volumes:\n      - /my/own/datadir:/var/lib/mysql\n    restart: unless-stopped\n```\n\n然后，使用以下命令启动容器：\n\n```bash\ndocker-compose up -d\n```\n\n### 总结\n\n通过上述方法，你可以轻松地配置 Docker 容器在系统重启时自动启动，无论是通过 `docker run`、`docker update` 还是 `docker-compose`。","source":"_posts/linux/docker修改应用为自动启动.md","raw":"---\ntitle: docker修改应用为自动启动\ndate: 2024-07-23 14:39:38\ncategories: linux\ntag: docker\n---\n是的，Docker 提供了一种简单的方法来配置容器在系统启动时自动启动，这就是使用 `docker update` 命令配置容器的重启策略。\n\n以下是如何使用 `docker update` 命令来配置现有的容器在系统启动时自动启动：\n\n```bash\ndocker update --restart unless-stopped <container_name_or_id>\n```\n\n例如，如果你的容器名为 `mysql-container`，你可以这样配置：\n\n```bash\ndocker update --restart unless-stopped mysql-container\n```\n\n这样配置后，当系统重启时，Docker 会根据 `unless-stopped` 策略自动重启该容器。以下是一些常用的重启策略：\n\n- `no`: 容器不会自动重启（默认值）。\n- `on-failure`: 仅当容器退出状态非零时才重启。\n- `always`: 无论退出状态如何，总是重启容器。\n- `unless-stopped`: 容器除非被手动停止，否则总是重启。\n\n### 示例\n\n以下是一个完整的示例，展示如何启动一个新的 MySQL 容器并配置其在系统重启时自动启动：\n\n1. 启动一个 MySQL 容器：\n\n    ```bash\n    docker run -d \\\n        --name mysql-container \\\n        -e MYSQL_ROOT_PASSWORD=my-secret-pw \\\n        -v /my/own/datadir:/var/lib/mysql \\\n        mysql:latest\n    ```\n\n2. 配置容器的重启策略：\n\n    ```bash\n    docker update --restart unless-stopped mysql-container\n    ```\n\n### 检查容器重启策略\n\n你可以使用以下命令来检查容器的重启策略：\n\n```bash\ndocker inspect -f '{{ .HostConfig.RestartPolicy.Name }}' mysql-container\n```\n\n这将输出容器的当前重启策略。\n\n### 使用 Docker Compose\n\n如果你使用 Docker Compose，可以在 `docker-compose.yml` 文件中配置重启策略：\n\n```yaml\nversion: '3.8'\n\nservices:\n  mysql:\n    image: mysql:latest\n    container_name: mysql-container\n    environment:\n      MYSQL_ROOT_PASSWORD: my-secret-pw\n    volumes:\n      - /my/own/datadir:/var/lib/mysql\n    restart: unless-stopped\n```\n\n然后，使用以下命令启动容器：\n\n```bash\ndocker-compose up -d\n```\n\n### 总结\n\n通过上述方法，你可以轻松地配置 Docker 容器在系统重启时自动启动，无论是通过 `docker run`、`docker update` 还是 `docker-compose`。","slug":"linux/docker修改应用为自动启动","published":1,"updated":"2025-02-18T06:31:00.549Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3b00018gjda45v8l4v","content":"<p>是的，Docker 提供了一种简单的方法来配置容器在系统启动时自动启动，这就是使用 <code>docker update</code> 命令配置容器的重启策略。</p>\n<p>以下是如何使用 <code>docker update</code> 命令来配置现有的容器在系统启动时自动启动：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker update --restart unless-stopped &lt;container_name_or_id&gt;<br></code></pre></td></tr></table></figure>\n\n<p>例如，如果你的容器名为 <code>mysql-container</code>，你可以这样配置：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker update --restart unless-stopped mysql-container<br></code></pre></td></tr></table></figure>\n\n<p>这样配置后，当系统重启时，Docker 会根据 <code>unless-stopped</code> 策略自动重启该容器。以下是一些常用的重启策略：</p>\n<ul>\n<li><code>no</code>: 容器不会自动重启（默认值）。</li>\n<li><code>on-failure</code>: 仅当容器退出状态非零时才重启。</li>\n<li><code>always</code>: 无论退出状态如何，总是重启容器。</li>\n<li><code>unless-stopped</code>: 容器除非被手动停止，否则总是重启。</li>\n</ul>\n<h3 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h3><p>以下是一个完整的示例，展示如何启动一个新的 MySQL 容器并配置其在系统重启时自动启动：</p>\n<ol>\n<li><p>启动一个 MySQL 容器：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker run -d \\<br>    --name mysql-container \\<br>    -e MYSQL_ROOT_PASSWORD=my-secret-pw \\<br>    -v /my/own/datadir:/var/lib/mysql \\<br>    mysql:latest<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>配置容器的重启策略：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker update --restart unless-stopped mysql-container<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"检查容器重启策略\"><a href=\"#检查容器重启策略\" class=\"headerlink\" title=\"检查容器重启策略\"></a>检查容器重启策略</h3><p>你可以使用以下命令来检查容器的重启策略：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker inspect -f <span class=\"hljs-string\">&#x27;&#123;&#123; .HostConfig.RestartPolicy.Name &#125;&#125;&#x27;</span> mysql-container<br></code></pre></td></tr></table></figure>\n\n<p>这将输出容器的当前重启策略。</p>\n<h3 id=\"使用-Docker-Compose\"><a href=\"#使用-Docker-Compose\" class=\"headerlink\" title=\"使用 Docker Compose\"></a>使用 Docker Compose</h3><p>如果你使用 Docker Compose，可以在 <code>docker-compose.yml</code> 文件中配置重启策略：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&#x27;3.8&#x27;</span><br><br><span class=\"hljs-attr\">services:</span><br>  <span class=\"hljs-attr\">mysql:</span><br>    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">mysql:latest</span><br>    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">mysql-container</span><br>    <span class=\"hljs-attr\">environment:</span><br>      <span class=\"hljs-attr\">MYSQL_ROOT_PASSWORD:</span> <span class=\"hljs-string\">my-secret-pw</span><br>    <span class=\"hljs-attr\">volumes:</span><br>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/my/own/datadir:/var/lib/mysql</span><br>    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">unless-stopped</span><br></code></pre></td></tr></table></figure>\n\n<p>然后，使用以下命令启动容器：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker-compose up -d<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>通过上述方法，你可以轻松地配置 Docker 容器在系统重启时自动启动，无论是通过 <code>docker run</code>、<code>docker update</code> 还是 <code>docker-compose</code>。</p>\n","excerpt":"","more":"<p>是的，Docker 提供了一种简单的方法来配置容器在系统启动时自动启动，这就是使用 <code>docker update</code> 命令配置容器的重启策略。</p>\n<p>以下是如何使用 <code>docker update</code> 命令来配置现有的容器在系统启动时自动启动：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker update --restart unless-stopped &lt;container_name_or_id&gt;<br></code></pre></td></tr></table></figure>\n\n<p>例如，如果你的容器名为 <code>mysql-container</code>，你可以这样配置：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker update --restart unless-stopped mysql-container<br></code></pre></td></tr></table></figure>\n\n<p>这样配置后，当系统重启时，Docker 会根据 <code>unless-stopped</code> 策略自动重启该容器。以下是一些常用的重启策略：</p>\n<ul>\n<li><code>no</code>: 容器不会自动重启（默认值）。</li>\n<li><code>on-failure</code>: 仅当容器退出状态非零时才重启。</li>\n<li><code>always</code>: 无论退出状态如何，总是重启容器。</li>\n<li><code>unless-stopped</code>: 容器除非被手动停止，否则总是重启。</li>\n</ul>\n<h3 id=\"示例\"><a href=\"#示例\" class=\"headerlink\" title=\"示例\"></a>示例</h3><p>以下是一个完整的示例，展示如何启动一个新的 MySQL 容器并配置其在系统重启时自动启动：</p>\n<ol>\n<li><p>启动一个 MySQL 容器：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker run -d \\<br>    --name mysql-container \\<br>    -e MYSQL_ROOT_PASSWORD=my-secret-pw \\<br>    -v /my/own/datadir:/var/lib/mysql \\<br>    mysql:latest<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>配置容器的重启策略：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker update --restart unless-stopped mysql-container<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"检查容器重启策略\"><a href=\"#检查容器重启策略\" class=\"headerlink\" title=\"检查容器重启策略\"></a>检查容器重启策略</h3><p>你可以使用以下命令来检查容器的重启策略：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker inspect -f <span class=\"hljs-string\">&#x27;&#123;&#123; .HostConfig.RestartPolicy.Name &#125;&#125;&#x27;</span> mysql-container<br></code></pre></td></tr></table></figure>\n\n<p>这将输出容器的当前重启策略。</p>\n<h3 id=\"使用-Docker-Compose\"><a href=\"#使用-Docker-Compose\" class=\"headerlink\" title=\"使用 Docker Compose\"></a>使用 Docker Compose</h3><p>如果你使用 Docker Compose，可以在 <code>docker-compose.yml</code> 文件中配置重启策略：</p>\n<figure class=\"highlight yaml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs yaml\"><span class=\"hljs-attr\">version:</span> <span class=\"hljs-string\">&#x27;3.8&#x27;</span><br><br><span class=\"hljs-attr\">services:</span><br>  <span class=\"hljs-attr\">mysql:</span><br>    <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">mysql:latest</span><br>    <span class=\"hljs-attr\">container_name:</span> <span class=\"hljs-string\">mysql-container</span><br>    <span class=\"hljs-attr\">environment:</span><br>      <span class=\"hljs-attr\">MYSQL_ROOT_PASSWORD:</span> <span class=\"hljs-string\">my-secret-pw</span><br>    <span class=\"hljs-attr\">volumes:</span><br>      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">/my/own/datadir:/var/lib/mysql</span><br>    <span class=\"hljs-attr\">restart:</span> <span class=\"hljs-string\">unless-stopped</span><br></code></pre></td></tr></table></figure>\n\n<p>然后，使用以下命令启动容器：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker-compose up -d<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>通过上述方法，你可以轻松地配置 Docker 容器在系统重启时自动启动，无论是通过 <code>docker run</code>、<code>docker update</code> 还是 <code>docker-compose</code>。</p>\n"},{"title":"Application-toolkit-trace-cross-thread","date":"2024-09-11T07:14:06.000Z","_content":"# Trace Cross Thread\nThese APIs provide ways to continuous tracing in the cross thread scenario with minimal code changes.\nAll following are sample codes only to demonstrate how to adopt cross thread cases easier.\n\n* Case 1.\n```java\n    @TraceCrossThread\n    public static class MyCallable<String> implements Callable<String> {\n        @Override\n        public String call() throws Exception {\n            return null;\n        }\n    }\n...\n    ExecutorService executorService = Executors.newFixedThreadPool(1);\n    executorService.submit(new MyCallable());\n```\n* Case 2.\n```java\n    ExecutorService executorService = Executors.newFixedThreadPool(1);\n    executorService.submit(CallableWrapper.of(new Callable<String>() {\n        @Override public String call() throws Exception {\n            return null;\n        }\n    }));\n```\nor\n```java\n    ExecutorService executorService = Executors.newFixedThreadPool(1);\n    executorService.execute(RunnableWrapper.of(new Runnable() {\n        @Override public void run() {\n            //your code\n        }\n    }));\n```\n* Case 3.\n```java\n    @TraceCrossThread\n    public class MySupplier<String> implements Supplier<String> {\n        @Override\n        public String get() {\n            return null;\n        }\n    }\n...\n    CompletableFuture.supplyAsync(new MySupplier<String>());\n```\nor\n```java\n    CompletableFuture.supplyAsync(SupplierWrapper.of(()->{\n            return \"SupplierWrapper\";\n    })).thenAccept(System.out::println);\n```\n* Case 4.\n```java\n    CompletableFuture.supplyAsync(SupplierWrapper.of(() -> {\n        return \"SupplierWrapper\";\n    })).thenAcceptAsync(ConsumerWrapper.of(c -> {\n        // your code visit(url)\n        System.out.println(\"ConsumerWrapper\");\n    }));\n```\nor\n```java\n    CompletableFuture.supplyAsync(SupplierWrapper.of(() -> {\n        return \"SupplierWrapper\";\n    })).thenApplyAsync(FunctionWrapper.of(f -> {\n        // your code visit(url)\n        return \"FunctionWrapper\";\n    }));\n```\n\n\n\n","source":"_posts/java/Application-toolkit-trace-cross-thread.md","raw":"---\ntitle: Application-toolkit-trace-cross-thread\ndate: 2024-09-11 15:14:06\ncategories: Java\ntag: 并发\n---\n# Trace Cross Thread\nThese APIs provide ways to continuous tracing in the cross thread scenario with minimal code changes.\nAll following are sample codes only to demonstrate how to adopt cross thread cases easier.\n\n* Case 1.\n```java\n    @TraceCrossThread\n    public static class MyCallable<String> implements Callable<String> {\n        @Override\n        public String call() throws Exception {\n            return null;\n        }\n    }\n...\n    ExecutorService executorService = Executors.newFixedThreadPool(1);\n    executorService.submit(new MyCallable());\n```\n* Case 2.\n```java\n    ExecutorService executorService = Executors.newFixedThreadPool(1);\n    executorService.submit(CallableWrapper.of(new Callable<String>() {\n        @Override public String call() throws Exception {\n            return null;\n        }\n    }));\n```\nor\n```java\n    ExecutorService executorService = Executors.newFixedThreadPool(1);\n    executorService.execute(RunnableWrapper.of(new Runnable() {\n        @Override public void run() {\n            //your code\n        }\n    }));\n```\n* Case 3.\n```java\n    @TraceCrossThread\n    public class MySupplier<String> implements Supplier<String> {\n        @Override\n        public String get() {\n            return null;\n        }\n    }\n...\n    CompletableFuture.supplyAsync(new MySupplier<String>());\n```\nor\n```java\n    CompletableFuture.supplyAsync(SupplierWrapper.of(()->{\n            return \"SupplierWrapper\";\n    })).thenAccept(System.out::println);\n```\n* Case 4.\n```java\n    CompletableFuture.supplyAsync(SupplierWrapper.of(() -> {\n        return \"SupplierWrapper\";\n    })).thenAcceptAsync(ConsumerWrapper.of(c -> {\n        // your code visit(url)\n        System.out.println(\"ConsumerWrapper\");\n    }));\n```\nor\n```java\n    CompletableFuture.supplyAsync(SupplierWrapper.of(() -> {\n        return \"SupplierWrapper\";\n    })).thenApplyAsync(FunctionWrapper.of(f -> {\n        // your code visit(url)\n        return \"FunctionWrapper\";\n    }));\n```\n\n\n\n","slug":"java/Application-toolkit-trace-cross-thread","published":1,"updated":"2025-02-18T06:31:00.542Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3d00038gjddnru1t6w","content":"<h1 id=\"Trace-Cross-Thread\"><a href=\"#Trace-Cross-Thread\" class=\"headerlink\" title=\"Trace Cross Thread\"></a>Trace Cross Thread</h1><p>These APIs provide ways to continuous tracing in the cross thread scenario with minimal code changes.<br>All following are sample codes only to demonstrate how to adopt cross thread cases easier.</p>\n<ul>\n<li>Case 1.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">    <span class=\"hljs-meta\">@TraceCrossThread</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyCallable</span>&lt;String&gt; <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Callable</span>&lt;String&gt; &#123;<br>        <span class=\"hljs-meta\">@Override</span><br>        <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">call</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;<br>        &#125;<br>    &#125;<br>...<br>    <span class=\"hljs-type\">ExecutorService</span> <span class=\"hljs-variable\">executorService</span> <span class=\"hljs-operator\">=</span> Executors.newFixedThreadPool(<span class=\"hljs-number\">1</span>);<br>    executorService.submit(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MyCallable</span>());<br></code></pre></td></tr></table></figure></li>\n<li>Case 2.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">ExecutorService</span> <span class=\"hljs-variable\">executorService</span> <span class=\"hljs-operator\">=</span> Executors.newFixedThreadPool(<span class=\"hljs-number\">1</span>);<br>executorService.submit(CallableWrapper.of(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Callable</span>&lt;String&gt;() &#123;<br>    <span class=\"hljs-meta\">@Override</span> <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">call</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;<br>    &#125;<br>&#125;));<br></code></pre></td></tr></table></figure>\nor<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">ExecutorService</span> <span class=\"hljs-variable\">executorService</span> <span class=\"hljs-operator\">=</span> Executors.newFixedThreadPool(<span class=\"hljs-number\">1</span>);<br>executorService.execute(RunnableWrapper.of(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Runnable</span>() &#123;<br>    <span class=\"hljs-meta\">@Override</span> <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> &#123;<br>        <span class=\"hljs-comment\">//your code</span><br>    &#125;<br>&#125;));<br></code></pre></td></tr></table></figure></li>\n<li>Case 3.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">    <span class=\"hljs-meta\">@TraceCrossThread</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MySupplier</span>&lt;String&gt; <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Supplier</span>&lt;String&gt; &#123;<br>        <span class=\"hljs-meta\">@Override</span><br>        <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">get</span><span class=\"hljs-params\">()</span> &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;<br>        &#125;<br>    &#125;<br>...<br>    CompletableFuture.supplyAsync(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySupplier</span>&lt;String&gt;());<br></code></pre></td></tr></table></figure>\nor<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">CompletableFuture.supplyAsync(SupplierWrapper.of(()-&gt;&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;SupplierWrapper&quot;</span>;<br>&#125;)).thenAccept(System.out::println);<br></code></pre></td></tr></table></figure></li>\n<li>Case 4.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">CompletableFuture.supplyAsync(SupplierWrapper.of(() -&gt; &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;SupplierWrapper&quot;</span>;<br>&#125;)).thenAcceptAsync(ConsumerWrapper.of(c -&gt; &#123;<br>    <span class=\"hljs-comment\">// your code visit(url)</span><br>    System.out.println(<span class=\"hljs-string\">&quot;ConsumerWrapper&quot;</span>);<br>&#125;));<br></code></pre></td></tr></table></figure>\nor<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">CompletableFuture.supplyAsync(SupplierWrapper.of(() -&gt; &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;SupplierWrapper&quot;</span>;<br>&#125;)).thenApplyAsync(FunctionWrapper.of(f -&gt; &#123;<br>    <span class=\"hljs-comment\">// your code visit(url)</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;FunctionWrapper&quot;</span>;<br>&#125;));<br></code></pre></td></tr></table></figure></li>\n</ul>\n","excerpt":"","more":"<h1 id=\"Trace-Cross-Thread\"><a href=\"#Trace-Cross-Thread\" class=\"headerlink\" title=\"Trace Cross Thread\"></a>Trace Cross Thread</h1><p>These APIs provide ways to continuous tracing in the cross thread scenario with minimal code changes.<br>All following are sample codes only to demonstrate how to adopt cross thread cases easier.</p>\n<ul>\n<li>Case 1.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">    <span class=\"hljs-meta\">@TraceCrossThread</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MyCallable</span>&lt;String&gt; <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Callable</span>&lt;String&gt; &#123;<br>        <span class=\"hljs-meta\">@Override</span><br>        <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">call</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;<br>        &#125;<br>    &#125;<br>...<br>    <span class=\"hljs-type\">ExecutorService</span> <span class=\"hljs-variable\">executorService</span> <span class=\"hljs-operator\">=</span> Executors.newFixedThreadPool(<span class=\"hljs-number\">1</span>);<br>    executorService.submit(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MyCallable</span>());<br></code></pre></td></tr></table></figure></li>\n<li>Case 2.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">ExecutorService</span> <span class=\"hljs-variable\">executorService</span> <span class=\"hljs-operator\">=</span> Executors.newFixedThreadPool(<span class=\"hljs-number\">1</span>);<br>executorService.submit(CallableWrapper.of(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Callable</span>&lt;String&gt;() &#123;<br>    <span class=\"hljs-meta\">@Override</span> <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">call</span><span class=\"hljs-params\">()</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;<br>    &#125;<br>&#125;));<br></code></pre></td></tr></table></figure>\nor<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-type\">ExecutorService</span> <span class=\"hljs-variable\">executorService</span> <span class=\"hljs-operator\">=</span> Executors.newFixedThreadPool(<span class=\"hljs-number\">1</span>);<br>executorService.execute(RunnableWrapper.of(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">Runnable</span>() &#123;<br>    <span class=\"hljs-meta\">@Override</span> <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">run</span><span class=\"hljs-params\">()</span> &#123;<br>        <span class=\"hljs-comment\">//your code</span><br>    &#125;<br>&#125;));<br></code></pre></td></tr></table></figure></li>\n<li>Case 3.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">    <span class=\"hljs-meta\">@TraceCrossThread</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">MySupplier</span>&lt;String&gt; <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">Supplier</span>&lt;String&gt; &#123;<br>        <span class=\"hljs-meta\">@Override</span><br>        <span class=\"hljs-keyword\">public</span> String <span class=\"hljs-title function_\">get</span><span class=\"hljs-params\">()</span> &#123;<br>            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">null</span>;<br>        &#125;<br>    &#125;<br>...<br>    CompletableFuture.supplyAsync(<span class=\"hljs-keyword\">new</span> <span class=\"hljs-title class_\">MySupplier</span>&lt;String&gt;());<br></code></pre></td></tr></table></figure>\nor<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">CompletableFuture.supplyAsync(SupplierWrapper.of(()-&gt;&#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;SupplierWrapper&quot;</span>;<br>&#125;)).thenAccept(System.out::println);<br></code></pre></td></tr></table></figure></li>\n<li>Case 4.<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">CompletableFuture.supplyAsync(SupplierWrapper.of(() -&gt; &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;SupplierWrapper&quot;</span>;<br>&#125;)).thenAcceptAsync(ConsumerWrapper.of(c -&gt; &#123;<br>    <span class=\"hljs-comment\">// your code visit(url)</span><br>    System.out.println(<span class=\"hljs-string\">&quot;ConsumerWrapper&quot;</span>);<br>&#125;));<br></code></pre></td></tr></table></figure>\nor<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\">CompletableFuture.supplyAsync(SupplierWrapper.of(() -&gt; &#123;<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;SupplierWrapper&quot;</span>;<br>&#125;)).thenApplyAsync(FunctionWrapper.of(f -&gt; &#123;<br>    <span class=\"hljs-comment\">// your code visit(url)</span><br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">&quot;FunctionWrapper&quot;</span>;<br>&#125;));<br></code></pre></td></tr></table></figure></li>\n</ul>\n"},{"title":"github 将远程仓库更新到自己的仓库中","date":"2024-08-13T08:30:29.000Z","_content":"要将远程仓库的更新同步到你本地的Git仓库中，可以按照以下步骤进行：\n\n1. **添加远程仓库**（如果还没有添加远程仓库）：\n    ```bash\n    git remote add upstream <远程仓库的URL>\n    ```\n   例如，如果你想将GitHub上原始项目的更新同步到你自己的分支，`upstream` 就是你需要添加的远程仓库。\n\n2. **获取远程仓库的更新**：\n    ```bash\n    git fetch upstream\n    ```\n   这将从远程仓库获取所有更新内容，但不会自动合并到你的分支中。\n\n3. **将远程仓库的更新合并到你的分支**：\n    - 如果你在 `main` 分支上，并希望将 `upstream/main` 的更新合并到本地的 `main` 分支：\n        ```bash\n        git checkout main\n        git merge upstream/main\n        ```\n   这会将远程 `main` 分支的更新合并到你本地的 `main` 分支中。\n\n4. **处理可能的冲突**：\n    - 如果在合并时发生冲突，Git 会提示你手动解决冲突。你需要编辑冲突的文件，解决冲突后，运行以下命令：\n        ```bash\n        git add <解决冲突的文件>\n        git commit -m \"Resolved merge conflicts\"\n        ```\n\n5. **将更新推送到你自己的远程仓库**（如果需要）：\n    ```bash\n    git push origin main\n    ```\n   这会将你本地 `main` 分支的更新推送到你自己的GitHub仓库中。\n\n通过这些步骤，你就可以将远程仓库的更新同步到你的本地仓库，并且可以根据需要将这些更新推送到你自己的远程仓库中。","source":"_posts/linux/github-将远程仓库更新到自己的仓库中.md","raw":"---\ntitle: github 将远程仓库更新到自己的仓库中\ndate: 2024-08-13 16:30:29\ncategories: linux\ntag: git\n---\n要将远程仓库的更新同步到你本地的Git仓库中，可以按照以下步骤进行：\n\n1. **添加远程仓库**（如果还没有添加远程仓库）：\n    ```bash\n    git remote add upstream <远程仓库的URL>\n    ```\n   例如，如果你想将GitHub上原始项目的更新同步到你自己的分支，`upstream` 就是你需要添加的远程仓库。\n\n2. **获取远程仓库的更新**：\n    ```bash\n    git fetch upstream\n    ```\n   这将从远程仓库获取所有更新内容，但不会自动合并到你的分支中。\n\n3. **将远程仓库的更新合并到你的分支**：\n    - 如果你在 `main` 分支上，并希望将 `upstream/main` 的更新合并到本地的 `main` 分支：\n        ```bash\n        git checkout main\n        git merge upstream/main\n        ```\n   这会将远程 `main` 分支的更新合并到你本地的 `main` 分支中。\n\n4. **处理可能的冲突**：\n    - 如果在合并时发生冲突，Git 会提示你手动解决冲突。你需要编辑冲突的文件，解决冲突后，运行以下命令：\n        ```bash\n        git add <解决冲突的文件>\n        git commit -m \"Resolved merge conflicts\"\n        ```\n\n5. **将更新推送到你自己的远程仓库**（如果需要）：\n    ```bash\n    git push origin main\n    ```\n   这会将你本地 `main` 分支的更新推送到你自己的GitHub仓库中。\n\n通过这些步骤，你就可以将远程仓库的更新同步到你的本地仓库，并且可以根据需要将这些更新推送到你自己的远程仓库中。","slug":"linux/github-将远程仓库更新到自己的仓库中","published":1,"updated":"2025-02-18T06:31:00.556Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3g00078gjd1f662wrg","content":"<p>要将远程仓库的更新同步到你本地的Git仓库中，可以按照以下步骤进行：</p>\n<ol>\n<li><p><strong>添加远程仓库</strong>（如果还没有添加远程仓库）：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git remote add upstream &lt;远程仓库的URL&gt;<br></code></pre></td></tr></table></figure>\n<p>例如，如果你想将GitHub上原始项目的更新同步到你自己的分支，<code>upstream</code> 就是你需要添加的远程仓库。</p>\n</li>\n<li><p><strong>获取远程仓库的更新</strong>：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git fetch upstream<br></code></pre></td></tr></table></figure>\n<p>这将从远程仓库获取所有更新内容，但不会自动合并到你的分支中。</p>\n</li>\n<li><p><strong>将远程仓库的更新合并到你的分支</strong>：</p>\n<ul>\n<li>如果你在 <code>main</code> 分支上，并希望将 <code>upstream/main</code> 的更新合并到本地的 <code>main</code> 分支：  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git checkout main<br>git merge upstream/main<br></code></pre></td></tr></table></figure>\n这会将远程 <code>main</code> 分支的更新合并到你本地的 <code>main</code> 分支中。</li>\n</ul>\n</li>\n<li><p><strong>处理可能的冲突</strong>：</p>\n<ul>\n<li>如果在合并时发生冲突，Git 会提示你手动解决冲突。你需要编辑冲突的文件，解决冲突后，运行以下命令：  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git add &lt;解决冲突的文件&gt;<br>git commit -m <span class=\"hljs-string\">&quot;Resolved merge conflicts&quot;</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong>将更新推送到你自己的远程仓库</strong>（如果需要）：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git push origin main<br></code></pre></td></tr></table></figure>\n<p>这会将你本地 <code>main</code> 分支的更新推送到你自己的GitHub仓库中。</p>\n</li>\n</ol>\n<p>通过这些步骤，你就可以将远程仓库的更新同步到你的本地仓库，并且可以根据需要将这些更新推送到你自己的远程仓库中。</p>\n","excerpt":"","more":"<p>要将远程仓库的更新同步到你本地的Git仓库中，可以按照以下步骤进行：</p>\n<ol>\n<li><p><strong>添加远程仓库</strong>（如果还没有添加远程仓库）：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git remote add upstream &lt;远程仓库的URL&gt;<br></code></pre></td></tr></table></figure>\n<p>例如，如果你想将GitHub上原始项目的更新同步到你自己的分支，<code>upstream</code> 就是你需要添加的远程仓库。</p>\n</li>\n<li><p><strong>获取远程仓库的更新</strong>：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git fetch upstream<br></code></pre></td></tr></table></figure>\n<p>这将从远程仓库获取所有更新内容，但不会自动合并到你的分支中。</p>\n</li>\n<li><p><strong>将远程仓库的更新合并到你的分支</strong>：</p>\n<ul>\n<li>如果你在 <code>main</code> 分支上，并希望将 <code>upstream/main</code> 的更新合并到本地的 <code>main</code> 分支：  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git checkout main<br>git merge upstream/main<br></code></pre></td></tr></table></figure>\n这会将远程 <code>main</code> 分支的更新合并到你本地的 <code>main</code> 分支中。</li>\n</ul>\n</li>\n<li><p><strong>处理可能的冲突</strong>：</p>\n<ul>\n<li>如果在合并时发生冲突，Git 会提示你手动解决冲突。你需要编辑冲突的文件，解决冲突后，运行以下命令：  <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git add &lt;解决冲突的文件&gt;<br>git commit -m <span class=\"hljs-string\">&quot;Resolved merge conflicts&quot;</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong>将更新推送到你自己的远程仓库</strong>（如果需要）：</p>\n <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">git push origin main<br></code></pre></td></tr></table></figure>\n<p>这会将你本地 <code>main</code> 分支的更新推送到你自己的GitHub仓库中。</p>\n</li>\n</ol>\n<p>通过这些步骤，你就可以将远程仓库的更新同步到你的本地仓库，并且可以根据需要将这些更新推送到你自己的远程仓库中。</p>\n"},{"title":"linux下实现钉钉告警","date":"2024-07-23T03:45:38.000Z","_content":"\n在Linux系统中，可以使用Shell脚本和定时任务（cron）来监控CPU、内存和硬盘使用情况，当超过指定阈值时发送告警。为了发送钉钉告警，需要用到钉钉的自定义机器人接口。\n需要注意的是，本教程的机器是12核心。因此需要得到12核心的最高cpu使用率后取最大值。\n\n以下是实现此功能的步骤：\n\n1. **创建钉钉机器人并获取Webhook URL：**\n    - 登录钉钉，创建自定义机器人并获取Webhook URL，用于发送告警信息。\n    \n2. **编写Shell脚本：**\n    - 编写一个Shell脚本来检查系统资源的使用情况，并在超过阈值时发送钉钉告警。\n    \n3. **配置定时任务（cron）：**\n    - 将脚本配置为定时任务，定期检查系统资源的使用情况。\n\n### 1. 创建钉钉机器人并获取Webhook URL\n\n在钉钉中创建自定义机器人，记录下Webhook URL，这将在脚本中用于发送告警。\n- 例如：https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5\n\n### 2. 编写Shell脚本\n\n下面是一个示例Shell脚本`monitor.sh`：\n\n```sh\n#!/bin/bash\n\n# 获取cpu使用率\nfunction get_cpu_usage(){\n    echo $(top -bn1 | grep \"Cpu(s)\" | awk '{print 100 - $8}' | awk '{printf \"%.2f\", $1}')\n}\n\n# 获取磁盘使用率\ndata_name=\"/\" \ndiskUsage=$(df -h | grep -w $data_name | awk '{print $5}' | sed 's/%//')\n\n# 获取内存情况\nmem_total=$(free -m | awk 'NR==2 {print $2}')\nmem_used=$(free -m | awk 'NR==2 {print $3}')\n\n# 统计内存使用率\nmem_used_percent=$(echo \"scale=2; ($mem_used / $mem_total) * 100\" | bc)\n\n# 获取报警时间\nnow_time=$(date '+%F %T')\n\nuser=\"18857415467\"\n\n# 主机信息\nDate_time=$(date \"+%Y-%m-%d--%H:%M:%S\")\nIP_addr=$(hostname -I | awk '{print $1}')\n\n# webhook url\nDingding_Url=\"https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5\"\n\nfunction SendDownMessageToDingding(){\n    # 发送钉钉消息\n    curl -s \"${Dingding_Url}\" -H 'Content-Type: application/json' -d \"\n    {\n     'msgtype': 'text',\n     'text': {'content': '资源耗尽警告！\\n巡查时间：${Date_time}\\nIP地址：${IP_addr}\\n资源状况如下:\\n【CPU使用率：${cpuUsage}%】\\n【磁盘使用率：${diskUsage}%】\\n【内存使用率：${mem_used_percent}%】'},\n     'at': {'atMobiles': ['${user}'], 'isAtAll': true}\n      }\"\n}\n\nfunction check(){\n    cpuUsage=$(get_cpu_usage)\n    if (( $(echo \"$cpuUsage > 90\" | bc -l) )); then\n        echo \"检测到CPU使用率高于90%，开始1分钟监控...\"\n        high_cpu_duration=0\n        for ((i=0; i<60; i++)); do\n            sleep 1\n            cpuUsage=$(get_cpu_usage)\n            if (( $(echo \"$cpuUsage > 90\" | bc -l) )); then\n                ((high_cpu_duration++))\n            else\n                high_cpu_duration=0\n            fi\n\n            if (( high_cpu_duration >= 60 )); then\n                echo \"CPU使用率持续高于90%超过1分钟，发送警报...\"\n                SendDownMessageToDingding\n                break\n            fi\n        done\n    fi\n\n    if (( $(echo \"$diskUsage > 80\" | bc -l) )) || (( $(echo \"$mem_used_percent > 80\" | bc -l) )); then\n        SendDownMessageToDingding\n    fi\n}\n\ncheck\n\n```\n\n将`073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5`替换为你从钉钉获取的Webhook URL的token。\n\n### 3. 配置定时任务（cron）\n\n通过cron定期运行这个脚本。首先，编辑cron配置：\n\n```sh\ncrontab -e\n```\n\n然后添加以下内容以每分钟运行一次脚本：\n\n```sh\n* * * * * /path/to/monitor.sh\n```\n\n确保脚本`monitor.sh`有执行权限：\n\n```sh\nchmod +x /path/to/monitor.sh\n```\n\n### 总结\n\n上述脚本和cron配置将监控CPU、内存和硬盘使用情况，并在超过设定的阈值时通过钉钉发送告警消息。你可以根据实际需求调整脚本的执行频率和告警阈值。","source":"_posts/linux/linux下实现钉钉告警.md","raw":"---\ntitle: linux下实现钉钉告警\ndate: 2024-07-23 11:45:38\ncategories: linux\ntag: 报警\n---\n\n在Linux系统中，可以使用Shell脚本和定时任务（cron）来监控CPU、内存和硬盘使用情况，当超过指定阈值时发送告警。为了发送钉钉告警，需要用到钉钉的自定义机器人接口。\n需要注意的是，本教程的机器是12核心。因此需要得到12核心的最高cpu使用率后取最大值。\n\n以下是实现此功能的步骤：\n\n1. **创建钉钉机器人并获取Webhook URL：**\n    - 登录钉钉，创建自定义机器人并获取Webhook URL，用于发送告警信息。\n    \n2. **编写Shell脚本：**\n    - 编写一个Shell脚本来检查系统资源的使用情况，并在超过阈值时发送钉钉告警。\n    \n3. **配置定时任务（cron）：**\n    - 将脚本配置为定时任务，定期检查系统资源的使用情况。\n\n### 1. 创建钉钉机器人并获取Webhook URL\n\n在钉钉中创建自定义机器人，记录下Webhook URL，这将在脚本中用于发送告警。\n- 例如：https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5\n\n### 2. 编写Shell脚本\n\n下面是一个示例Shell脚本`monitor.sh`：\n\n```sh\n#!/bin/bash\n\n# 获取cpu使用率\nfunction get_cpu_usage(){\n    echo $(top -bn1 | grep \"Cpu(s)\" | awk '{print 100 - $8}' | awk '{printf \"%.2f\", $1}')\n}\n\n# 获取磁盘使用率\ndata_name=\"/\" \ndiskUsage=$(df -h | grep -w $data_name | awk '{print $5}' | sed 's/%//')\n\n# 获取内存情况\nmem_total=$(free -m | awk 'NR==2 {print $2}')\nmem_used=$(free -m | awk 'NR==2 {print $3}')\n\n# 统计内存使用率\nmem_used_percent=$(echo \"scale=2; ($mem_used / $mem_total) * 100\" | bc)\n\n# 获取报警时间\nnow_time=$(date '+%F %T')\n\nuser=\"18857415467\"\n\n# 主机信息\nDate_time=$(date \"+%Y-%m-%d--%H:%M:%S\")\nIP_addr=$(hostname -I | awk '{print $1}')\n\n# webhook url\nDingding_Url=\"https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5\"\n\nfunction SendDownMessageToDingding(){\n    # 发送钉钉消息\n    curl -s \"${Dingding_Url}\" -H 'Content-Type: application/json' -d \"\n    {\n     'msgtype': 'text',\n     'text': {'content': '资源耗尽警告！\\n巡查时间：${Date_time}\\nIP地址：${IP_addr}\\n资源状况如下:\\n【CPU使用率：${cpuUsage}%】\\n【磁盘使用率：${diskUsage}%】\\n【内存使用率：${mem_used_percent}%】'},\n     'at': {'atMobiles': ['${user}'], 'isAtAll': true}\n      }\"\n}\n\nfunction check(){\n    cpuUsage=$(get_cpu_usage)\n    if (( $(echo \"$cpuUsage > 90\" | bc -l) )); then\n        echo \"检测到CPU使用率高于90%，开始1分钟监控...\"\n        high_cpu_duration=0\n        for ((i=0; i<60; i++)); do\n            sleep 1\n            cpuUsage=$(get_cpu_usage)\n            if (( $(echo \"$cpuUsage > 90\" | bc -l) )); then\n                ((high_cpu_duration++))\n            else\n                high_cpu_duration=0\n            fi\n\n            if (( high_cpu_duration >= 60 )); then\n                echo \"CPU使用率持续高于90%超过1分钟，发送警报...\"\n                SendDownMessageToDingding\n                break\n            fi\n        done\n    fi\n\n    if (( $(echo \"$diskUsage > 80\" | bc -l) )) || (( $(echo \"$mem_used_percent > 80\" | bc -l) )); then\n        SendDownMessageToDingding\n    fi\n}\n\ncheck\n\n```\n\n将`073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5`替换为你从钉钉获取的Webhook URL的token。\n\n### 3. 配置定时任务（cron）\n\n通过cron定期运行这个脚本。首先，编辑cron配置：\n\n```sh\ncrontab -e\n```\n\n然后添加以下内容以每分钟运行一次脚本：\n\n```sh\n* * * * * /path/to/monitor.sh\n```\n\n确保脚本`monitor.sh`有执行权限：\n\n```sh\nchmod +x /path/to/monitor.sh\n```\n\n### 总结\n\n上述脚本和cron配置将监控CPU、内存和硬盘使用情况，并在超过设定的阈值时通过钉钉发送告警消息。你可以根据实际需求调整脚本的执行频率和告警阈值。","slug":"linux/linux下实现钉钉告警","published":1,"updated":"2025-02-18T06:31:00.569Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3g00088gjd2gtf1mly","content":"<p>在Linux系统中，可以使用Shell脚本和定时任务（cron）来监控CPU、内存和硬盘使用情况，当超过指定阈值时发送告警。为了发送钉钉告警，需要用到钉钉的自定义机器人接口。<br>需要注意的是，本教程的机器是12核心。因此需要得到12核心的最高cpu使用率后取最大值。</p>\n<p>以下是实现此功能的步骤：</p>\n<ol>\n<li><p><strong>创建钉钉机器人并获取Webhook URL：</strong></p>\n<ul>\n<li>登录钉钉，创建自定义机器人并获取Webhook URL，用于发送告警信息。</li>\n</ul>\n</li>\n<li><p><strong>编写Shell脚本：</strong></p>\n<ul>\n<li>编写一个Shell脚本来检查系统资源的使用情况，并在超过阈值时发送钉钉告警。</li>\n</ul>\n</li>\n<li><p><strong>配置定时任务（cron）：</strong></p>\n<ul>\n<li>将脚本配置为定时任务，定期检查系统资源的使用情况。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"1-创建钉钉机器人并获取Webhook-URL\"><a href=\"#1-创建钉钉机器人并获取Webhook-URL\" class=\"headerlink\" title=\"1. 创建钉钉机器人并获取Webhook URL\"></a>1. 创建钉钉机器人并获取Webhook URL</h3><p>在钉钉中创建自定义机器人，记录下Webhook URL，这将在脚本中用于发送告警。</p>\n<ul>\n<li>例如：<a href=\"https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5\">https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5</a></li>\n</ul>\n<h3 id=\"2-编写Shell脚本\"><a href=\"#2-编写Shell脚本\" class=\"headerlink\" title=\"2. 编写Shell脚本\"></a>2. 编写Shell脚本</h3><p>下面是一个示例Shell脚本<code>monitor.sh</code>：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\"><span class=\"hljs-meta\">#!/bin/bash</span><br><br><span class=\"hljs-comment\"># 获取cpu使用率</span><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">get_cpu_usage</span></span>()&#123;<br>    <span class=\"hljs-built_in\">echo</span> $(top -bn1 | grep <span class=\"hljs-string\">&quot;Cpu(s)&quot;</span> | awk <span class=\"hljs-string\">&#x27;&#123;print 100 - $8&#125;&#x27;</span> | awk <span class=\"hljs-string\">&#x27;&#123;printf &quot;%.2f&quot;, $1&#125;&#x27;</span>)<br>&#125;<br><br><span class=\"hljs-comment\"># 获取磁盘使用率</span><br>data_name=<span class=\"hljs-string\">&quot;/&quot;</span> <br>diskUsage=$(<span class=\"hljs-built_in\">df</span> -h | grep -w <span class=\"hljs-variable\">$data_name</span> | awk <span class=\"hljs-string\">&#x27;&#123;print $5&#125;&#x27;</span> | sed <span class=\"hljs-string\">&#x27;s/%//&#x27;</span>)<br><br><span class=\"hljs-comment\"># 获取内存情况</span><br>mem_total=$(free -m | awk <span class=\"hljs-string\">&#x27;NR==2 &#123;print $2&#125;&#x27;</span>)<br>mem_used=$(free -m | awk <span class=\"hljs-string\">&#x27;NR==2 &#123;print $3&#125;&#x27;</span>)<br><br><span class=\"hljs-comment\"># 统计内存使用率</span><br>mem_used_percent=$(<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;scale=2; (<span class=\"hljs-variable\">$mem_used</span> / <span class=\"hljs-variable\">$mem_total</span>) * 100&quot;</span> | bc)<br><br><span class=\"hljs-comment\"># 获取报警时间</span><br>now_time=$(<span class=\"hljs-built_in\">date</span> <span class=\"hljs-string\">&#x27;+%F %T&#x27;</span>)<br><br>user=<span class=\"hljs-string\">&quot;18857415467&quot;</span><br><br><span class=\"hljs-comment\"># 主机信息</span><br>Date_time=$(<span class=\"hljs-built_in\">date</span> <span class=\"hljs-string\">&quot;+%Y-%m-%d--%H:%M:%S&quot;</span>)<br>IP_addr=$(hostname -I | awk <span class=\"hljs-string\">&#x27;&#123;print $1&#125;&#x27;</span>)<br><br><span class=\"hljs-comment\"># webhook url</span><br>Dingding_Url=<span class=\"hljs-string\">&quot;https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5&quot;</span><br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">SendDownMessageToDingding</span></span>()&#123;<br>    <span class=\"hljs-comment\"># 发送钉钉消息</span><br>    curl -s <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;Dingding_Url&#125;</span>&quot;</span> -H <span class=\"hljs-string\">&#x27;Content-Type: application/json&#x27;</span> -d <span class=\"hljs-string\">&quot;</span><br><span class=\"hljs-string\">    &#123;</span><br><span class=\"hljs-string\">     &#x27;msgtype&#x27;: &#x27;text&#x27;,</span><br><span class=\"hljs-string\">     &#x27;text&#x27;: &#123;&#x27;content&#x27;: &#x27;资源耗尽警告！\\n巡查时间：<span class=\"hljs-variable\">$&#123;Date_time&#125;</span>\\nIP地址：<span class=\"hljs-variable\">$&#123;IP_addr&#125;</span>\\n资源状况如下:\\n【CPU使用率：<span class=\"hljs-variable\">$&#123;cpuUsage&#125;</span>%】\\n【磁盘使用率：<span class=\"hljs-variable\">$&#123;diskUsage&#125;</span>%】\\n【内存使用率：<span class=\"hljs-variable\">$&#123;mem_used_percent&#125;</span>%】&#x27;&#125;,</span><br><span class=\"hljs-string\">     &#x27;at&#x27;: &#123;&#x27;atMobiles&#x27;: [&#x27;<span class=\"hljs-variable\">$&#123;user&#125;</span>&#x27;], &#x27;isAtAll&#x27;: true&#125;</span><br><span class=\"hljs-string\">      &#125;&quot;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">check</span></span>()&#123;<br>    cpuUsage=$(get_cpu_usage)<br>    <span class=\"hljs-keyword\">if</span> (( $(echo &quot;<span class=\"hljs-variable\">$cpuUsage</span> &gt; <span class=\"hljs-number\">90</span>&quot; | bc -l) )); <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;检测到CPU使用率高于90%，开始1分钟监控...&quot;</span><br>        high_cpu_duration=0<br>        <span class=\"hljs-keyword\">for</span> ((i=<span class=\"hljs-number\">0</span>; i&lt;<span class=\"hljs-number\">60</span>; i++)); <span class=\"hljs-keyword\">do</span><br>            <span class=\"hljs-built_in\">sleep</span> 1<br>            cpuUsage=$(get_cpu_usage)<br>            <span class=\"hljs-keyword\">if</span> (( $(echo &quot;<span class=\"hljs-variable\">$cpuUsage</span> &gt; <span class=\"hljs-number\">90</span>&quot; | bc -l) )); <span class=\"hljs-keyword\">then</span><br>                ((high_cpu_duration++))<br>            <span class=\"hljs-keyword\">else</span><br>                high_cpu_duration=0<br>            <span class=\"hljs-keyword\">fi</span><br><br>            <span class=\"hljs-keyword\">if</span> (( high_cpu_duration &gt;= <span class=\"hljs-number\">60</span> )); <span class=\"hljs-keyword\">then</span><br>                <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;CPU使用率持续高于90%超过1分钟，发送警报...&quot;</span><br>                SendDownMessageToDingding<br>                <span class=\"hljs-built_in\">break</span><br>            <span class=\"hljs-keyword\">fi</span><br>        <span class=\"hljs-keyword\">done</span><br>    <span class=\"hljs-keyword\">fi</span><br><br>    <span class=\"hljs-keyword\">if</span> (( $(echo &quot;<span class=\"hljs-variable\">$diskUsage</span> &gt; <span class=\"hljs-number\">80</span>&quot; | bc -l) )) || (( $(echo &quot;<span class=\"hljs-variable\">$mem_used_percent</span> &gt; <span class=\"hljs-number\">80</span>&quot; | bc -l) )); <span class=\"hljs-keyword\">then</span><br>        SendDownMessageToDingding<br>    <span class=\"hljs-keyword\">fi</span><br>&#125;<br><br>check<br><br></code></pre></td></tr></table></figure>\n\n<p>将<code>073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5</code>替换为你从钉钉获取的Webhook URL的token。</p>\n<h3 id=\"3-配置定时任务（cron）\"><a href=\"#3-配置定时任务（cron）\" class=\"headerlink\" title=\"3. 配置定时任务（cron）\"></a>3. 配置定时任务（cron）</h3><p>通过cron定期运行这个脚本。首先，编辑cron配置：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">crontab -e<br></code></pre></td></tr></table></figure>\n\n<p>然后添加以下内容以每分钟运行一次脚本：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">* * * * * /path/to/monitor.sh<br></code></pre></td></tr></table></figure>\n\n<p>确保脚本<code>monitor.sh</code>有执行权限：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\"><span class=\"hljs-built_in\">chmod</span> +x /path/to/monitor.sh<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>上述脚本和cron配置将监控CPU、内存和硬盘使用情况，并在超过设定的阈值时通过钉钉发送告警消息。你可以根据实际需求调整脚本的执行频率和告警阈值。</p>\n","excerpt":"","more":"<p>在Linux系统中，可以使用Shell脚本和定时任务（cron）来监控CPU、内存和硬盘使用情况，当超过指定阈值时发送告警。为了发送钉钉告警，需要用到钉钉的自定义机器人接口。<br>需要注意的是，本教程的机器是12核心。因此需要得到12核心的最高cpu使用率后取最大值。</p>\n<p>以下是实现此功能的步骤：</p>\n<ol>\n<li><p><strong>创建钉钉机器人并获取Webhook URL：</strong></p>\n<ul>\n<li>登录钉钉，创建自定义机器人并获取Webhook URL，用于发送告警信息。</li>\n</ul>\n</li>\n<li><p><strong>编写Shell脚本：</strong></p>\n<ul>\n<li>编写一个Shell脚本来检查系统资源的使用情况，并在超过阈值时发送钉钉告警。</li>\n</ul>\n</li>\n<li><p><strong>配置定时任务（cron）：</strong></p>\n<ul>\n<li>将脚本配置为定时任务，定期检查系统资源的使用情况。</li>\n</ul>\n</li>\n</ol>\n<h3 id=\"1-创建钉钉机器人并获取Webhook-URL\"><a href=\"#1-创建钉钉机器人并获取Webhook-URL\" class=\"headerlink\" title=\"1. 创建钉钉机器人并获取Webhook URL\"></a>1. 创建钉钉机器人并获取Webhook URL</h3><p>在钉钉中创建自定义机器人，记录下Webhook URL，这将在脚本中用于发送告警。</p>\n<ul>\n<li>例如：<a href=\"https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5\">https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5</a></li>\n</ul>\n<h3 id=\"2-编写Shell脚本\"><a href=\"#2-编写Shell脚本\" class=\"headerlink\" title=\"2. 编写Shell脚本\"></a>2. 编写Shell脚本</h3><p>下面是一个示例Shell脚本<code>monitor.sh</code>：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\"><span class=\"hljs-meta\">#!/bin/bash</span><br><br><span class=\"hljs-comment\"># 获取cpu使用率</span><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">get_cpu_usage</span></span>()&#123;<br>    <span class=\"hljs-built_in\">echo</span> $(top -bn1 | grep <span class=\"hljs-string\">&quot;Cpu(s)&quot;</span> | awk <span class=\"hljs-string\">&#x27;&#123;print 100 - $8&#125;&#x27;</span> | awk <span class=\"hljs-string\">&#x27;&#123;printf &quot;%.2f&quot;, $1&#125;&#x27;</span>)<br>&#125;<br><br><span class=\"hljs-comment\"># 获取磁盘使用率</span><br>data_name=<span class=\"hljs-string\">&quot;/&quot;</span> <br>diskUsage=$(<span class=\"hljs-built_in\">df</span> -h | grep -w <span class=\"hljs-variable\">$data_name</span> | awk <span class=\"hljs-string\">&#x27;&#123;print $5&#125;&#x27;</span> | sed <span class=\"hljs-string\">&#x27;s/%//&#x27;</span>)<br><br><span class=\"hljs-comment\"># 获取内存情况</span><br>mem_total=$(free -m | awk <span class=\"hljs-string\">&#x27;NR==2 &#123;print $2&#125;&#x27;</span>)<br>mem_used=$(free -m | awk <span class=\"hljs-string\">&#x27;NR==2 &#123;print $3&#125;&#x27;</span>)<br><br><span class=\"hljs-comment\"># 统计内存使用率</span><br>mem_used_percent=$(<span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;scale=2; (<span class=\"hljs-variable\">$mem_used</span> / <span class=\"hljs-variable\">$mem_total</span>) * 100&quot;</span> | bc)<br><br><span class=\"hljs-comment\"># 获取报警时间</span><br>now_time=$(<span class=\"hljs-built_in\">date</span> <span class=\"hljs-string\">&#x27;+%F %T&#x27;</span>)<br><br>user=<span class=\"hljs-string\">&quot;18857415467&quot;</span><br><br><span class=\"hljs-comment\"># 主机信息</span><br>Date_time=$(<span class=\"hljs-built_in\">date</span> <span class=\"hljs-string\">&quot;+%Y-%m-%d--%H:%M:%S&quot;</span>)<br>IP_addr=$(hostname -I | awk <span class=\"hljs-string\">&#x27;&#123;print $1&#125;&#x27;</span>)<br><br><span class=\"hljs-comment\"># webhook url</span><br>Dingding_Url=<span class=\"hljs-string\">&quot;https://oapi.dingtalk.com/robot/send?access_token=073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5&quot;</span><br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">SendDownMessageToDingding</span></span>()&#123;<br>    <span class=\"hljs-comment\"># 发送钉钉消息</span><br>    curl -s <span class=\"hljs-string\">&quot;<span class=\"hljs-variable\">$&#123;Dingding_Url&#125;</span>&quot;</span> -H <span class=\"hljs-string\">&#x27;Content-Type: application/json&#x27;</span> -d <span class=\"hljs-string\">&quot;</span><br><span class=\"hljs-string\">    &#123;</span><br><span class=\"hljs-string\">     &#x27;msgtype&#x27;: &#x27;text&#x27;,</span><br><span class=\"hljs-string\">     &#x27;text&#x27;: &#123;&#x27;content&#x27;: &#x27;资源耗尽警告！\\n巡查时间：<span class=\"hljs-variable\">$&#123;Date_time&#125;</span>\\nIP地址：<span class=\"hljs-variable\">$&#123;IP_addr&#125;</span>\\n资源状况如下:\\n【CPU使用率：<span class=\"hljs-variable\">$&#123;cpuUsage&#125;</span>%】\\n【磁盘使用率：<span class=\"hljs-variable\">$&#123;diskUsage&#125;</span>%】\\n【内存使用率：<span class=\"hljs-variable\">$&#123;mem_used_percent&#125;</span>%】&#x27;&#125;,</span><br><span class=\"hljs-string\">     &#x27;at&#x27;: &#123;&#x27;atMobiles&#x27;: [&#x27;<span class=\"hljs-variable\">$&#123;user&#125;</span>&#x27;], &#x27;isAtAll&#x27;: true&#125;</span><br><span class=\"hljs-string\">      &#125;&quot;</span><br>&#125;<br><br><span class=\"hljs-keyword\">function</span> <span class=\"hljs-function\"><span class=\"hljs-title\">check</span></span>()&#123;<br>    cpuUsage=$(get_cpu_usage)<br>    <span class=\"hljs-keyword\">if</span> (( $(echo &quot;<span class=\"hljs-variable\">$cpuUsage</span> &gt; <span class=\"hljs-number\">90</span>&quot; | bc -l) )); <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;检测到CPU使用率高于90%，开始1分钟监控...&quot;</span><br>        high_cpu_duration=0<br>        <span class=\"hljs-keyword\">for</span> ((i=<span class=\"hljs-number\">0</span>; i&lt;<span class=\"hljs-number\">60</span>; i++)); <span class=\"hljs-keyword\">do</span><br>            <span class=\"hljs-built_in\">sleep</span> 1<br>            cpuUsage=$(get_cpu_usage)<br>            <span class=\"hljs-keyword\">if</span> (( $(echo &quot;<span class=\"hljs-variable\">$cpuUsage</span> &gt; <span class=\"hljs-number\">90</span>&quot; | bc -l) )); <span class=\"hljs-keyword\">then</span><br>                ((high_cpu_duration++))<br>            <span class=\"hljs-keyword\">else</span><br>                high_cpu_duration=0<br>            <span class=\"hljs-keyword\">fi</span><br><br>            <span class=\"hljs-keyword\">if</span> (( high_cpu_duration &gt;= <span class=\"hljs-number\">60</span> )); <span class=\"hljs-keyword\">then</span><br>                <span class=\"hljs-built_in\">echo</span> <span class=\"hljs-string\">&quot;CPU使用率持续高于90%超过1分钟，发送警报...&quot;</span><br>                SendDownMessageToDingding<br>                <span class=\"hljs-built_in\">break</span><br>            <span class=\"hljs-keyword\">fi</span><br>        <span class=\"hljs-keyword\">done</span><br>    <span class=\"hljs-keyword\">fi</span><br><br>    <span class=\"hljs-keyword\">if</span> (( $(echo &quot;<span class=\"hljs-variable\">$diskUsage</span> &gt; <span class=\"hljs-number\">80</span>&quot; | bc -l) )) || (( $(echo &quot;<span class=\"hljs-variable\">$mem_used_percent</span> &gt; <span class=\"hljs-number\">80</span>&quot; | bc -l) )); <span class=\"hljs-keyword\">then</span><br>        SendDownMessageToDingding<br>    <span class=\"hljs-keyword\">fi</span><br>&#125;<br><br>check<br><br></code></pre></td></tr></table></figure>\n\n<p>将<code>073d84ae5a2f83494c9271e0e1683603130b19e77620a836e3682a62ffd1a8f5</code>替换为你从钉钉获取的Webhook URL的token。</p>\n<h3 id=\"3-配置定时任务（cron）\"><a href=\"#3-配置定时任务（cron）\" class=\"headerlink\" title=\"3. 配置定时任务（cron）\"></a>3. 配置定时任务（cron）</h3><p>通过cron定期运行这个脚本。首先，编辑cron配置：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">crontab -e<br></code></pre></td></tr></table></figure>\n\n<p>然后添加以下内容以每分钟运行一次脚本：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">* * * * * /path/to/monitor.sh<br></code></pre></td></tr></table></figure>\n\n<p>确保脚本<code>monitor.sh</code>有执行权限：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\"><span class=\"hljs-built_in\">chmod</span> +x /path/to/monitor.sh<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>上述脚本和cron配置将监控CPU、内存和硬盘使用情况，并在超过设定的阈值时通过钉钉发送告警消息。你可以根据实际需求调整脚本的执行频率和告警阈值。</p>\n"},{"title":"linux下通过端口找到进程","date":"2024-08-09T06:48:30.000Z","_content":"在Linux系统中，可以使用以下几种方法通过端口号查找占用该端口的进程：\n\n### 1. 使用 `lsof` 命令\n`lsof` 是一个用于列出打开的文件的命令，它也可以用于查找正在使用某个端口的进程。\n\n```bash\nlsof -i :<端口号>\n```\n\n例如，查找占用80端口的进程：\n```bash\nlsof -i :80\n```\n\n### 2. 使用 `netstat` 命令\n`netstat` 是一个网络状态监控工具，可以显示与网络相关的内容，包括哪些进程在监听哪些端口。\n\n```bash\nnetstat -tuln | grep :<端口号>\n```\n\n例如，查找占用80端口的进程：\n```bash\nnetstat -tuln | grep :80\n```\n\n结合 `netstat` 和 `grep` 命令，还可以找到对应的PID：\n```bash\nnetstat -tulnp | grep :<端口号>\n```\n\n### 3. 使用 `ss` 命令\n`ss` 是 `netstat` 的替代品，用于显示socket统计信息，可以更快速地显示网络连接。\n\n```bash\nss -tuln | grep :<端口号>\n```\n\n例如，查找占用80端口的进程：\n```bash\nss -tuln | grep :80\n```\n\n### 4. 使用 `fuser` 命令\n`fuser` 是一个显示哪个进程使用哪些文件或socket的命令。可以直接显示占用指定端口的进程PID。\n\n```bash\nfuser <端口号>/tcp\n```\n\n例如，查找占用80端口的进程：\n```bash\nfuser 80/tcp\n```\n\n### 5. 查看详细的进程信息\n一旦获得了PID，可以使用 `ps` 命令来查看进程的详细信息。\n\n```bash\nps -p <PID> -o pid,cmd\n```\n\n例如：\n```bash\nps -p 1234 -o pid,cmd\n```\n\n这将显示PID为1234的进程的命令行。\n\n通过这些方法，您可以很容易地查找到占用特定端口的进程并获取相应的PID和其他信息。","source":"_posts/linux/linux下通过端口找到进程.md","raw":"---\ntitle: linux下通过端口找到进程\ndate: 2024-08-09 14:48:30\ncategories: linux\ntag: 查找进程\n---\n在Linux系统中，可以使用以下几种方法通过端口号查找占用该端口的进程：\n\n### 1. 使用 `lsof` 命令\n`lsof` 是一个用于列出打开的文件的命令，它也可以用于查找正在使用某个端口的进程。\n\n```bash\nlsof -i :<端口号>\n```\n\n例如，查找占用80端口的进程：\n```bash\nlsof -i :80\n```\n\n### 2. 使用 `netstat` 命令\n`netstat` 是一个网络状态监控工具，可以显示与网络相关的内容，包括哪些进程在监听哪些端口。\n\n```bash\nnetstat -tuln | grep :<端口号>\n```\n\n例如，查找占用80端口的进程：\n```bash\nnetstat -tuln | grep :80\n```\n\n结合 `netstat` 和 `grep` 命令，还可以找到对应的PID：\n```bash\nnetstat -tulnp | grep :<端口号>\n```\n\n### 3. 使用 `ss` 命令\n`ss` 是 `netstat` 的替代品，用于显示socket统计信息，可以更快速地显示网络连接。\n\n```bash\nss -tuln | grep :<端口号>\n```\n\n例如，查找占用80端口的进程：\n```bash\nss -tuln | grep :80\n```\n\n### 4. 使用 `fuser` 命令\n`fuser` 是一个显示哪个进程使用哪些文件或socket的命令。可以直接显示占用指定端口的进程PID。\n\n```bash\nfuser <端口号>/tcp\n```\n\n例如，查找占用80端口的进程：\n```bash\nfuser 80/tcp\n```\n\n### 5. 查看详细的进程信息\n一旦获得了PID，可以使用 `ps` 命令来查看进程的详细信息。\n\n```bash\nps -p <PID> -o pid,cmd\n```\n\n例如：\n```bash\nps -p 1234 -o pid,cmd\n```\n\n这将显示PID为1234的进程的命令行。\n\n通过这些方法，您可以很容易地查找到占用特定端口的进程并获取相应的PID和其他信息。","slug":"linux/linux下通过端口找到进程","published":1,"updated":"2025-02-18T06:31:00.562Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3h00098gjd9bayeq03","content":"<p>在Linux系统中，可以使用以下几种方法通过端口号查找占用该端口的进程：</p>\n<h3 id=\"1-使用-lsof-命令\"><a href=\"#1-使用-lsof-命令\" class=\"headerlink\" title=\"1. 使用 lsof 命令\"></a>1. 使用 <code>lsof</code> 命令</h3><p><code>lsof</code> 是一个用于列出打开的文件的命令，它也可以用于查找正在使用某个端口的进程。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">lsof -i :&lt;端口号&gt;<br></code></pre></td></tr></table></figure>\n\n<p>例如，查找占用80端口的进程：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">lsof -i :80<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-使用-netstat-命令\"><a href=\"#2-使用-netstat-命令\" class=\"headerlink\" title=\"2. 使用 netstat 命令\"></a>2. 使用 <code>netstat</code> 命令</h3><p><code>netstat</code> 是一个网络状态监控工具，可以显示与网络相关的内容，包括哪些进程在监听哪些端口。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">netstat -tuln | grep :&lt;端口号&gt;<br></code></pre></td></tr></table></figure>\n\n<p>例如，查找占用80端口的进程：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">netstat -tuln | grep :80<br></code></pre></td></tr></table></figure>\n\n<p>结合 <code>netstat</code> 和 <code>grep</code> 命令，还可以找到对应的PID：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">netstat -tulnp | grep :&lt;端口号&gt;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-使用-ss-命令\"><a href=\"#3-使用-ss-命令\" class=\"headerlink\" title=\"3. 使用 ss 命令\"></a>3. 使用 <code>ss</code> 命令</h3><p><code>ss</code> 是 <code>netstat</code> 的替代品，用于显示socket统计信息，可以更快速地显示网络连接。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">ss -tuln | grep :&lt;端口号&gt;<br></code></pre></td></tr></table></figure>\n\n<p>例如，查找占用80端口的进程：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">ss -tuln | grep :80<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"4-使用-fuser-命令\"><a href=\"#4-使用-fuser-命令\" class=\"headerlink\" title=\"4. 使用 fuser 命令\"></a>4. 使用 <code>fuser</code> 命令</h3><p><code>fuser</code> 是一个显示哪个进程使用哪些文件或socket的命令。可以直接显示占用指定端口的进程PID。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">fuser &lt;端口号&gt;/tcp<br></code></pre></td></tr></table></figure>\n\n<p>例如，查找占用80端口的进程：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">fuser 80/tcp<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"5-查看详细的进程信息\"><a href=\"#5-查看详细的进程信息\" class=\"headerlink\" title=\"5. 查看详细的进程信息\"></a>5. 查看详细的进程信息</h3><p>一旦获得了PID，可以使用 <code>ps</code> 命令来查看进程的详细信息。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">ps -p &lt;PID&gt; -o pid,cmd<br></code></pre></td></tr></table></figure>\n\n<p>例如：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">ps -p 1234 -o pid,cmd<br></code></pre></td></tr></table></figure>\n\n<p>这将显示PID为1234的进程的命令行。</p>\n<p>通过这些方法，您可以很容易地查找到占用特定端口的进程并获取相应的PID和其他信息。</p>\n","excerpt":"","more":"<p>在Linux系统中，可以使用以下几种方法通过端口号查找占用该端口的进程：</p>\n<h3 id=\"1-使用-lsof-命令\"><a href=\"#1-使用-lsof-命令\" class=\"headerlink\" title=\"1. 使用 lsof 命令\"></a>1. 使用 <code>lsof</code> 命令</h3><p><code>lsof</code> 是一个用于列出打开的文件的命令，它也可以用于查找正在使用某个端口的进程。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">lsof -i :&lt;端口号&gt;<br></code></pre></td></tr></table></figure>\n\n<p>例如，查找占用80端口的进程：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">lsof -i :80<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-使用-netstat-命令\"><a href=\"#2-使用-netstat-命令\" class=\"headerlink\" title=\"2. 使用 netstat 命令\"></a>2. 使用 <code>netstat</code> 命令</h3><p><code>netstat</code> 是一个网络状态监控工具，可以显示与网络相关的内容，包括哪些进程在监听哪些端口。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">netstat -tuln | grep :&lt;端口号&gt;<br></code></pre></td></tr></table></figure>\n\n<p>例如，查找占用80端口的进程：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">netstat -tuln | grep :80<br></code></pre></td></tr></table></figure>\n\n<p>结合 <code>netstat</code> 和 <code>grep</code> 命令，还可以找到对应的PID：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">netstat -tulnp | grep :&lt;端口号&gt;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-使用-ss-命令\"><a href=\"#3-使用-ss-命令\" class=\"headerlink\" title=\"3. 使用 ss 命令\"></a>3. 使用 <code>ss</code> 命令</h3><p><code>ss</code> 是 <code>netstat</code> 的替代品，用于显示socket统计信息，可以更快速地显示网络连接。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">ss -tuln | grep :&lt;端口号&gt;<br></code></pre></td></tr></table></figure>\n\n<p>例如，查找占用80端口的进程：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">ss -tuln | grep :80<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"4-使用-fuser-命令\"><a href=\"#4-使用-fuser-命令\" class=\"headerlink\" title=\"4. 使用 fuser 命令\"></a>4. 使用 <code>fuser</code> 命令</h3><p><code>fuser</code> 是一个显示哪个进程使用哪些文件或socket的命令。可以直接显示占用指定端口的进程PID。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">fuser &lt;端口号&gt;/tcp<br></code></pre></td></tr></table></figure>\n\n<p>例如，查找占用80端口的进程：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">fuser 80/tcp<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"5-查看详细的进程信息\"><a href=\"#5-查看详细的进程信息\" class=\"headerlink\" title=\"5. 查看详细的进程信息\"></a>5. 查看详细的进程信息</h3><p>一旦获得了PID，可以使用 <code>ps</code> 命令来查看进程的详细信息。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">ps -p &lt;PID&gt; -o pid,cmd<br></code></pre></td></tr></table></figure>\n\n<p>例如：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">ps -p 1234 -o pid,cmd<br></code></pre></td></tr></table></figure>\n\n<p>这将显示PID为1234的进程的命令行。</p>\n<p>通过这些方法，您可以很容易地查找到占用特定端口的进程并获取相应的PID和其他信息。</p>\n"},{"title":"openvpn中使用client1访问xxx域名时，走client2的网络流量来访问","date":"2024-10-10T03:40:10.000Z","_content":"要让一个 OpenVPN 客户端（client1）通过另一个客户端（client2）的网络流量访问特定域名（如 xxx 域名），你可以采取以下步骤：\n\n1. **在 client2 上设置路由**：\n   确保 client2 的 OpenVPN 配置中允许其他客户端通过它进行路由。你需要在 server.conf 中添加以下行：\n\n   ```plaintext\n   client-to-client\n   ```\n\n   这将允许客户端之间的直接通信。\n\n2. **在 client1 上设置路由**：\n   在 client1 的 OpenVPN 配置文件中，你需要添加一条静态路由，让它的流量通过 client2。你可以通过以下方式实现：\n\n    - 在 client1 的配置文件中添加如下内容（假设 client2 的 IP 是 10.8.0.2）：\n\n      ```plaintext\n      route xxx 255.255.255.255 net_gateway\n      ```\n\n    - 如果 client2 的 IP 不是 10.8.0.2，请用实际的 IP 替换。\n\n3. **使用 iptables 或其他工具进行流量转发**：\n   在 client2 上，你可能需要设置 iptables 规则，以便将来自 client1 的流量转发到外部网络。以下是一个简单的规则示例：\n\n   ```bash\n   iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE\n   ```\n\n   确保 `10.8.0.0/24` 替换为你的 VPN 子网。\n\n4. **修改 DNS 解析**：\n   你可能需要在 client1 上修改 DNS 设置，确保它可以正确解析 xxx 域名。你可以在 OpenVPN 配置中添加以下行：\n\n   ```plaintext\n   dhcp-option DNS 8.8.8.8\n   ```\n\n   替换成你想使用的 DNS 服务器。\n\n5. **测试连接**：\n   重启 OpenVPN 客户端，并测试 client1 是否能够通过 client2 的网络访问 xxx 域名。\n\n确保在进行这些更改时备份你的配置文件，以防需要恢复。如果遇到任何问题，可以查看 OpenVPN 的日志以获取更多信息。","source":"_posts/linux/openvpn中使用client1访问xxx域名时，走client2的网络流量来访问.md","raw":"---\ntitle: openvpn中使用client1访问xxx域名时，走client2的网络流量来访问\ndate: 2024-10-10 11:40:10\ncategories: linux\ntag: openvpn\n---\n要让一个 OpenVPN 客户端（client1）通过另一个客户端（client2）的网络流量访问特定域名（如 xxx 域名），你可以采取以下步骤：\n\n1. **在 client2 上设置路由**：\n   确保 client2 的 OpenVPN 配置中允许其他客户端通过它进行路由。你需要在 server.conf 中添加以下行：\n\n   ```plaintext\n   client-to-client\n   ```\n\n   这将允许客户端之间的直接通信。\n\n2. **在 client1 上设置路由**：\n   在 client1 的 OpenVPN 配置文件中，你需要添加一条静态路由，让它的流量通过 client2。你可以通过以下方式实现：\n\n    - 在 client1 的配置文件中添加如下内容（假设 client2 的 IP 是 10.8.0.2）：\n\n      ```plaintext\n      route xxx 255.255.255.255 net_gateway\n      ```\n\n    - 如果 client2 的 IP 不是 10.8.0.2，请用实际的 IP 替换。\n\n3. **使用 iptables 或其他工具进行流量转发**：\n   在 client2 上，你可能需要设置 iptables 规则，以便将来自 client1 的流量转发到外部网络。以下是一个简单的规则示例：\n\n   ```bash\n   iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE\n   ```\n\n   确保 `10.8.0.0/24` 替换为你的 VPN 子网。\n\n4. **修改 DNS 解析**：\n   你可能需要在 client1 上修改 DNS 设置，确保它可以正确解析 xxx 域名。你可以在 OpenVPN 配置中添加以下行：\n\n   ```plaintext\n   dhcp-option DNS 8.8.8.8\n   ```\n\n   替换成你想使用的 DNS 服务器。\n\n5. **测试连接**：\n   重启 OpenVPN 客户端，并测试 client1 是否能够通过 client2 的网络访问 xxx 域名。\n\n确保在进行这些更改时备份你的配置文件，以防需要恢复。如果遇到任何问题，可以查看 OpenVPN 的日志以获取更多信息。","slug":"linux/openvpn中使用client1访问xxx域名时，走client2的网络流量来访问","published":1,"updated":"2025-02-18T06:28:41.773Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3h000d8gjdcj5neqao","content":"<p>要让一个 OpenVPN 客户端（client1）通过另一个客户端（client2）的网络流量访问特定域名（如 xxx 域名），你可以采取以下步骤：</p>\n<ol>\n<li><p><strong>在 client2 上设置路由</strong>：<br>确保 client2 的 OpenVPN 配置中允许其他客户端通过它进行路由。你需要在 server.conf 中添加以下行：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plaintext\">client-to-client<br></code></pre></td></tr></table></figure>\n\n<p>这将允许客户端之间的直接通信。</p>\n</li>\n<li><p><strong>在 client1 上设置路由</strong>：<br>在 client1 的 OpenVPN 配置文件中，你需要添加一条静态路由，让它的流量通过 client2。你可以通过以下方式实现：</p>\n<ul>\n<li><p>在 client1 的配置文件中添加如下内容（假设 client2 的 IP 是 10.8.0.2）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plaintext\">route xxx 255.255.255.255 net_gateway<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>如果 client2 的 IP 不是 10.8.0.2，请用实际的 IP 替换。</p>\n</li>\n</ul>\n</li>\n<li><p><strong>使用 iptables 或其他工具进行流量转发</strong>：<br>在 client2 上，你可能需要设置 iptables 规则，以便将来自 client1 的流量转发到外部网络。以下是一个简单的规则示例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE<br></code></pre></td></tr></table></figure>\n\n<p>确保 <code>10.8.0.0/24</code> 替换为你的 VPN 子网。</p>\n</li>\n<li><p><strong>修改 DNS 解析</strong>：<br>你可能需要在 client1 上修改 DNS 设置，确保它可以正确解析 xxx 域名。你可以在 OpenVPN 配置中添加以下行：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plaintext\">dhcp-option DNS 8.8.8.8<br></code></pre></td></tr></table></figure>\n\n<p>替换成你想使用的 DNS 服务器。</p>\n</li>\n<li><p><strong>测试连接</strong>：<br>重启 OpenVPN 客户端，并测试 client1 是否能够通过 client2 的网络访问 xxx 域名。</p>\n</li>\n</ol>\n<p>确保在进行这些更改时备份你的配置文件，以防需要恢复。如果遇到任何问题，可以查看 OpenVPN 的日志以获取更多信息。</p>\n","excerpt":"","more":"<p>要让一个 OpenVPN 客户端（client1）通过另一个客户端（client2）的网络流量访问特定域名（如 xxx 域名），你可以采取以下步骤：</p>\n<ol>\n<li><p><strong>在 client2 上设置路由</strong>：<br>确保 client2 的 OpenVPN 配置中允许其他客户端通过它进行路由。你需要在 server.conf 中添加以下行：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plaintext\">client-to-client<br></code></pre></td></tr></table></figure>\n\n<p>这将允许客户端之间的直接通信。</p>\n</li>\n<li><p><strong>在 client1 上设置路由</strong>：<br>在 client1 的 OpenVPN 配置文件中，你需要添加一条静态路由，让它的流量通过 client2。你可以通过以下方式实现：</p>\n<ul>\n<li><p>在 client1 的配置文件中添加如下内容（假设 client2 的 IP 是 10.8.0.2）：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plaintext\">route xxx 255.255.255.255 net_gateway<br></code></pre></td></tr></table></figure>\n</li>\n<li><p>如果 client2 的 IP 不是 10.8.0.2，请用实际的 IP 替换。</p>\n</li>\n</ul>\n</li>\n<li><p><strong>使用 iptables 或其他工具进行流量转发</strong>：<br>在 client2 上，你可能需要设置 iptables 规则，以便将来自 client1 的流量转发到外部网络。以下是一个简单的规则示例：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j MASQUERADE<br></code></pre></td></tr></table></figure>\n\n<p>确保 <code>10.8.0.0/24</code> 替换为你的 VPN 子网。</p>\n</li>\n<li><p><strong>修改 DNS 解析</strong>：<br>你可能需要在 client1 上修改 DNS 设置，确保它可以正确解析 xxx 域名。你可以在 OpenVPN 配置中添加以下行：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs plaintext\">dhcp-option DNS 8.8.8.8<br></code></pre></td></tr></table></figure>\n\n<p>替换成你想使用的 DNS 服务器。</p>\n</li>\n<li><p><strong>测试连接</strong>：<br>重启 OpenVPN 客户端，并测试 client1 是否能够通过 client2 的网络访问 xxx 域名。</p>\n</li>\n</ol>\n<p>确保在进行这些更改时备份你的配置文件，以防需要恢复。如果遇到任何问题，可以查看 OpenVPN 的日志以获取更多信息。</p>\n"},{"title":"tcp6 如何 改成tcp4","date":"2024-07-25T09:36:35.000Z","_content":"要将 TCP6（IPv6）转换为 TCP4（IPv4），具体步骤取决于你想要转换的上下文。例如，你可能想要在服务器配置、网络服务配置或者应用程序中进行这种转换。以下是几种常见的方法：\n\n### 1. 修改系统配置\n如果你的系统默认使用 IPv6，你可以通过修改系统配置来优先使用 IPv4。\n\n#### Linux\n编辑 `/etc/gai.conf` 文件，取消 `precedence ::ffff:0:0/96  100` 的注释。这会让系统优先使用 IPv4。\n\n```bash\nsudo nano /etc/gai.conf\n```\n\n取消下面这行的注释：\n```bash\nprecedence ::ffff:0:0/96  100\n```\n\n#### Windows\n可以通过命令行禁用IPv6：\n```bash\nnetsh interface ipv6 set prefixpolicy ::ffff:0:0/96  40 1\n```\n\n### 2. 配置网络服务\n对于具体的网络服务，你可以在配置文件中指定使用 IPv4。\n\n#### Nginx\n在 Nginx 配置文件中，你可以指定服务器监听的 IP 地址为 IPv4 地址。例如：\n\n```nginx\nserver {\n    listen 80;\n    listen [::]:80 ipv6only=off;\n    ...\n}\n```\n\n将上面的配置改为仅监听 IPv4 地址：\n```nginx\nserver {\n    listen 80;\n    ...\n}\n```\n\n#### Apache\n在 Apache 的配置文件中，你可以指定监听的 IP 地址：\n\n```apache\nListen 80\nListen [::]:80\n```\n\n将上面的配置改为仅监听 IPv4 地址：\n```apache\nListen 80\n```\n\n### 3. 修改应用程序配置\n对于某些应用程序，你可能需要修改代码或配置文件以确保它们仅使用 IPv4。\n\n#### Python\n在 Python 应用中，你可以通过 `socket` 模块指定仅使用 IPv4：\n\n```python\nimport socket\n\n# 创建一个IPv4的TCP socket\nsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\nsock.bind(('0.0.0.0', 8080))\nsock.listen(5)\n```\n\n#### Java\n在 Java 应用中，你可以设置 `java.net.preferIPv4Stack` 系统属性：\n\n```java\npublic class Main {\n    public static void main(String[] args) {\n        System.setProperty(\"java.net.preferIPv4Stack\", \"true\");\n        // 其他代码\n    }\n}\n```\n\n### 总结\n具体的方法取决于你的具体需求和环境。在一般情况下，配置文件和系统设置通常可以解决大多数问题。如果你有更具体的应用或环境，请提供更多详细信息，我可以提供更具体的指导。","source":"_posts/linux/tcp6-如何-改成tcp4.md","raw":"---\ntitle: tcp6 如何 改成tcp4\ndate: 2024-07-25 17:36:35\ncategories: linux\ntag: 网络\n---\n要将 TCP6（IPv6）转换为 TCP4（IPv4），具体步骤取决于你想要转换的上下文。例如，你可能想要在服务器配置、网络服务配置或者应用程序中进行这种转换。以下是几种常见的方法：\n\n### 1. 修改系统配置\n如果你的系统默认使用 IPv6，你可以通过修改系统配置来优先使用 IPv4。\n\n#### Linux\n编辑 `/etc/gai.conf` 文件，取消 `precedence ::ffff:0:0/96  100` 的注释。这会让系统优先使用 IPv4。\n\n```bash\nsudo nano /etc/gai.conf\n```\n\n取消下面这行的注释：\n```bash\nprecedence ::ffff:0:0/96  100\n```\n\n#### Windows\n可以通过命令行禁用IPv6：\n```bash\nnetsh interface ipv6 set prefixpolicy ::ffff:0:0/96  40 1\n```\n\n### 2. 配置网络服务\n对于具体的网络服务，你可以在配置文件中指定使用 IPv4。\n\n#### Nginx\n在 Nginx 配置文件中，你可以指定服务器监听的 IP 地址为 IPv4 地址。例如：\n\n```nginx\nserver {\n    listen 80;\n    listen [::]:80 ipv6only=off;\n    ...\n}\n```\n\n将上面的配置改为仅监听 IPv4 地址：\n```nginx\nserver {\n    listen 80;\n    ...\n}\n```\n\n#### Apache\n在 Apache 的配置文件中，你可以指定监听的 IP 地址：\n\n```apache\nListen 80\nListen [::]:80\n```\n\n将上面的配置改为仅监听 IPv4 地址：\n```apache\nListen 80\n```\n\n### 3. 修改应用程序配置\n对于某些应用程序，你可能需要修改代码或配置文件以确保它们仅使用 IPv4。\n\n#### Python\n在 Python 应用中，你可以通过 `socket` 模块指定仅使用 IPv4：\n\n```python\nimport socket\n\n# 创建一个IPv4的TCP socket\nsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\nsock.bind(('0.0.0.0', 8080))\nsock.listen(5)\n```\n\n#### Java\n在 Java 应用中，你可以设置 `java.net.preferIPv4Stack` 系统属性：\n\n```java\npublic class Main {\n    public static void main(String[] args) {\n        System.setProperty(\"java.net.preferIPv4Stack\", \"true\");\n        // 其他代码\n    }\n}\n```\n\n### 总结\n具体的方法取决于你的具体需求和环境。在一般情况下，配置文件和系统设置通常可以解决大多数问题。如果你有更具体的应用或环境，请提供更多详细信息，我可以提供更具体的指导。","slug":"linux/tcp6-如何-改成tcp4","published":1,"updated":"2025-02-18T06:28:00.123Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3i000e8gjd70apegn2","content":"<p>要将 TCP6（IPv6）转换为 TCP4（IPv4），具体步骤取决于你想要转换的上下文。例如，你可能想要在服务器配置、网络服务配置或者应用程序中进行这种转换。以下是几种常见的方法：</p>\n<h3 id=\"1-修改系统配置\"><a href=\"#1-修改系统配置\" class=\"headerlink\" title=\"1. 修改系统配置\"></a>1. 修改系统配置</h3><p>如果你的系统默认使用 IPv6，你可以通过修改系统配置来优先使用 IPv4。</p>\n<h4 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h4><p>编辑 <code>/etc/gai.conf</code> 文件，取消 <code>precedence ::ffff:0:0/96  100</code> 的注释。这会让系统优先使用 IPv4。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo nano /etc/gai.conf<br></code></pre></td></tr></table></figure>\n\n<p>取消下面这行的注释：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">precedence ::ffff:0:0/96  100<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"Windows\"><a href=\"#Windows\" class=\"headerlink\" title=\"Windows\"></a>Windows</h4><p>可以通过命令行禁用IPv6：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">netsh interface ipv6 <span class=\"hljs-built_in\">set</span> prefixpolicy ::ffff:0:0/96  40 1<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置网络服务\"><a href=\"#2-配置网络服务\" class=\"headerlink\" title=\"2. 配置网络服务\"></a>2. 配置网络服务</h3><p>对于具体的网络服务，你可以在配置文件中指定使用 IPv4。</p>\n<h4 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h4><p>在 Nginx 配置文件中，你可以指定服务器监听的 IP 地址为 IPv4 地址。例如：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">server</span> &#123;<br>    <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">80</span>;<br>    <span class=\"hljs-attribute\">listen</span> [::]:<span class=\"hljs-number\">80</span> ipv6only=<span class=\"hljs-literal\">off</span>;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>将上面的配置改为仅监听 IPv4 地址：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">server</span> &#123;<br>    <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">80</span>;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"Apache\"><a href=\"#Apache\" class=\"headerlink\" title=\"Apache\"></a>Apache</h4><p>在 Apache 的配置文件中，你可以指定监听的 IP 地址：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">Listen</span> <span class=\"hljs-number\">80</span><br><span class=\"hljs-attribute\">Listen</span><span class=\"hljs-meta\"> [::]:80</span><br></code></pre></td></tr></table></figure>\n\n<p>将上面的配置改为仅监听 IPv4 地址：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">Listen</span> <span class=\"hljs-number\">80</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-修改应用程序配置\"><a href=\"#3-修改应用程序配置\" class=\"headerlink\" title=\"3. 修改应用程序配置\"></a>3. 修改应用程序配置</h3><p>对于某些应用程序，你可能需要修改代码或配置文件以确保它们仅使用 IPv4。</p>\n<h4 id=\"Python\"><a href=\"#Python\" class=\"headerlink\" title=\"Python\"></a>Python</h4><p>在 Python 应用中，你可以通过 <code>socket</code> 模块指定仅使用 IPv4：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> socket<br><br><span class=\"hljs-comment\"># 创建一个IPv4的TCP socket</span><br>sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>sock.bind((<span class=\"hljs-string\">&#x27;0.0.0.0&#x27;</span>, <span class=\"hljs-number\">8080</span>))<br>sock.listen(<span class=\"hljs-number\">5</span>)<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h4><p>在 Java 应用中，你可以设置 <code>java.net.preferIPv4Stack</code> 系统属性：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Main</span> &#123;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> &#123;<br>        System.setProperty(<span class=\"hljs-string\">&quot;java.net.preferIPv4Stack&quot;</span>, <span class=\"hljs-string\">&quot;true&quot;</span>);<br>        <span class=\"hljs-comment\">// 其他代码</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>具体的方法取决于你的具体需求和环境。在一般情况下，配置文件和系统设置通常可以解决大多数问题。如果你有更具体的应用或环境，请提供更多详细信息，我可以提供更具体的指导。</p>\n","excerpt":"","more":"<p>要将 TCP6（IPv6）转换为 TCP4（IPv4），具体步骤取决于你想要转换的上下文。例如，你可能想要在服务器配置、网络服务配置或者应用程序中进行这种转换。以下是几种常见的方法：</p>\n<h3 id=\"1-修改系统配置\"><a href=\"#1-修改系统配置\" class=\"headerlink\" title=\"1. 修改系统配置\"></a>1. 修改系统配置</h3><p>如果你的系统默认使用 IPv6，你可以通过修改系统配置来优先使用 IPv4。</p>\n<h4 id=\"Linux\"><a href=\"#Linux\" class=\"headerlink\" title=\"Linux\"></a>Linux</h4><p>编辑 <code>/etc/gai.conf</code> 文件，取消 <code>precedence ::ffff:0:0/96  100</code> 的注释。这会让系统优先使用 IPv4。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo nano /etc/gai.conf<br></code></pre></td></tr></table></figure>\n\n<p>取消下面这行的注释：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">precedence ::ffff:0:0/96  100<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"Windows\"><a href=\"#Windows\" class=\"headerlink\" title=\"Windows\"></a>Windows</h4><p>可以通过命令行禁用IPv6：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">netsh interface ipv6 <span class=\"hljs-built_in\">set</span> prefixpolicy ::ffff:0:0/96  40 1<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置网络服务\"><a href=\"#2-配置网络服务\" class=\"headerlink\" title=\"2. 配置网络服务\"></a>2. 配置网络服务</h3><p>对于具体的网络服务，你可以在配置文件中指定使用 IPv4。</p>\n<h4 id=\"Nginx\"><a href=\"#Nginx\" class=\"headerlink\" title=\"Nginx\"></a>Nginx</h4><p>在 Nginx 配置文件中，你可以指定服务器监听的 IP 地址为 IPv4 地址。例如：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">server</span> &#123;<br>    <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">80</span>;<br>    <span class=\"hljs-attribute\">listen</span> [::]:<span class=\"hljs-number\">80</span> ipv6only=<span class=\"hljs-literal\">off</span>;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>将上面的配置改为仅监听 IPv4 地址：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">server</span> &#123;<br>    <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">80</span>;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"Apache\"><a href=\"#Apache\" class=\"headerlink\" title=\"Apache\"></a>Apache</h4><p>在 Apache 的配置文件中，你可以指定监听的 IP 地址：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">Listen</span> <span class=\"hljs-number\">80</span><br><span class=\"hljs-attribute\">Listen</span><span class=\"hljs-meta\"> [::]:80</span><br></code></pre></td></tr></table></figure>\n\n<p>将上面的配置改为仅监听 IPv4 地址：</p>\n<figure class=\"highlight apache\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs apache\"><span class=\"hljs-attribute\">Listen</span> <span class=\"hljs-number\">80</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-修改应用程序配置\"><a href=\"#3-修改应用程序配置\" class=\"headerlink\" title=\"3. 修改应用程序配置\"></a>3. 修改应用程序配置</h3><p>对于某些应用程序，你可能需要修改代码或配置文件以确保它们仅使用 IPv4。</p>\n<h4 id=\"Python\"><a href=\"#Python\" class=\"headerlink\" title=\"Python\"></a>Python</h4><p>在 Python 应用中，你可以通过 <code>socket</code> 模块指定仅使用 IPv4：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs python\"><span class=\"hljs-keyword\">import</span> socket<br><br><span class=\"hljs-comment\"># 创建一个IPv4的TCP socket</span><br>sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br>sock.bind((<span class=\"hljs-string\">&#x27;0.0.0.0&#x27;</span>, <span class=\"hljs-number\">8080</span>))<br>sock.listen(<span class=\"hljs-number\">5</span>)<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"Java\"><a href=\"#Java\" class=\"headerlink\" title=\"Java\"></a>Java</h4><p>在 Java 应用中，你可以设置 <code>java.net.preferIPv4Stack</code> 系统属性：</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">Main</span> &#123;<br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">main</span><span class=\"hljs-params\">(String[] args)</span> &#123;<br>        System.setProperty(<span class=\"hljs-string\">&quot;java.net.preferIPv4Stack&quot;</span>, <span class=\"hljs-string\">&quot;true&quot;</span>);<br>        <span class=\"hljs-comment\">// 其他代码</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>具体的方法取决于你的具体需求和环境。在一般情况下，配置文件和系统设置通常可以解决大多数问题。如果你有更具体的应用或环境，请提供更多详细信息，我可以提供更具体的指导。</p>\n"},{"title":"nginx配置上传文件大小","date":"2024-07-24T08:34:06.000Z","_content":"要在Nginx中配置上传文件，您需要对Nginx的配置文件进行一些修改。以下是一个示例配置，说明如何配置Nginx以支持文件上传：\n\n1. **配置Nginx处理上传文件的大小限制：**\n\n   打开您的Nginx配置文件（通常位于 `/etc/nginx/nginx.conf` 或 `/etc/nginx/conf.d/default.conf`）并找到 `http` 块或 `server` 块。\n\n   ```nginx\n   http {\n       # 其他配置...\n       \n       # 设置客户端上传文件的最大限制（单位：字节）\n       client_max_body_size 50M;\n\n       server {\n           listen 80;\n           server_name example.com;\n\n           # 其他配置...\n\n           location /upload {\n               # 将文件上传到指定的目录\n               root /var/www/uploads;\n\n               # 其他配置...\n           }\n       }\n   }\n   ```\n\n   在这个示例中，`client_max_body_size` 被设置为 `50M`，这意味着客户端可以上传最大为50MB的文件。\n\n2. **配置上传文件的保存路径：**\n\n   您可以在 `location` 块中指定文件上传的路径。例如，上面的示例中，上传的文件将被保存到 `/var/www/uploads` 目录。\n\n3. **重启Nginx以使配置生效：**\n\n   修改完配置文件后，需要重启Nginx服务以使配置生效。\n\n   ```sh\n   sudo systemctl restart nginx\n   ```\n\n4. **处理上传的文件：**\n\n   需要注意的是，Nginx本身不会处理上传的文件，您需要在后端应用中处理这些文件。例如，您可以使用PHP、Python、Node.js等语言在后端处理文件上传。\n\n   这是一个使用PHP处理文件上传的简单示例：\n\n   ```php\n   <?php\n   if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_FILES['file'])) {\n       $uploadDir = '/var/www/uploads/';\n       $uploadFile = $uploadDir . basename($_FILES['file']['name']);\n\n       if (move_uploaded_file($_FILES['file']['tmp_name'], $uploadFile)) {\n           echo \"文件上传成功。\";\n       } else {\n           echo \"文件上传失败。\";\n       }\n   }\n   ?>\n   ```\n\n   然后在Nginx的配置文件中，您可以配置一个 `location` 块来处理文件上传请求：\n\n   ```nginx\n   location /upload {\n       root /var/www/uploads;\n\n       # 代理到后端PHP脚本\n       fastcgi_pass 127.0.0.1:9000;\n       include fastcgi_params;\n       fastcgi_param SCRIPT_FILENAME /var/www/html/upload.php;\n   }\n   ```\n","source":"_posts/linux/nginx配置上传文件大小.md","raw":"---\ntitle: nginx配置上传文件大小\ndate: 2024-07-24 16:34:06\ncategories: linux\ntag: nginx\n---\n要在Nginx中配置上传文件，您需要对Nginx的配置文件进行一些修改。以下是一个示例配置，说明如何配置Nginx以支持文件上传：\n\n1. **配置Nginx处理上传文件的大小限制：**\n\n   打开您的Nginx配置文件（通常位于 `/etc/nginx/nginx.conf` 或 `/etc/nginx/conf.d/default.conf`）并找到 `http` 块或 `server` 块。\n\n   ```nginx\n   http {\n       # 其他配置...\n       \n       # 设置客户端上传文件的最大限制（单位：字节）\n       client_max_body_size 50M;\n\n       server {\n           listen 80;\n           server_name example.com;\n\n           # 其他配置...\n\n           location /upload {\n               # 将文件上传到指定的目录\n               root /var/www/uploads;\n\n               # 其他配置...\n           }\n       }\n   }\n   ```\n\n   在这个示例中，`client_max_body_size` 被设置为 `50M`，这意味着客户端可以上传最大为50MB的文件。\n\n2. **配置上传文件的保存路径：**\n\n   您可以在 `location` 块中指定文件上传的路径。例如，上面的示例中，上传的文件将被保存到 `/var/www/uploads` 目录。\n\n3. **重启Nginx以使配置生效：**\n\n   修改完配置文件后，需要重启Nginx服务以使配置生效。\n\n   ```sh\n   sudo systemctl restart nginx\n   ```\n\n4. **处理上传的文件：**\n\n   需要注意的是，Nginx本身不会处理上传的文件，您需要在后端应用中处理这些文件。例如，您可以使用PHP、Python、Node.js等语言在后端处理文件上传。\n\n   这是一个使用PHP处理文件上传的简单示例：\n\n   ```php\n   <?php\n   if ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_FILES['file'])) {\n       $uploadDir = '/var/www/uploads/';\n       $uploadFile = $uploadDir . basename($_FILES['file']['name']);\n\n       if (move_uploaded_file($_FILES['file']['tmp_name'], $uploadFile)) {\n           echo \"文件上传成功。\";\n       } else {\n           echo \"文件上传失败。\";\n       }\n   }\n   ?>\n   ```\n\n   然后在Nginx的配置文件中，您可以配置一个 `location` 块来处理文件上传请求：\n\n   ```nginx\n   location /upload {\n       root /var/www/uploads;\n\n       # 代理到后端PHP脚本\n       fastcgi_pass 127.0.0.1:9000;\n       include fastcgi_params;\n       fastcgi_param SCRIPT_FILENAME /var/www/html/upload.php;\n   }\n   ```\n","slug":"linux/nginx配置上传文件大小","published":1,"updated":"2025-02-18T06:29:12.455Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3j000i8gjdgn1ka85m","content":"<p>要在Nginx中配置上传文件，您需要对Nginx的配置文件进行一些修改。以下是一个示例配置，说明如何配置Nginx以支持文件上传：</p>\n<ol>\n<li><p><strong>配置Nginx处理上传文件的大小限制：</strong></p>\n<p>打开您的Nginx配置文件（通常位于 <code>/etc/nginx/nginx.conf</code> 或 <code>/etc/nginx/conf.d/default.conf</code>）并找到 <code>http</code> 块或 <code>server</code> 块。</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">http</span> &#123;<br>    <span class=\"hljs-comment\"># 其他配置...</span><br>    <br>    <span class=\"hljs-comment\"># 设置客户端上传文件的最大限制（单位：字节）</span><br>    <span class=\"hljs-attribute\">client_max_body_size</span> <span class=\"hljs-number\">50M</span>;<br><br>    <span class=\"hljs-section\">server</span> &#123;<br>        <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">80</span>;<br>        <span class=\"hljs-attribute\">server_name</span> example.com;<br><br>        <span class=\"hljs-comment\"># 其他配置...</span><br><br>        <span class=\"hljs-section\">location</span> /upload &#123;<br>            <span class=\"hljs-comment\"># 将文件上传到指定的目录</span><br>            <span class=\"hljs-attribute\">root</span> /var/www/uploads;<br><br>            <span class=\"hljs-comment\"># 其他配置...</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在这个示例中，<code>client_max_body_size</code> 被设置为 <code>50M</code>，这意味着客户端可以上传最大为50MB的文件。</p>\n</li>\n<li><p><strong>配置上传文件的保存路径：</strong></p>\n<p>您可以在 <code>location</code> 块中指定文件上传的路径。例如，上面的示例中，上传的文件将被保存到 <code>/var/www/uploads</code> 目录。</p>\n</li>\n<li><p><strong>重启Nginx以使配置生效：</strong></p>\n<p>修改完配置文件后，需要重启Nginx服务以使配置生效。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">sudo systemctl restart nginx<br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>处理上传的文件：</strong></p>\n<p>需要注意的是，Nginx本身不会处理上传的文件，您需要在后端应用中处理这些文件。例如，您可以使用PHP、Python、Node.js等语言在后端处理文件上传。</p>\n<p>这是一个使用PHP处理文件上传的简单示例：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs php\"><span class=\"hljs-meta\">&lt;?php</span><br><span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$_SERVER</span>[<span class=\"hljs-string\">&#x27;REQUEST_METHOD&#x27;</span>] == <span class=\"hljs-string\">&#x27;POST&#x27;</span> &amp;&amp; <span class=\"hljs-keyword\">isset</span>(<span class=\"hljs-variable\">$_FILES</span>[<span class=\"hljs-string\">&#x27;file&#x27;</span>])) &#123;<br>    <span class=\"hljs-variable\">$uploadDir</span> = <span class=\"hljs-string\">&#x27;/var/www/uploads/&#x27;</span>;<br>    <span class=\"hljs-variable\">$uploadFile</span> = <span class=\"hljs-variable\">$uploadDir</span> . <span class=\"hljs-title function_ invoke__\">basename</span>(<span class=\"hljs-variable\">$_FILES</span>[<span class=\"hljs-string\">&#x27;file&#x27;</span>][<span class=\"hljs-string\">&#x27;name&#x27;</span>]);<br><br>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_ invoke__\">move_uploaded_file</span>(<span class=\"hljs-variable\">$_FILES</span>[<span class=\"hljs-string\">&#x27;file&#x27;</span>][<span class=\"hljs-string\">&#x27;tmp_name&#x27;</span>], <span class=\"hljs-variable\">$uploadFile</span>)) &#123;<br>        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">&quot;文件上传成功。&quot;</span>;<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">&quot;文件上传失败。&quot;</span>;<br>    &#125;<br>&#125;<br><span class=\"hljs-meta\">?&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>然后在Nginx的配置文件中，您可以配置一个 <code>location</code> 块来处理文件上传请求：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">location</span> /upload &#123;<br>    <span class=\"hljs-attribute\">root</span> /var/www/uploads;<br><br>    <span class=\"hljs-comment\"># 代理到后端PHP脚本</span><br>    <span class=\"hljs-attribute\">fastcgi_pass</span> <span class=\"hljs-number\">127.0.0.1:9000</span>;<br>    <span class=\"hljs-attribute\">include</span> fastcgi_params;<br>    <span class=\"hljs-attribute\">fastcgi_param</span> SCRIPT_FILENAME /var/www/html/upload.php;<br>&#125;<br></code></pre></td></tr></table></figure></li>\n</ol>\n","excerpt":"","more":"<p>要在Nginx中配置上传文件，您需要对Nginx的配置文件进行一些修改。以下是一个示例配置，说明如何配置Nginx以支持文件上传：</p>\n<ol>\n<li><p><strong>配置Nginx处理上传文件的大小限制：</strong></p>\n<p>打开您的Nginx配置文件（通常位于 <code>/etc/nginx/nginx.conf</code> 或 <code>/etc/nginx/conf.d/default.conf</code>）并找到 <code>http</code> 块或 <code>server</code> 块。</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">http</span> &#123;<br>    <span class=\"hljs-comment\"># 其他配置...</span><br>    <br>    <span class=\"hljs-comment\"># 设置客户端上传文件的最大限制（单位：字节）</span><br>    <span class=\"hljs-attribute\">client_max_body_size</span> <span class=\"hljs-number\">50M</span>;<br><br>    <span class=\"hljs-section\">server</span> &#123;<br>        <span class=\"hljs-attribute\">listen</span> <span class=\"hljs-number\">80</span>;<br>        <span class=\"hljs-attribute\">server_name</span> example.com;<br><br>        <span class=\"hljs-comment\"># 其他配置...</span><br><br>        <span class=\"hljs-section\">location</span> /upload &#123;<br>            <span class=\"hljs-comment\"># 将文件上传到指定的目录</span><br>            <span class=\"hljs-attribute\">root</span> /var/www/uploads;<br><br>            <span class=\"hljs-comment\"># 其他配置...</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在这个示例中，<code>client_max_body_size</code> 被设置为 <code>50M</code>，这意味着客户端可以上传最大为50MB的文件。</p>\n</li>\n<li><p><strong>配置上传文件的保存路径：</strong></p>\n<p>您可以在 <code>location</code> 块中指定文件上传的路径。例如，上面的示例中，上传的文件将被保存到 <code>/var/www/uploads</code> 目录。</p>\n</li>\n<li><p><strong>重启Nginx以使配置生效：</strong></p>\n<p>修改完配置文件后，需要重启Nginx服务以使配置生效。</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">sudo systemctl restart nginx<br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>处理上传的文件：</strong></p>\n<p>需要注意的是，Nginx本身不会处理上传的文件，您需要在后端应用中处理这些文件。例如，您可以使用PHP、Python、Node.js等语言在后端处理文件上传。</p>\n<p>这是一个使用PHP处理文件上传的简单示例：</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs php\"><span class=\"hljs-meta\">&lt;?php</span><br><span class=\"hljs-keyword\">if</span> (<span class=\"hljs-variable\">$_SERVER</span>[<span class=\"hljs-string\">&#x27;REQUEST_METHOD&#x27;</span>] == <span class=\"hljs-string\">&#x27;POST&#x27;</span> &amp;&amp; <span class=\"hljs-keyword\">isset</span>(<span class=\"hljs-variable\">$_FILES</span>[<span class=\"hljs-string\">&#x27;file&#x27;</span>])) &#123;<br>    <span class=\"hljs-variable\">$uploadDir</span> = <span class=\"hljs-string\">&#x27;/var/www/uploads/&#x27;</span>;<br>    <span class=\"hljs-variable\">$uploadFile</span> = <span class=\"hljs-variable\">$uploadDir</span> . <span class=\"hljs-title function_ invoke__\">basename</span>(<span class=\"hljs-variable\">$_FILES</span>[<span class=\"hljs-string\">&#x27;file&#x27;</span>][<span class=\"hljs-string\">&#x27;name&#x27;</span>]);<br><br>    <span class=\"hljs-keyword\">if</span> (<span class=\"hljs-title function_ invoke__\">move_uploaded_file</span>(<span class=\"hljs-variable\">$_FILES</span>[<span class=\"hljs-string\">&#x27;file&#x27;</span>][<span class=\"hljs-string\">&#x27;tmp_name&#x27;</span>], <span class=\"hljs-variable\">$uploadFile</span>)) &#123;<br>        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">&quot;文件上传成功。&quot;</span>;<br>    &#125; <span class=\"hljs-keyword\">else</span> &#123;<br>        <span class=\"hljs-keyword\">echo</span> <span class=\"hljs-string\">&quot;文件上传失败。&quot;</span>;<br>    &#125;<br>&#125;<br><span class=\"hljs-meta\">?&gt;</span><br></code></pre></td></tr></table></figure>\n\n<p>然后在Nginx的配置文件中，您可以配置一个 <code>location</code> 块来处理文件上传请求：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs nginx\"><span class=\"hljs-section\">location</span> /upload &#123;<br>    <span class=\"hljs-attribute\">root</span> /var/www/uploads;<br><br>    <span class=\"hljs-comment\"># 代理到后端PHP脚本</span><br>    <span class=\"hljs-attribute\">fastcgi_pass</span> <span class=\"hljs-number\">127.0.0.1:9000</span>;<br>    <span class=\"hljs-attribute\">include</span> fastcgi_params;<br>    <span class=\"hljs-attribute\">fastcgi_param</span> SCRIPT_FILENAME /var/www/html/upload.php;<br>&#125;<br></code></pre></td></tr></table></figure></li>\n</ol>\n"},{"title":"使用图形化对linux磁盘进行扩容","date":"2024-08-06T11:55:45.000Z","_content":"![微信截图_20240806195901.png](使用图形化对linux磁盘进行扩容/微信截图_20240806195901.png)\n磁盘空间不足的提示。\n我就在终端输入df -h查看了一下磁盘的使用情况。\n文件系统        容量  已用  可用 已用% 挂载点\nudev             14G     0   14G    0% /dev\ntmpfs           2.7G  1.8M  2.7G    1% /run\n/dev/sda1        48G   46G   47M  100% /\ntmpfs            14G     0   14G    0% /dev/shm\ntmpfs           5.0M     0  5.0M    0% /run/lock\ntmpfs           2.7G   60K  2.7G    1% /run/user/130\ntmpfs           2.7G   52K  2.7G    1% /run/user/0\noverlay          48G   46G   47M  100% /var/lib/docker/overlay2/40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd/merged\noverlay          48G   46G   47M  100% /var/lib/docker/overlay2/684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d/merged\noverlay          48G   46G   47M  100% /var/lib/docker/overlay2/71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867/merged\noverlay          48G   46G   47M  100% /var/lib/docker/overlay2/3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6/merged\n\n\n发现/dev/sda1这个文件系统的使用率打到了90%以上，我就想着给他扩一下容。\n网上各种找方法….\n网上一堆复制粘贴的坑逼教程可把我给坑惨了。\n最后找到了两篇文章综合起来才成功。\n写出来的目的仅仅为了方便记忆，那么就来说说吧。\n第一步:\n使用VMware图像界面工具，对磁盘进行扩容。这一步要先将你的ubantu关机后才可以进行。（必须删除所有快照）点击拓展后就可以指定磁盘大小了。值得注意的是，这里指定的磁盘大小并不是立马分出你给定的磁盘大小。而是给了一个容量上限，你用多少就消耗本机多少空间。所以指定大一点也没关系。\n![微信截图_20240806200518.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200518.png)\n第二步:\n下载Gparted镜像文件。\nhttps://jaist.dl.sourceforge.net/project/gparted/gparted-live-testing/1.6.0-3/gparted-live-1.6.0-3-amd64.iso?viasf=1\n\n然后在虚拟机的设置–CD/DVD(SATA)里， 在”启动时连接”前打钩 并选择 上面下载好的 Gparted 镜像， 如下图：\n![微信截图_20240806200410.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200410.png)\n\n第三步:\n启动BIOS方法:\n用记事本打开ubantu.vmx文件，在第一行添加这段代码\nbios.forceSetupOnce = “TRUE”\n\n![img.png](使用图形化对linux磁盘进行扩容/img.png)\n\n保存再打开就可以进入BIOS，这个设置时一次性的，在你开机后这段代码会自动消失，所以设置完之后就不用管了。\n\n\n\n进入BIOS后用←→键选择进入BOOT，然后用↑↓选择到CD-ROM drive，再按” + “号把它一到第一位。然后按F10保存退出。\n\n开机后即可进入这个界面。\n![微信截图_20240806200751.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200751.png)\n\n![微信截图_20240806200831.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200831.png)\n输入26选择简体中文，敲回车\n![微信截图_20240806200853.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200853.png)\n输入0，敲回车\n![微信截图_20240806200913.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200913.png)\n进入Gparted的界面会自动弹出Gparted的分区界面。\n![微信截图_20240806200924.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200924.png)\n依次删除 linux-swap项， extended项， 最后只剩下sda1和未分配， 然后右键”sda1”项进行调整大小，\n将磁盘容量调整到合适的大小最好是1024的整数倍，并预留空间(2-4G)作为交换区，交换区的大小为你系统内存的大小。 \n再右键”未分配”进行扩展分区出extended分区，然后新建逻辑分区linux-swap，操作完成后点击APPLY提交。然后退出 \n然后正常启动你的ubantu，再次输入命令df -h查看扩容是否成功\n\n└─# df -h     \n文件系统        容量  已用  可用 已用% 挂载点\nudev             14G     0   14G    0% /dev\ntmpfs           2.7G  1.8M  2.7G    1% /run\n/dev/sda1       144G   34G  104G   25% /\ntmpfs            14G     0   14G    0% /dev/shm\ntmpfs           5.0M     0  5.0M    0% /run/lock\ntmpfs           2.7G   60K  2.7G    1% /run/user/130\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867/merged\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d/merged\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd/merged\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6/merged\ntmpfs           2.7G   56K  2.7G    1% /run/user/0\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/930ee5b9896adee4a28eec7579f04eda6b9fb74888d7c2fb13d4834d6164d782/merged","source":"_posts/linux/使用图形化对linux磁盘进行扩容.md","raw":"---\ntitle: 使用图形化对linux磁盘进行扩容\ndate: 2024-08-06 19:55:45\ncategories: linux\ntag: 扩容磁盘\n---\n![微信截图_20240806195901.png](使用图形化对linux磁盘进行扩容/微信截图_20240806195901.png)\n磁盘空间不足的提示。\n我就在终端输入df -h查看了一下磁盘的使用情况。\n文件系统        容量  已用  可用 已用% 挂载点\nudev             14G     0   14G    0% /dev\ntmpfs           2.7G  1.8M  2.7G    1% /run\n/dev/sda1        48G   46G   47M  100% /\ntmpfs            14G     0   14G    0% /dev/shm\ntmpfs           5.0M     0  5.0M    0% /run/lock\ntmpfs           2.7G   60K  2.7G    1% /run/user/130\ntmpfs           2.7G   52K  2.7G    1% /run/user/0\noverlay          48G   46G   47M  100% /var/lib/docker/overlay2/40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd/merged\noverlay          48G   46G   47M  100% /var/lib/docker/overlay2/684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d/merged\noverlay          48G   46G   47M  100% /var/lib/docker/overlay2/71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867/merged\noverlay          48G   46G   47M  100% /var/lib/docker/overlay2/3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6/merged\n\n\n发现/dev/sda1这个文件系统的使用率打到了90%以上，我就想着给他扩一下容。\n网上各种找方法….\n网上一堆复制粘贴的坑逼教程可把我给坑惨了。\n最后找到了两篇文章综合起来才成功。\n写出来的目的仅仅为了方便记忆，那么就来说说吧。\n第一步:\n使用VMware图像界面工具，对磁盘进行扩容。这一步要先将你的ubantu关机后才可以进行。（必须删除所有快照）点击拓展后就可以指定磁盘大小了。值得注意的是，这里指定的磁盘大小并不是立马分出你给定的磁盘大小。而是给了一个容量上限，你用多少就消耗本机多少空间。所以指定大一点也没关系。\n![微信截图_20240806200518.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200518.png)\n第二步:\n下载Gparted镜像文件。\nhttps://jaist.dl.sourceforge.net/project/gparted/gparted-live-testing/1.6.0-3/gparted-live-1.6.0-3-amd64.iso?viasf=1\n\n然后在虚拟机的设置–CD/DVD(SATA)里， 在”启动时连接”前打钩 并选择 上面下载好的 Gparted 镜像， 如下图：\n![微信截图_20240806200410.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200410.png)\n\n第三步:\n启动BIOS方法:\n用记事本打开ubantu.vmx文件，在第一行添加这段代码\nbios.forceSetupOnce = “TRUE”\n\n![img.png](使用图形化对linux磁盘进行扩容/img.png)\n\n保存再打开就可以进入BIOS，这个设置时一次性的，在你开机后这段代码会自动消失，所以设置完之后就不用管了。\n\n\n\n进入BIOS后用←→键选择进入BOOT，然后用↑↓选择到CD-ROM drive，再按” + “号把它一到第一位。然后按F10保存退出。\n\n开机后即可进入这个界面。\n![微信截图_20240806200751.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200751.png)\n\n![微信截图_20240806200831.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200831.png)\n输入26选择简体中文，敲回车\n![微信截图_20240806200853.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200853.png)\n输入0，敲回车\n![微信截图_20240806200913.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200913.png)\n进入Gparted的界面会自动弹出Gparted的分区界面。\n![微信截图_20240806200924.png](使用图形化对linux磁盘进行扩容/微信截图_20240806200924.png)\n依次删除 linux-swap项， extended项， 最后只剩下sda1和未分配， 然后右键”sda1”项进行调整大小，\n将磁盘容量调整到合适的大小最好是1024的整数倍，并预留空间(2-4G)作为交换区，交换区的大小为你系统内存的大小。 \n再右键”未分配”进行扩展分区出extended分区，然后新建逻辑分区linux-swap，操作完成后点击APPLY提交。然后退出 \n然后正常启动你的ubantu，再次输入命令df -h查看扩容是否成功\n\n└─# df -h     \n文件系统        容量  已用  可用 已用% 挂载点\nudev             14G     0   14G    0% /dev\ntmpfs           2.7G  1.8M  2.7G    1% /run\n/dev/sda1       144G   34G  104G   25% /\ntmpfs            14G     0   14G    0% /dev/shm\ntmpfs           5.0M     0  5.0M    0% /run/lock\ntmpfs           2.7G   60K  2.7G    1% /run/user/130\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867/merged\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d/merged\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd/merged\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6/merged\ntmpfs           2.7G   56K  2.7G    1% /run/user/0\noverlay         144G   34G  104G   25% /var/lib/docker/overlay2/930ee5b9896adee4a28eec7579f04eda6b9fb74888d7c2fb13d4834d6164d782/merged","slug":"linux/使用图形化对linux磁盘进行扩容","published":1,"updated":"2025-02-18T06:26:47.395Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3k000l8gjdhmb47yos","content":"<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806195901.png\" class alt=\"微信截图_20240806195901.png\">\n<p>磁盘空间不足的提示。<br>我就在终端输入df -h查看了一下磁盘的使用情况。<br>文件系统        容量  已用  可用 已用% 挂载点<br>udev             14G     0   14G    0% &#x2F;dev<br>tmpfs           2.7G  1.8M  2.7G    1% &#x2F;run<br>&#x2F;dev&#x2F;sda1        48G   46G   47M  100% &#x2F;<br>tmpfs            14G     0   14G    0% &#x2F;dev&#x2F;shm<br>tmpfs           5.0M     0  5.0M    0% &#x2F;run&#x2F;lock<br>tmpfs           2.7G   60K  2.7G    1% &#x2F;run&#x2F;user&#x2F;130<br>tmpfs           2.7G   52K  2.7G    1% &#x2F;run&#x2F;user&#x2F;0<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd&#x2F;merged<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d&#x2F;merged<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867&#x2F;merged<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6&#x2F;merged</p>\n<p>发现&#x2F;dev&#x2F;sda1这个文件系统的使用率打到了90%以上，我就想着给他扩一下容。<br>网上各种找方法….<br>网上一堆复制粘贴的坑逼教程可把我给坑惨了。<br>最后找到了两篇文章综合起来才成功。<br>写出来的目的仅仅为了方便记忆，那么就来说说吧。<br>第一步:<br>使用VMware图像界面工具，对磁盘进行扩容。这一步要先将你的ubantu关机后才可以进行。（必须删除所有快照）点击拓展后就可以指定磁盘大小了。值得注意的是，这里指定的磁盘大小并不是立马分出你给定的磁盘大小。而是给了一个容量上限，你用多少就消耗本机多少空间。所以指定大一点也没关系。</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200518.png\" class alt=\"微信截图_20240806200518.png\">\n<p>第二步:<br>下载Gparted镜像文件。<br><a href=\"https://jaist.dl.sourceforge.net/project/gparted/gparted-live-testing/1.6.0-3/gparted-live-1.6.0-3-amd64.iso?viasf=1\">https://jaist.dl.sourceforge.net/project/gparted/gparted-live-testing/1.6.0-3/gparted-live-1.6.0-3-amd64.iso?viasf=1</a></p>\n<p>然后在虚拟机的设置–CD&#x2F;DVD(SATA)里， 在”启动时连接”前打钩 并选择 上面下载好的 Gparted 镜像， 如下图：</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200410.png\" class alt=\"微信截图_20240806200410.png\">\n\n<p>第三步:<br>启动BIOS方法:<br>用记事本打开ubantu.vmx文件，在第一行添加这段代码<br>bios.forceSetupOnce &#x3D; “TRUE”</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/img.png\" class alt=\"img.png\">\n\n<p>保存再打开就可以进入BIOS，这个设置时一次性的，在你开机后这段代码会自动消失，所以设置完之后就不用管了。</p>\n<p>进入BIOS后用←→键选择进入BOOT，然后用↑↓选择到CD-ROM drive，再按” + “号把它一到第一位。然后按F10保存退出。</p>\n<p>开机后即可进入这个界面。</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200751.png\" class alt=\"微信截图_20240806200751.png\">\n\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200831.png\" class alt=\"微信截图_20240806200831.png\">\n<p>输入26选择简体中文，敲回车</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200853.png\" class alt=\"微信截图_20240806200853.png\">\n<p>输入0，敲回车</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200913.png\" class alt=\"微信截图_20240806200913.png\">\n<p>进入Gparted的界面会自动弹出Gparted的分区界面。</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200924.png\" class alt=\"微信截图_20240806200924.png\">\n<p>依次删除 linux-swap项， extended项， 最后只剩下sda1和未分配， 然后右键”sda1”项进行调整大小，<br>将磁盘容量调整到合适的大小最好是1024的整数倍，并预留空间(2-4G)作为交换区，交换区的大小为你系统内存的大小。<br>再右键”未分配”进行扩展分区出extended分区，然后新建逻辑分区linux-swap，操作完成后点击APPLY提交。然后退出<br>然后正常启动你的ubantu，再次输入命令df -h查看扩容是否成功</p>\n<p>└─# df -h<br>文件系统        容量  已用  可用 已用% 挂载点<br>udev             14G     0   14G    0% &#x2F;dev<br>tmpfs           2.7G  1.8M  2.7G    1% &#x2F;run<br>&#x2F;dev&#x2F;sda1       144G   34G  104G   25% &#x2F;<br>tmpfs            14G     0   14G    0% &#x2F;dev&#x2F;shm<br>tmpfs           5.0M     0  5.0M    0% &#x2F;run&#x2F;lock<br>tmpfs           2.7G   60K  2.7G    1% &#x2F;run&#x2F;user&#x2F;130<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867&#x2F;merged<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d&#x2F;merged<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd&#x2F;merged<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6&#x2F;merged<br>tmpfs           2.7G   56K  2.7G    1% &#x2F;run&#x2F;user&#x2F;0<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;930ee5b9896adee4a28eec7579f04eda6b9fb74888d7c2fb13d4834d6164d782&#x2F;merged</p>\n","excerpt":"","more":"<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806195901.png\" class alt=\"微信截图_20240806195901.png\">\n<p>磁盘空间不足的提示。<br>我就在终端输入df -h查看了一下磁盘的使用情况。<br>文件系统        容量  已用  可用 已用% 挂载点<br>udev             14G     0   14G    0% &#x2F;dev<br>tmpfs           2.7G  1.8M  2.7G    1% &#x2F;run<br>&#x2F;dev&#x2F;sda1        48G   46G   47M  100% &#x2F;<br>tmpfs            14G     0   14G    0% &#x2F;dev&#x2F;shm<br>tmpfs           5.0M     0  5.0M    0% &#x2F;run&#x2F;lock<br>tmpfs           2.7G   60K  2.7G    1% &#x2F;run&#x2F;user&#x2F;130<br>tmpfs           2.7G   52K  2.7G    1% &#x2F;run&#x2F;user&#x2F;0<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd&#x2F;merged<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d&#x2F;merged<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867&#x2F;merged<br>overlay          48G   46G   47M  100% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6&#x2F;merged</p>\n<p>发现&#x2F;dev&#x2F;sda1这个文件系统的使用率打到了90%以上，我就想着给他扩一下容。<br>网上各种找方法….<br>网上一堆复制粘贴的坑逼教程可把我给坑惨了。<br>最后找到了两篇文章综合起来才成功。<br>写出来的目的仅仅为了方便记忆，那么就来说说吧。<br>第一步:<br>使用VMware图像界面工具，对磁盘进行扩容。这一步要先将你的ubantu关机后才可以进行。（必须删除所有快照）点击拓展后就可以指定磁盘大小了。值得注意的是，这里指定的磁盘大小并不是立马分出你给定的磁盘大小。而是给了一个容量上限，你用多少就消耗本机多少空间。所以指定大一点也没关系。</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200518.png\" class alt=\"微信截图_20240806200518.png\">\n<p>第二步:<br>下载Gparted镜像文件。<br><a href=\"https://jaist.dl.sourceforge.net/project/gparted/gparted-live-testing/1.6.0-3/gparted-live-1.6.0-3-amd64.iso?viasf=1\">https://jaist.dl.sourceforge.net/project/gparted/gparted-live-testing/1.6.0-3/gparted-live-1.6.0-3-amd64.iso?viasf=1</a></p>\n<p>然后在虚拟机的设置–CD&#x2F;DVD(SATA)里， 在”启动时连接”前打钩 并选择 上面下载好的 Gparted 镜像， 如下图：</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200410.png\" class alt=\"微信截图_20240806200410.png\">\n\n<p>第三步:<br>启动BIOS方法:<br>用记事本打开ubantu.vmx文件，在第一行添加这段代码<br>bios.forceSetupOnce &#x3D; “TRUE”</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/img.png\" class alt=\"img.png\">\n\n<p>保存再打开就可以进入BIOS，这个设置时一次性的，在你开机后这段代码会自动消失，所以设置完之后就不用管了。</p>\n<p>进入BIOS后用←→键选择进入BOOT，然后用↑↓选择到CD-ROM drive，再按” + “号把它一到第一位。然后按F10保存退出。</p>\n<p>开机后即可进入这个界面。</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200751.png\" class alt=\"微信截图_20240806200751.png\">\n\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200831.png\" class alt=\"微信截图_20240806200831.png\">\n<p>输入26选择简体中文，敲回车</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200853.png\" class alt=\"微信截图_20240806200853.png\">\n<p>输入0，敲回车</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200913.png\" class alt=\"微信截图_20240806200913.png\">\n<p>进入Gparted的界面会自动弹出Gparted的分区界面。</p>\n<img src=\"/2024/08/06/linux/%E4%BD%BF%E7%94%A8%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%AF%B9linux%E7%A3%81%E7%9B%98%E8%BF%9B%E8%A1%8C%E6%89%A9%E5%AE%B9/%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20240806200924.png\" class alt=\"微信截图_20240806200924.png\">\n<p>依次删除 linux-swap项， extended项， 最后只剩下sda1和未分配， 然后右键”sda1”项进行调整大小，<br>将磁盘容量调整到合适的大小最好是1024的整数倍，并预留空间(2-4G)作为交换区，交换区的大小为你系统内存的大小。<br>再右键”未分配”进行扩展分区出extended分区，然后新建逻辑分区linux-swap，操作完成后点击APPLY提交。然后退出<br>然后正常启动你的ubantu，再次输入命令df -h查看扩容是否成功</p>\n<p>└─# df -h<br>文件系统        容量  已用  可用 已用% 挂载点<br>udev             14G     0   14G    0% &#x2F;dev<br>tmpfs           2.7G  1.8M  2.7G    1% &#x2F;run<br>&#x2F;dev&#x2F;sda1       144G   34G  104G   25% &#x2F;<br>tmpfs            14G     0   14G    0% &#x2F;dev&#x2F;shm<br>tmpfs           5.0M     0  5.0M    0% &#x2F;run&#x2F;lock<br>tmpfs           2.7G   60K  2.7G    1% &#x2F;run&#x2F;user&#x2F;130<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;71c3fc9620d502f60d702b4a0227cb0ccfe86a05f75c0627a261ac1357a28867&#x2F;merged<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;684b310e0e5d6cd40b0003fea2920d176d49aacacba87d1364dc0f0aa26d429d&#x2F;merged<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;40d9810bdeacf6f8af191b96880582457507055ac701cddc05c90bd41a4cc8cd&#x2F;merged<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;3491e006468ecf31bc09cfe8d4ecef08bb37d93d2678f919e0e57f02b76c7cc6&#x2F;merged<br>tmpfs           2.7G   56K  2.7G    1% &#x2F;run&#x2F;user&#x2F;0<br>overlay         144G   34G  104G   25% &#x2F;var&#x2F;lib&#x2F;docker&#x2F;overlay2&#x2F;930ee5b9896adee4a28eec7579f04eda6b9fb74888d7c2fb13d4834d6164d782&#x2F;merged</p>\n"},{"title":"openvpn-部署脚本","date":"2024-08-07T08:02:35.000Z","_content":"1.执行安装脚本：\n[openvpn.sh](../../resource/openvpn.sh)\n\n2.将覆盖的dns等配置注释掉\n``` server\nlocal 192.168.2.124\nport 5001\nproto udp\ndev tun\nca ca.crt\ncert server.crt\nkey server.key\ndh dh.pem\nauth SHA256\ntls-crypt tc.key\ntopology subnet\nserver 10.8.0.0 255.255.255.0\n#push \"block-ipv6\"\n#push \"ifconfig-ipv6 fddd:1194:1194:1194::2/64 fddd:1194:1194:1194::1\"\n#push \"redirect-gateway def1 ipv6 bypass-dhcp\"\nifconfig-pool-persist ipp.txt\n#push \"dhcp-option DNS 100.125.1.250\"\n#push \"block-outside-dns\"\nkeepalive 10 120\ncipher AES-128-GCM\nuser nobody\ngroup nogroup\npersist-key\n```","source":"_posts/linux/openvpn-部署脚本.md","raw":"---\ntitle: openvpn-部署脚本\ndate: 2024-08-07 16:02:35\ncategories: linux\ntag: openvpn\n---\n1.执行安装脚本：\n[openvpn.sh](../../resource/openvpn.sh)\n\n2.将覆盖的dns等配置注释掉\n``` server\nlocal 192.168.2.124\nport 5001\nproto udp\ndev tun\nca ca.crt\ncert server.crt\nkey server.key\ndh dh.pem\nauth SHA256\ntls-crypt tc.key\ntopology subnet\nserver 10.8.0.0 255.255.255.0\n#push \"block-ipv6\"\n#push \"ifconfig-ipv6 fddd:1194:1194:1194::2/64 fddd:1194:1194:1194::1\"\n#push \"redirect-gateway def1 ipv6 bypass-dhcp\"\nifconfig-pool-persist ipp.txt\n#push \"dhcp-option DNS 100.125.1.250\"\n#push \"block-outside-dns\"\nkeepalive 10 120\ncipher AES-128-GCM\nuser nobody\ngroup nogroup\npersist-key\n```","slug":"linux/openvpn-部署脚本","published":1,"updated":"2025-02-22T09:36:31.520Z","_id":"cm7a4vg3l000o8gjd6zpp3uay","comments":1,"layout":"post","photos":[],"content":"<p>1.执行安装脚本：<br><a href=\"../../resource/openvpn.sh\">openvpn.sh</a></p>\n<p>2.将覆盖的dns等配置注释掉</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs server\">local 192.168.2.124<br>port 5001<br>proto udp<br>dev tun<br>ca ca.crt<br>cert server.crt<br>key server.key<br>dh dh.pem<br>auth SHA256<br>tls-crypt tc.key<br>topology subnet<br>server 10.8.0.0 255.255.255.0<br>#push &quot;block-ipv6&quot;<br>#push &quot;ifconfig-ipv6 fddd:1194:1194:1194::2/64 fddd:1194:1194:1194::1&quot;<br>#push &quot;redirect-gateway def1 ipv6 bypass-dhcp&quot;<br>ifconfig-pool-persist ipp.txt<br>#push &quot;dhcp-option DNS 100.125.1.250&quot;<br>#push &quot;block-outside-dns&quot;<br>keepalive 10 120<br>cipher AES-128-GCM<br>user nobody<br>group nogroup<br>persist-key<br></code></pre></td></tr></table></figure>","excerpt":"","more":"<p>1.执行安装脚本：<br><a href=\"../../resource/openvpn.sh\">openvpn.sh</a></p>\n<p>2.将覆盖的dns等配置注释掉</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs server\">local 192.168.2.124<br>port 5001<br>proto udp<br>dev tun<br>ca ca.crt<br>cert server.crt<br>key server.key<br>dh dh.pem<br>auth SHA256<br>tls-crypt tc.key<br>topology subnet<br>server 10.8.0.0 255.255.255.0<br>#push &quot;block-ipv6&quot;<br>#push &quot;ifconfig-ipv6 fddd:1194:1194:1194::2/64 fddd:1194:1194:1194::1&quot;<br>#push &quot;redirect-gateway def1 ipv6 bypass-dhcp&quot;<br>ifconfig-pool-persist ipp.txt<br>#push &quot;dhcp-option DNS 100.125.1.250&quot;<br>#push &quot;block-outside-dns&quot;<br>keepalive 10 120<br>cipher AES-128-GCM<br>user nobody<br>group nogroup<br>persist-key<br></code></pre></td></tr></table></figure>"},{"title":"在linux上使用代理","date":"2024-07-26T01:56:32.000Z","_content":"要在 Linux 命令行下使用 Clash Verge，需要按照以下步骤进行：\n\n### 1. 安装 Clash Verge\n\n首先，确保你的系统已经安装了 Clash Core。Clash Verge 是一个图形界面管理工具，而 Clash 本身是需要运行在后台的代理工具。\n\n#### 下载 Clash\n\n[mihomo-linux-amd64-v1.18.6.deb](../../resource/mihomo-linux-amd64-v1.18.6.deb)\n```bash\ndpkg -i mihomo-linux-amd64-v1.18.6.deb     \nchmod 777 mihomo-linux-amd64-v1.18.6.deb \nsudo mv mihomo-linux-amd64-v1.18.6 clash\n```\n\n### 2. 配置 Clash\n在使用 Clash Verge 之前，需要先配置 Clash 的 `config.yaml` 文件。\n\n```bash\n拷贝windows上的配置：D:\\soft\\clash-verge-1.6.2\\.config\\io.github.clash-verge-rev.clash-verge-rev/clash-verge.yaml\nwget -O /root/.config/mihomo/config.yaml 你配置好的clash-verge.yaml\n```\n### 3. 启动 Clash\n在命令行中启动 Clash：\n```bash\nnohup ./clash &\n```\nClash Verge 启动后，将打开一个本地的图形界面，你可以通过浏览器访问该界面，通常是 `http://localhost:7899` 或者其他配置文件中指定的端口。\n\n\n\n1. **创建代理配置文件**：在Kali系统的Docker配置目录下创建一个名为`/etc/systemd/system/docker.service.d/http-proxy.conf`的文件。如果该目录不存在，请先创建它。\n\n```sh\nsudo mkdir -p /etc/systemd/system/docker.service.d\nsudo nano /etc/systemd/system/docker.service.d/http-proxy.conf\n```\n\n2. **配置代理**：在`http-proxy.conf`文件中添加以下内容，将`http://127.0.0.1:7899`替换为你的代理服务器地址和端口。\n\n```ini\n[Service]\nEnvironment=\"HTTP_PROXY=http://127.0.0.1:7899\"\nEnvironment=\"HTTPS_PROXY=http://127.0.0.1:7899\"\nEnvironment=\"NO_PROXY=localhost,127.0.0.1\"\n```\n\n3. **重新加载守护进程并重启Docker服务**：\n\n```sh\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\n4. **验证代理配置**：你可以通过以下命令来验证Docker是否通过代理服务器进行连接：\n\n```sh\ndocker info\n```\n\n在输出信息中找到`HTTP Proxy`和`HTTPS Proxy`条目，检查它们是否显示了你配置的代理服务器地址。\n\n如果你需要为Docker客户端配置代理（如`docker build`命令），可以在你的shell配置文件（如`~/.bashrc`或`~/.zshrc`）中添加以下行：\n\n```sh\nexport HTTP_PROXY=\"http://your-proxy.example.com:8080\"\nexport HTTPS_PROXY=\"http://your-proxy.example.com:8080\"\nexport NO_PROXY=\"localhost,127.0.0.1\"\n```\n\n保存文件并加载新的配置：\n\n```sh\nsource ~/.bashrc  # 或者 source ~/.zshrc\n```\n\n这样，Docker客户端在运行时也会通过代理服务器进行连接。","source":"_posts/linux/在linux上使用代理.md","raw":"---\ntitle: 在linux上使用代理\ndate: 2024-07-26 09:56:32\ncategories: clash\ntag: 翻墙\n---\n要在 Linux 命令行下使用 Clash Verge，需要按照以下步骤进行：\n\n### 1. 安装 Clash Verge\n\n首先，确保你的系统已经安装了 Clash Core。Clash Verge 是一个图形界面管理工具，而 Clash 本身是需要运行在后台的代理工具。\n\n#### 下载 Clash\n\n[mihomo-linux-amd64-v1.18.6.deb](../../resource/mihomo-linux-amd64-v1.18.6.deb)\n```bash\ndpkg -i mihomo-linux-amd64-v1.18.6.deb     \nchmod 777 mihomo-linux-amd64-v1.18.6.deb \nsudo mv mihomo-linux-amd64-v1.18.6 clash\n```\n\n### 2. 配置 Clash\n在使用 Clash Verge 之前，需要先配置 Clash 的 `config.yaml` 文件。\n\n```bash\n拷贝windows上的配置：D:\\soft\\clash-verge-1.6.2\\.config\\io.github.clash-verge-rev.clash-verge-rev/clash-verge.yaml\nwget -O /root/.config/mihomo/config.yaml 你配置好的clash-verge.yaml\n```\n### 3. 启动 Clash\n在命令行中启动 Clash：\n```bash\nnohup ./clash &\n```\nClash Verge 启动后，将打开一个本地的图形界面，你可以通过浏览器访问该界面，通常是 `http://localhost:7899` 或者其他配置文件中指定的端口。\n\n\n\n1. **创建代理配置文件**：在Kali系统的Docker配置目录下创建一个名为`/etc/systemd/system/docker.service.d/http-proxy.conf`的文件。如果该目录不存在，请先创建它。\n\n```sh\nsudo mkdir -p /etc/systemd/system/docker.service.d\nsudo nano /etc/systemd/system/docker.service.d/http-proxy.conf\n```\n\n2. **配置代理**：在`http-proxy.conf`文件中添加以下内容，将`http://127.0.0.1:7899`替换为你的代理服务器地址和端口。\n\n```ini\n[Service]\nEnvironment=\"HTTP_PROXY=http://127.0.0.1:7899\"\nEnvironment=\"HTTPS_PROXY=http://127.0.0.1:7899\"\nEnvironment=\"NO_PROXY=localhost,127.0.0.1\"\n```\n\n3. **重新加载守护进程并重启Docker服务**：\n\n```sh\nsudo systemctl daemon-reload\nsudo systemctl restart docker\n```\n\n4. **验证代理配置**：你可以通过以下命令来验证Docker是否通过代理服务器进行连接：\n\n```sh\ndocker info\n```\n\n在输出信息中找到`HTTP Proxy`和`HTTPS Proxy`条目，检查它们是否显示了你配置的代理服务器地址。\n\n如果你需要为Docker客户端配置代理（如`docker build`命令），可以在你的shell配置文件（如`~/.bashrc`或`~/.zshrc`）中添加以下行：\n\n```sh\nexport HTTP_PROXY=\"http://your-proxy.example.com:8080\"\nexport HTTPS_PROXY=\"http://your-proxy.example.com:8080\"\nexport NO_PROXY=\"localhost,127.0.0.1\"\n```\n\n保存文件并加载新的配置：\n\n```sh\nsource ~/.bashrc  # 或者 source ~/.zshrc\n```\n\n这样，Docker客户端在运行时也会通过代理服务器进行连接。","slug":"linux/在linux上使用代理","published":1,"updated":"2025-02-22T09:39:54.462Z","_id":"cm7a4vg3l000r8gjdd7n25r41","comments":1,"layout":"post","photos":[],"content":"<p>要在 Linux 命令行下使用 Clash Verge，需要按照以下步骤进行：</p>\n<h3 id=\"1-安装-Clash-Verge\"><a href=\"#1-安装-Clash-Verge\" class=\"headerlink\" title=\"1. 安装 Clash Verge\"></a>1. 安装 Clash Verge</h3><p>首先，确保你的系统已经安装了 Clash Core。Clash Verge 是一个图形界面管理工具，而 Clash 本身是需要运行在后台的代理工具。</p>\n<h4 id=\"下载-Clash\"><a href=\"#下载-Clash\" class=\"headerlink\" title=\"下载 Clash\"></a>下载 Clash</h4><p><a href=\"../../resource/mihomo-linux-amd64-v1.18.6.deb\">mihomo-linux-amd64-v1.18.6.deb</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">dpkg -i mihomo-linux-amd64-v1.18.6.deb     <br><span class=\"hljs-built_in\">chmod</span> 777 mihomo-linux-amd64-v1.18.6.deb <br>sudo <span class=\"hljs-built_in\">mv</span> mihomo-linux-amd64-v1.18.6 clash<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置-Clash\"><a href=\"#2-配置-Clash\" class=\"headerlink\" title=\"2. 配置 Clash\"></a>2. 配置 Clash</h3><p>在使用 Clash Verge 之前，需要先配置 Clash 的 <code>config.yaml</code> 文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">拷贝windows上的配置：D:\\soft\\clash-verge-1.6.2\\.config\\io.github.clash-verge-rev.clash-verge-rev/clash-verge.yaml<br>wget -O /root/.config/mihomo/config.yaml 你配置好的clash-verge.yaml<br></code></pre></td></tr></table></figure>\n<h3 id=\"3-启动-Clash\"><a href=\"#3-启动-Clash\" class=\"headerlink\" title=\"3. 启动 Clash\"></a>3. 启动 Clash</h3><p>在命令行中启动 Clash：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">nohup</span> ./clash &amp;<br></code></pre></td></tr></table></figure>\n<p>Clash Verge 启动后，将打开一个本地的图形界面，你可以通过浏览器访问该界面，通常是 <code>http://localhost:7899</code> 或者其他配置文件中指定的端口。</p>\n<ol>\n<li><strong>创建代理配置文件</strong>：在Kali系统的Docker配置目录下创建一个名为<code>/etc/systemd/system/docker.service.d/http-proxy.conf</code>的文件。如果该目录不存在，请先创建它。</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">sudo <span class=\"hljs-built_in\">mkdir</span> -p /etc/systemd/system/docker.service.d<br>sudo nano /etc/systemd/system/docker.service.d/http-proxy.conf<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>配置代理</strong>：在<code>http-proxy.conf</code>文件中添加以下内容，将<code>http://127.0.0.1:7899</code>替换为你的代理服务器地址和端口。</li>\n</ol>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ini\"><span class=\"hljs-section\">[Service]</span><br><span class=\"hljs-attr\">Environment</span>=<span class=\"hljs-string\">&quot;HTTP_PROXY=http://127.0.0.1:7899&quot;</span><br><span class=\"hljs-attr\">Environment</span>=<span class=\"hljs-string\">&quot;HTTPS_PROXY=http://127.0.0.1:7899&quot;</span><br><span class=\"hljs-attr\">Environment</span>=<span class=\"hljs-string\">&quot;NO_PROXY=localhost,127.0.0.1&quot;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>重新加载守护进程并重启Docker服务</strong>：</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li><strong>验证代理配置</strong>：你可以通过以下命令来验证Docker是否通过代理服务器进行连接：</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">docker info<br></code></pre></td></tr></table></figure>\n\n<p>在输出信息中找到<code>HTTP Proxy</code>和<code>HTTPS Proxy</code>条目，检查它们是否显示了你配置的代理服务器地址。</p>\n<p>如果你需要为Docker客户端配置代理（如<code>docker build</code>命令），可以在你的shell配置文件（如<code>~/.bashrc</code>或<code>~/.zshrc</code>）中添加以下行：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\"><span class=\"hljs-built_in\">export</span> HTTP_PROXY=<span class=\"hljs-string\">&quot;http://your-proxy.example.com:8080&quot;</span><br><span class=\"hljs-built_in\">export</span> HTTPS_PROXY=<span class=\"hljs-string\">&quot;http://your-proxy.example.com:8080&quot;</span><br><span class=\"hljs-built_in\">export</span> NO_PROXY=<span class=\"hljs-string\">&quot;localhost,127.0.0.1&quot;</span><br></code></pre></td></tr></table></figure>\n\n<p>保存文件并加载新的配置：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\"><span class=\"hljs-built_in\">source</span> ~/.bashrc  <span class=\"hljs-comment\"># 或者 source ~/.zshrc</span><br></code></pre></td></tr></table></figure>\n\n<p>这样，Docker客户端在运行时也会通过代理服务器进行连接。</p>\n","excerpt":"","more":"<p>要在 Linux 命令行下使用 Clash Verge，需要按照以下步骤进行：</p>\n<h3 id=\"1-安装-Clash-Verge\"><a href=\"#1-安装-Clash-Verge\" class=\"headerlink\" title=\"1. 安装 Clash Verge\"></a>1. 安装 Clash Verge</h3><p>首先，确保你的系统已经安装了 Clash Core。Clash Verge 是一个图形界面管理工具，而 Clash 本身是需要运行在后台的代理工具。</p>\n<h4 id=\"下载-Clash\"><a href=\"#下载-Clash\" class=\"headerlink\" title=\"下载 Clash\"></a>下载 Clash</h4><p><a href=\"../../resource/mihomo-linux-amd64-v1.18.6.deb\">mihomo-linux-amd64-v1.18.6.deb</a></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">dpkg -i mihomo-linux-amd64-v1.18.6.deb     <br><span class=\"hljs-built_in\">chmod</span> 777 mihomo-linux-amd64-v1.18.6.deb <br>sudo <span class=\"hljs-built_in\">mv</span> mihomo-linux-amd64-v1.18.6 clash<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-配置-Clash\"><a href=\"#2-配置-Clash\" class=\"headerlink\" title=\"2. 配置 Clash\"></a>2. 配置 Clash</h3><p>在使用 Clash Verge 之前，需要先配置 Clash 的 <code>config.yaml</code> 文件。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">拷贝windows上的配置：D:\\soft\\clash-verge-1.6.2\\.config\\io.github.clash-verge-rev.clash-verge-rev/clash-verge.yaml<br>wget -O /root/.config/mihomo/config.yaml 你配置好的clash-verge.yaml<br></code></pre></td></tr></table></figure>\n<h3 id=\"3-启动-Clash\"><a href=\"#3-启动-Clash\" class=\"headerlink\" title=\"3. 启动 Clash\"></a>3. 启动 Clash</h3><p>在命令行中启动 Clash：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">nohup</span> ./clash &amp;<br></code></pre></td></tr></table></figure>\n<p>Clash Verge 启动后，将打开一个本地的图形界面，你可以通过浏览器访问该界面，通常是 <code>http://localhost:7899</code> 或者其他配置文件中指定的端口。</p>\n<ol>\n<li><strong>创建代理配置文件</strong>：在Kali系统的Docker配置目录下创建一个名为<code>/etc/systemd/system/docker.service.d/http-proxy.conf</code>的文件。如果该目录不存在，请先创建它。</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">sudo <span class=\"hljs-built_in\">mkdir</span> -p /etc/systemd/system/docker.service.d<br>sudo nano /etc/systemd/system/docker.service.d/http-proxy.conf<br></code></pre></td></tr></table></figure>\n\n<ol start=\"2\">\n<li><strong>配置代理</strong>：在<code>http-proxy.conf</code>文件中添加以下内容，将<code>http://127.0.0.1:7899</code>替换为你的代理服务器地址和端口。</li>\n</ol>\n<figure class=\"highlight ini\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs ini\"><span class=\"hljs-section\">[Service]</span><br><span class=\"hljs-attr\">Environment</span>=<span class=\"hljs-string\">&quot;HTTP_PROXY=http://127.0.0.1:7899&quot;</span><br><span class=\"hljs-attr\">Environment</span>=<span class=\"hljs-string\">&quot;HTTPS_PROXY=http://127.0.0.1:7899&quot;</span><br><span class=\"hljs-attr\">Environment</span>=<span class=\"hljs-string\">&quot;NO_PROXY=localhost,127.0.0.1&quot;</span><br></code></pre></td></tr></table></figure>\n\n<ol start=\"3\">\n<li><strong>重新加载守护进程并重启Docker服务</strong>：</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">sudo systemctl daemon-reload<br>sudo systemctl restart docker<br></code></pre></td></tr></table></figure>\n\n<ol start=\"4\">\n<li><strong>验证代理配置</strong>：你可以通过以下命令来验证Docker是否通过代理服务器进行连接：</li>\n</ol>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\">docker info<br></code></pre></td></tr></table></figure>\n\n<p>在输出信息中找到<code>HTTP Proxy</code>和<code>HTTPS Proxy</code>条目，检查它们是否显示了你配置的代理服务器地址。</p>\n<p>如果你需要为Docker客户端配置代理（如<code>docker build</code>命令），可以在你的shell配置文件（如<code>~/.bashrc</code>或<code>~/.zshrc</code>）中添加以下行：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\"><span class=\"hljs-built_in\">export</span> HTTP_PROXY=<span class=\"hljs-string\">&quot;http://your-proxy.example.com:8080&quot;</span><br><span class=\"hljs-built_in\">export</span> HTTPS_PROXY=<span class=\"hljs-string\">&quot;http://your-proxy.example.com:8080&quot;</span><br><span class=\"hljs-built_in\">export</span> NO_PROXY=<span class=\"hljs-string\">&quot;localhost,127.0.0.1&quot;</span><br></code></pre></td></tr></table></figure>\n\n<p>保存文件并加载新的配置：</p>\n<figure class=\"highlight sh\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sh\"><span class=\"hljs-built_in\">source</span> ~/.bashrc  <span class=\"hljs-comment\"># 或者 source ~/.zshrc</span><br></code></pre></td></tr></table></figure>\n\n<p>这样，Docker客户端在运行时也会通过代理服务器进行连接。</p>\n"},{"title":"对linux磁盘进行无损扩容","date":"2024-08-05T12:37:35.000Z","_content":"\n执行 lsblk 命令得到的数据如下\n   ```bash\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS\nsda      8:0    0  150G  0 disk \n├─sda1   8:1    0   49G  0 part /\n├─sda2   8:2    0    1K  0 part \n└─sda5   8:5    0  975M  0 part [SWAP]\nsr0     11:0    1  4.6G  0 rom  \n   ```\n此时，想将sda1从49G扩容到150G。进行无损扩展 `/dev/sda1` 的步骤较为复杂，但可以通过以下步骤来安全地扩展分区而不丢失数据。这包括使用 `fdisk` 或 `parted` 工具来调整分区大小，然后扩展文件系统。\n\n### 无损扩展分区的步骤\n\n#### 1. **备份数据**\n\n在进行任何磁盘操作之前，务必备份重要数据以防万一。\n\n#### 2. **使用 `parted` 调整分区大小**\n\n假设现有的 `/dev/sda1` 是 `ext4` 文件系统。\n\n1. **查看当前磁盘布局**\n\n   ```bash\n   lsblk\n   sudo fdisk -l /dev/sda\n   ```\n\n2. **调整分区大小**\n\n   使用 `parted` 调整分区大小。\n\n   ```bash\n   sudo parted /dev/sda\n   ```\n\n   在 `parted` 交互界面中执行以下步骤：\n\n   ```bash\n   (parted) print\n   ```\n\n   确认分区表，并记下 `/dev/sda1` 的起始位置（例如 `2048s`）。\n\n   ```bash\n   (parted) resizepart 1 150GB\n   ```\n\n   这会扩展分区1到150GB。\n\n   ```bash\n   (parted) quit\n   ```\n\n#### 3. **更新分区表**\n\n有时，系统需要重新加载分区表。\n\n```bash\nsudo partprobe /dev/sda\n```\n\n#### 4. **扩展文件系统**\n\n根据你的文件系统类型，执行以下步骤来扩展文件系统。\n\n##### 对于 `ext4` 文件系统：\n\n```bash\nsudo resize2fs /dev/sda1\n```\n\n##### 对于 `xfs` 文件系统：\n\n```bash\nsudo xfs_growfs /dev/sda1\n```\n\n#### 5. **验证扩展是否成功**\n\n```bash\ndf -h\n```\n\n### 示例步骤\n\n完整的命令和步骤如下：\n\n```bash\n# 查看当前磁盘布局\nlsblk\nsudo fdisk -l /dev/sda\n\n# 调整分区大小\nsudo parted /dev/sda\n\n# 在 parted 交互界面中\n(parted) print\n(parted) resizepart 1 150GB\n(parted) quit\n\n# 更新分区表\nsudo partprobe /dev/sda\n\n# 扩展文件系统（假设是 ext4 文件系统）\nsudo resize2fs /dev/sda1\n\n# 验证扩展是否成功\ndf -h\n```\n\n### 注意事项\n\n- 确保你的 `/dev/sda1` 分区后面有足够的未分配空间来扩展到 150GB。\n- 在操作之前，确保系统分区未被使用或者在单用户模式下进行操作，以防止数据损坏。\n- 如果你无法进入系统，可以通过 live CD/USB 启动系统并执行这些操作。\n\n这些步骤旨在提供一种相对安全的方法来无损扩展分区。如果对操作不熟悉，建议请教专业人士或使用专业的分区管理软件进行操作。","source":"_posts/linux/对linux磁盘进行无损扩容.md","raw":"---\ntitle: 对linux磁盘进行无损扩容\ndate: 2024-08-05 20:37:35\ncategories: linux\ntag: 扩容磁盘\n---\n\n执行 lsblk 命令得到的数据如下\n   ```bash\nNAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS\nsda      8:0    0  150G  0 disk \n├─sda1   8:1    0   49G  0 part /\n├─sda2   8:2    0    1K  0 part \n└─sda5   8:5    0  975M  0 part [SWAP]\nsr0     11:0    1  4.6G  0 rom  \n   ```\n此时，想将sda1从49G扩容到150G。进行无损扩展 `/dev/sda1` 的步骤较为复杂，但可以通过以下步骤来安全地扩展分区而不丢失数据。这包括使用 `fdisk` 或 `parted` 工具来调整分区大小，然后扩展文件系统。\n\n### 无损扩展分区的步骤\n\n#### 1. **备份数据**\n\n在进行任何磁盘操作之前，务必备份重要数据以防万一。\n\n#### 2. **使用 `parted` 调整分区大小**\n\n假设现有的 `/dev/sda1` 是 `ext4` 文件系统。\n\n1. **查看当前磁盘布局**\n\n   ```bash\n   lsblk\n   sudo fdisk -l /dev/sda\n   ```\n\n2. **调整分区大小**\n\n   使用 `parted` 调整分区大小。\n\n   ```bash\n   sudo parted /dev/sda\n   ```\n\n   在 `parted` 交互界面中执行以下步骤：\n\n   ```bash\n   (parted) print\n   ```\n\n   确认分区表，并记下 `/dev/sda1` 的起始位置（例如 `2048s`）。\n\n   ```bash\n   (parted) resizepart 1 150GB\n   ```\n\n   这会扩展分区1到150GB。\n\n   ```bash\n   (parted) quit\n   ```\n\n#### 3. **更新分区表**\n\n有时，系统需要重新加载分区表。\n\n```bash\nsudo partprobe /dev/sda\n```\n\n#### 4. **扩展文件系统**\n\n根据你的文件系统类型，执行以下步骤来扩展文件系统。\n\n##### 对于 `ext4` 文件系统：\n\n```bash\nsudo resize2fs /dev/sda1\n```\n\n##### 对于 `xfs` 文件系统：\n\n```bash\nsudo xfs_growfs /dev/sda1\n```\n\n#### 5. **验证扩展是否成功**\n\n```bash\ndf -h\n```\n\n### 示例步骤\n\n完整的命令和步骤如下：\n\n```bash\n# 查看当前磁盘布局\nlsblk\nsudo fdisk -l /dev/sda\n\n# 调整分区大小\nsudo parted /dev/sda\n\n# 在 parted 交互界面中\n(parted) print\n(parted) resizepart 1 150GB\n(parted) quit\n\n# 更新分区表\nsudo partprobe /dev/sda\n\n# 扩展文件系统（假设是 ext4 文件系统）\nsudo resize2fs /dev/sda1\n\n# 验证扩展是否成功\ndf -h\n```\n\n### 注意事项\n\n- 确保你的 `/dev/sda1` 分区后面有足够的未分配空间来扩展到 150GB。\n- 在操作之前，确保系统分区未被使用或者在单用户模式下进行操作，以防止数据损坏。\n- 如果你无法进入系统，可以通过 live CD/USB 启动系统并执行这些操作。\n\n这些步骤旨在提供一种相对安全的方法来无损扩展分区。如果对操作不熟悉，建议请教专业人士或使用专业的分区管理软件进行操作。","slug":"linux/对linux磁盘进行无损扩容","published":1,"updated":"2025-02-18T06:25:13.114Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3m000u8gjdd1n224xz","content":"<p>执行 lsblk 命令得到的数据如下<br>   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS<br>sda      8:0    0  150G  0 disk <br>├─sda1   8:1    0   49G  0 part /<br>├─sda2   8:2    0    1K  0 part <br>└─sda5   8:5    0  975M  0 part [SWAP]<br>sr0     11:0    1  4.6G  0 rom  <br></code></pre></td></tr></table></figure><br>此时，想将sda1从49G扩容到150G。进行无损扩展 <code>/dev/sda1</code> 的步骤较为复杂，但可以通过以下步骤来安全地扩展分区而不丢失数据。这包括使用 <code>fdisk</code> 或 <code>parted</code> 工具来调整分区大小，然后扩展文件系统。</p>\n<h3 id=\"无损扩展分区的步骤\"><a href=\"#无损扩展分区的步骤\" class=\"headerlink\" title=\"无损扩展分区的步骤\"></a>无损扩展分区的步骤</h3><h4 id=\"1-备份数据\"><a href=\"#1-备份数据\" class=\"headerlink\" title=\"1. 备份数据\"></a>1. <strong>备份数据</strong></h4><p>在进行任何磁盘操作之前，务必备份重要数据以防万一。</p>\n<h4 id=\"2-使用-parted-调整分区大小\"><a href=\"#2-使用-parted-调整分区大小\" class=\"headerlink\" title=\"2. 使用 parted 调整分区大小\"></a>2. <strong>使用 <code>parted</code> 调整分区大小</strong></h4><p>假设现有的 <code>/dev/sda1</code> 是 <code>ext4</code> 文件系统。</p>\n<ol>\n<li><p><strong>查看当前磁盘布局</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">lsblk<br>sudo fdisk -l /dev/sda<br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>调整分区大小</strong></p>\n<p>使用 <code>parted</code> 调整分区大小。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo parted /dev/sda<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>parted</code> 交互界面中执行以下步骤：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(parted) <span class=\"hljs-built_in\">print</span><br></code></pre></td></tr></table></figure>\n\n<p>确认分区表，并记下 <code>/dev/sda1</code> 的起始位置（例如 <code>2048s</code>）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(parted) resizepart 1 150GB<br></code></pre></td></tr></table></figure>\n\n<p>这会扩展分区1到150GB。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(parted) quit<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"3-更新分区表\"><a href=\"#3-更新分区表\" class=\"headerlink\" title=\"3. 更新分区表\"></a>3. <strong>更新分区表</strong></h4><p>有时，系统需要重新加载分区表。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo partprobe /dev/sda<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"4-扩展文件系统\"><a href=\"#4-扩展文件系统\" class=\"headerlink\" title=\"4. 扩展文件系统\"></a>4. <strong>扩展文件系统</strong></h4><p>根据你的文件系统类型，执行以下步骤来扩展文件系统。</p>\n<h5 id=\"对于-ext4-文件系统：\"><a href=\"#对于-ext4-文件系统：\" class=\"headerlink\" title=\"对于 ext4 文件系统：\"></a>对于 <code>ext4</code> 文件系统：</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo resize2fs /dev/sda1<br></code></pre></td></tr></table></figure>\n\n<h5 id=\"对于-xfs-文件系统：\"><a href=\"#对于-xfs-文件系统：\" class=\"headerlink\" title=\"对于 xfs 文件系统：\"></a>对于 <code>xfs</code> 文件系统：</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo xfs_growfs /dev/sda1<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"5-验证扩展是否成功\"><a href=\"#5-验证扩展是否成功\" class=\"headerlink\" title=\"5. 验证扩展是否成功\"></a>5. <strong>验证扩展是否成功</strong></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">df</span> -h<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"示例步骤\"><a href=\"#示例步骤\" class=\"headerlink\" title=\"示例步骤\"></a>示例步骤</h3><p>完整的命令和步骤如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 查看当前磁盘布局</span><br>lsblk<br>sudo fdisk -l /dev/sda<br><br><span class=\"hljs-comment\"># 调整分区大小</span><br>sudo parted /dev/sda<br><br><span class=\"hljs-comment\"># 在 parted 交互界面中</span><br>(parted) <span class=\"hljs-built_in\">print</span><br>(parted) resizepart 1 150GB<br>(parted) quit<br><br><span class=\"hljs-comment\"># 更新分区表</span><br>sudo partprobe /dev/sda<br><br><span class=\"hljs-comment\"># 扩展文件系统（假设是 ext4 文件系统）</span><br>sudo resize2fs /dev/sda1<br><br><span class=\"hljs-comment\"># 验证扩展是否成功</span><br><span class=\"hljs-built_in\">df</span> -h<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h3><ul>\n<li>确保你的 <code>/dev/sda1</code> 分区后面有足够的未分配空间来扩展到 150GB。</li>\n<li>在操作之前，确保系统分区未被使用或者在单用户模式下进行操作，以防止数据损坏。</li>\n<li>如果你无法进入系统，可以通过 live CD&#x2F;USB 启动系统并执行这些操作。</li>\n</ul>\n<p>这些步骤旨在提供一种相对安全的方法来无损扩展分区。如果对操作不熟悉，建议请教专业人士或使用专业的分区管理软件进行操作。</p>\n","excerpt":"","more":"<p>执行 lsblk 命令得到的数据如下<br>   <figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">NAME   MAJ:MIN RM  SIZE RO TYPE MOUNTPOINTS<br>sda      8:0    0  150G  0 disk <br>├─sda1   8:1    0   49G  0 part /<br>├─sda2   8:2    0    1K  0 part <br>└─sda5   8:5    0  975M  0 part [SWAP]<br>sr0     11:0    1  4.6G  0 rom  <br></code></pre></td></tr></table></figure><br>此时，想将sda1从49G扩容到150G。进行无损扩展 <code>/dev/sda1</code> 的步骤较为复杂，但可以通过以下步骤来安全地扩展分区而不丢失数据。这包括使用 <code>fdisk</code> 或 <code>parted</code> 工具来调整分区大小，然后扩展文件系统。</p>\n<h3 id=\"无损扩展分区的步骤\"><a href=\"#无损扩展分区的步骤\" class=\"headerlink\" title=\"无损扩展分区的步骤\"></a>无损扩展分区的步骤</h3><h4 id=\"1-备份数据\"><a href=\"#1-备份数据\" class=\"headerlink\" title=\"1. 备份数据\"></a>1. <strong>备份数据</strong></h4><p>在进行任何磁盘操作之前，务必备份重要数据以防万一。</p>\n<h4 id=\"2-使用-parted-调整分区大小\"><a href=\"#2-使用-parted-调整分区大小\" class=\"headerlink\" title=\"2. 使用 parted 调整分区大小\"></a>2. <strong>使用 <code>parted</code> 调整分区大小</strong></h4><p>假设现有的 <code>/dev/sda1</code> 是 <code>ext4</code> 文件系统。</p>\n<ol>\n<li><p><strong>查看当前磁盘布局</strong></p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">lsblk<br>sudo fdisk -l /dev/sda<br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>调整分区大小</strong></p>\n<p>使用 <code>parted</code> 调整分区大小。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo parted /dev/sda<br></code></pre></td></tr></table></figure>\n\n<p>在 <code>parted</code> 交互界面中执行以下步骤：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(parted) <span class=\"hljs-built_in\">print</span><br></code></pre></td></tr></table></figure>\n\n<p>确认分区表，并记下 <code>/dev/sda1</code> 的起始位置（例如 <code>2048s</code>）。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(parted) resizepart 1 150GB<br></code></pre></td></tr></table></figure>\n\n<p>这会扩展分区1到150GB。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">(parted) quit<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h4 id=\"3-更新分区表\"><a href=\"#3-更新分区表\" class=\"headerlink\" title=\"3. 更新分区表\"></a>3. <strong>更新分区表</strong></h4><p>有时，系统需要重新加载分区表。</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo partprobe /dev/sda<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"4-扩展文件系统\"><a href=\"#4-扩展文件系统\" class=\"headerlink\" title=\"4. 扩展文件系统\"></a>4. <strong>扩展文件系统</strong></h4><p>根据你的文件系统类型，执行以下步骤来扩展文件系统。</p>\n<h5 id=\"对于-ext4-文件系统：\"><a href=\"#对于-ext4-文件系统：\" class=\"headerlink\" title=\"对于 ext4 文件系统：\"></a>对于 <code>ext4</code> 文件系统：</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo resize2fs /dev/sda1<br></code></pre></td></tr></table></figure>\n\n<h5 id=\"对于-xfs-文件系统：\"><a href=\"#对于-xfs-文件系统：\" class=\"headerlink\" title=\"对于 xfs 文件系统：\"></a>对于 <code>xfs</code> 文件系统：</h5><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">sudo xfs_growfs /dev/sda1<br></code></pre></td></tr></table></figure>\n\n<h4 id=\"5-验证扩展是否成功\"><a href=\"#5-验证扩展是否成功\" class=\"headerlink\" title=\"5. 验证扩展是否成功\"></a>5. <strong>验证扩展是否成功</strong></h4><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">df</span> -h<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"示例步骤\"><a href=\"#示例步骤\" class=\"headerlink\" title=\"示例步骤\"></a>示例步骤</h3><p>完整的命令和步骤如下：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-comment\"># 查看当前磁盘布局</span><br>lsblk<br>sudo fdisk -l /dev/sda<br><br><span class=\"hljs-comment\"># 调整分区大小</span><br>sudo parted /dev/sda<br><br><span class=\"hljs-comment\"># 在 parted 交互界面中</span><br>(parted) <span class=\"hljs-built_in\">print</span><br>(parted) resizepart 1 150GB<br>(parted) quit<br><br><span class=\"hljs-comment\"># 更新分区表</span><br>sudo partprobe /dev/sda<br><br><span class=\"hljs-comment\"># 扩展文件系统（假设是 ext4 文件系统）</span><br>sudo resize2fs /dev/sda1<br><br><span class=\"hljs-comment\"># 验证扩展是否成功</span><br><span class=\"hljs-built_in\">df</span> -h<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"注意事项\"><a href=\"#注意事项\" class=\"headerlink\" title=\"注意事项\"></a>注意事项</h3><ul>\n<li>确保你的 <code>/dev/sda1</code> 分区后面有足够的未分配空间来扩展到 150GB。</li>\n<li>在操作之前，确保系统分区未被使用或者在单用户模式下进行操作，以防止数据损坏。</li>\n<li>如果你无法进入系统，可以通过 live CD&#x2F;USB 启动系统并执行这些操作。</li>\n</ul>\n<p>这些步骤旨在提供一种相对安全的方法来无损扩展分区。如果对操作不熟悉，建议请教专业人士或使用专业的分区管理软件进行操作。</p>\n"},{"title":"解读redis分布式锁核心逻辑","date":"2024-07-30T02:07:27.000Z","_content":"   ```lua\n  local insertable = false; local value = redis.call('hget', KEYS[1], ARGV[5]); if value == false then insertable = true; else local t, val = struct.unpack('dLc0', value); local expireDate = 92233720368547758; local expireDateScore = redis.call('zscore', KEYS[2], ARGV[5]); if expireDateScore ~= false then expireDate = tonumber(expireDateScore) end; if t ~= 0 then local expireIdle = redis.call('zscore', KEYS[3], ARGV[5]); if expireIdle ~= false then expireDate = math.min(expireDate, tonumber(expireIdle)) end; end; if expireDate <= tonumber(ARGV[1]) then insertable = true; end; end; if insertable == true then if tonumber(ARGV[2]) > 0 then redis.call('zadd', KEYS[2], ARGV[2], ARGV[5]); else redis.call('zrem', KEYS[2], ARGV[5]); end; if tonumber(ARGV[3]) > 0 then redis.call('zadd', KEYS[3], ARGV[3], ARGV[5]); else redis.call('zrem', KEYS[3], ARGV[5]); end; local maxSize = tonumber(redis.call('hget', KEYS[7], 'max-size')); if maxSize ~= nil and maxSize ~= 0 then     local currentTime = tonumber(ARGV[1]);     local lastAccessTimeSetName = KEYS[5]; local mode = redis.call('hget', KEYS[7], 'mode'); if mode == false or mode == 'LRU' then redis.call('zadd', lastAccessTimeSetName, currentTime, ARGV[5]); end;     local cacheSize = tonumber(redis.call('hlen', KEYS[1]));     if cacheSize >= maxSize then         local lruItems = redis.call('zrange', lastAccessTimeSetName, 0, cacheSize - maxSize);         for index, lruItem in ipairs(lruItems) do             if lruItem and lruItem ~= ARGV[5] then                 local lruItemValue = redis.call('hget', KEYS[1], lruItem);                 redis.call('hdel', KEYS[1], lruItem);                 redis.call('zrem', KEYS[2], lruItem);                 redis.call('zrem', KEYS[3], lruItem);                 redis.call('zrem', lastAccessTimeSetName, lruItem);                 if lruItemValue ~= false then                 local removedChannelName = KEYS[6]; local ttl, obj = struct.unpack('dLc0', lruItemValue);                    local msg = struct.pack('Lc0Lc0', string.len(lruItem), lruItem, string.len(obj), obj);                redis.call('publish', removedChannelName, msg); end;             end;         end;     end; if mode == 'LFU' then redis.call('zincrby', lastAccessTimeSetName, 1, ARGV[5]); end; end; local val = struct.pack('dLc0', tonumber(ARGV[4]), string.len(ARGV[6]), ARGV[6]); redis.call('hset', KEYS[1], ARGV[5], val); local msg = struct.pack('Lc0Lc0', string.len(ARGV[5]), ARGV[5], string.len(ARGV[6]), ARGV[6]); redis.call('publish', KEYS[4], msg); return nil; else local t, val = struct.unpack('dLc0', value); redis.call('zadd', KEYS[3], t + ARGV[1], ARGV[5]); return val; end; \n   ```\n\n这段Lua脚本用于Redis缓存的管理和插入操作，主要功能包括：\n- 判断是否需要插入或更新缓存。\n- 处理缓存的过期逻辑。\n- 实现基于LRU（最近最少使用）或LFU（最少使用频率）策略的缓存淘汰。\n- 在缓存项插入或更新时发布相关消息。\n\n具体的解读如下：\n\n1. **初始化和获取当前值**：\n   ```lua\n   local insertable = false\n   local value = redis.call('hget', KEYS[1], ARGV[5])\n   ```\n\n2. **判断当前缓存项是否存在**：\n    - 如果不存在，则设置`insertable`为`true`，表示可以插入新的缓存项。\n    - 如果存在，继续判断其过期时间。\n   ```lua\n   if value == false then \n       insertable = true \n   else\n       local t, val = struct.unpack('dLc0', value)\n       local expireDate = 92233720368547758\n       local expireDateScore = redis.call('zscore', KEYS[2], ARGV[5])\n       if expireDateScore ~= false then expireDate = tonumber(expireDateScore) end\n       if t ~= 0 then\n           local expireIdle = redis.call('zscore', KEYS[3], ARGV[5])\n           if expireIdle ~= false then expireDate = math.min(expireDate, tonumber(expireIdle)) end\n       end\n       if expireDate <= tonumber(ARGV[1]) then insertable = true end\n   end\n   ```\n\n3. **处理可插入的情况**：\n    - 更新或删除过期时间。\n    - 检查缓存大小，并根据LRU或LFU策略进行淘汰。\n   ```lua\n   if insertable == true then \n       if tonumber(ARGV[2]) > 0 then \n           redis.call('zadd', KEYS[2], ARGV[2], ARGV[5])\n       else \n           redis.call('zrem', KEYS[2], ARGV[5]) \n       end\n       if tonumber(ARGV[3]) > 0 then \n           redis.call('zadd', KEYS[3], ARGV[3], ARGV[5])\n       else \n           redis.call('zrem', KEYS[3], ARGV[5]) \n       end\n       local maxSize = tonumber(redis.call('hget', KEYS[7], 'max-size'))\n       if maxSize ~= nil and maxSize ~= 0 then\n           local currentTime = tonumber(ARGV[1])\n           local lastAccessTimeSetName = KEYS[5]\n           local mode = redis.call('hget', KEYS[7], 'mode')\n           if mode == false or mode == 'LRU' then \n               redis.call('zadd', lastAccessTimeSetName, currentTime, ARGV[5])\n           end\n           local cacheSize = tonumber(redis.call('hlen', KEYS[1]))\n           if cacheSize >= maxSize then\n               local lruItems = redis.call('zrange', lastAccessTimeSetName, 0, cacheSize - maxSize)\n               for index, lruItem in ipairs(lruItems) do\n                   if lruItem and lruItem ~= ARGV[5] then\n                       local lruItemValue = redis.call('hget', KEYS[1], lruItem)\n                       redis.call('hdel', KEYS[1], lruItem)\n                       redis.call('zrem', KEYS[2], lruItem)\n                       redis.call('zrem', KEYS[3], lruItem)\n                       redis.call('zrem', lastAccessTimeSetName, lruItem)\n                       if lruItemValue ~= false then\n                           local removedChannelName = KEYS[6]\n                           local ttl, obj = struct.unpack('dLc0', lruItemValue)\n                           local msg = struct.pack('Lc0Lc0', string.len(lruItem), lruItem, string.len(obj), obj)\n                           redis.call('publish', removedChannelName, msg)\n                       end\n                   end\n               end\n           end\n           if mode == 'LFU' then \n               redis.call('zincrby', lastAccessTimeSetName, 1, ARGV[5]) \n           end\n       end\n       local val = struct.pack('dLc0', tonumber(ARGV[4]), string.len(ARGV[6]), ARGV[6])\n       redis.call('hset', KEYS[1], ARGV[5], val)\n       local msg = struct.pack('Lc0Lc0', string.len(ARGV[5]), ARGV[5], string.len(ARGV[6]), ARGV[6])\n       redis.call('publish', KEYS[4], msg)\n       return nil\n   ```\n\n4. **处理不可插入的情况**：\n    - 更新过期时间，并返回现有值。\n   ```lua\n   else \n       local t, val = struct.unpack('dLc0', value)\n       redis.call('zadd', KEYS[3], t + ARGV[1], ARGV[5])\n       return val\n   end\n   ```\n\n### 参数和键值解释\n\n- `KEYS[1]`: 哈希表存储缓存项。\n- `KEYS[2]`: 有序集合存储过期时间。\n- `KEYS[3]`: 有序集合存储空闲时间。\n- `KEYS[4]`: 频道名称，用于发布缓存项变更消息。\n- `KEYS[5]`: 有序集合存储最近访问时间（LRU模式）。\n- `KEYS[6]`: 频道名称，用于发布被淘汰的缓存项。\n- `KEYS[7]`: 存储缓存配置（如最大尺寸、模式等）。\n\n- `ARGV[1]`: 当前时间戳。\n- `ARGV[2]`: 新的过期时间。\n- `ARGV[3]`: 新的空闲时间。\n- `ARGV[4]`: 新缓存项的TTL。\n- `ARGV[5]`: 缓存项的键名。\n- `ARGV[6]`: 缓存项的值。","source":"_posts/redis/解读redis分布式锁核心逻辑.md","raw":"---\ntitle: 解读redis分布式锁核心逻辑\ndate: 2024-07-30 10:07:27\ncategories: redis\ntag: lua表达式\n---\n   ```lua\n  local insertable = false; local value = redis.call('hget', KEYS[1], ARGV[5]); if value == false then insertable = true; else local t, val = struct.unpack('dLc0', value); local expireDate = 92233720368547758; local expireDateScore = redis.call('zscore', KEYS[2], ARGV[5]); if expireDateScore ~= false then expireDate = tonumber(expireDateScore) end; if t ~= 0 then local expireIdle = redis.call('zscore', KEYS[3], ARGV[5]); if expireIdle ~= false then expireDate = math.min(expireDate, tonumber(expireIdle)) end; end; if expireDate <= tonumber(ARGV[1]) then insertable = true; end; end; if insertable == true then if tonumber(ARGV[2]) > 0 then redis.call('zadd', KEYS[2], ARGV[2], ARGV[5]); else redis.call('zrem', KEYS[2], ARGV[5]); end; if tonumber(ARGV[3]) > 0 then redis.call('zadd', KEYS[3], ARGV[3], ARGV[5]); else redis.call('zrem', KEYS[3], ARGV[5]); end; local maxSize = tonumber(redis.call('hget', KEYS[7], 'max-size')); if maxSize ~= nil and maxSize ~= 0 then     local currentTime = tonumber(ARGV[1]);     local lastAccessTimeSetName = KEYS[5]; local mode = redis.call('hget', KEYS[7], 'mode'); if mode == false or mode == 'LRU' then redis.call('zadd', lastAccessTimeSetName, currentTime, ARGV[5]); end;     local cacheSize = tonumber(redis.call('hlen', KEYS[1]));     if cacheSize >= maxSize then         local lruItems = redis.call('zrange', lastAccessTimeSetName, 0, cacheSize - maxSize);         for index, lruItem in ipairs(lruItems) do             if lruItem and lruItem ~= ARGV[5] then                 local lruItemValue = redis.call('hget', KEYS[1], lruItem);                 redis.call('hdel', KEYS[1], lruItem);                 redis.call('zrem', KEYS[2], lruItem);                 redis.call('zrem', KEYS[3], lruItem);                 redis.call('zrem', lastAccessTimeSetName, lruItem);                 if lruItemValue ~= false then                 local removedChannelName = KEYS[6]; local ttl, obj = struct.unpack('dLc0', lruItemValue);                    local msg = struct.pack('Lc0Lc0', string.len(lruItem), lruItem, string.len(obj), obj);                redis.call('publish', removedChannelName, msg); end;             end;         end;     end; if mode == 'LFU' then redis.call('zincrby', lastAccessTimeSetName, 1, ARGV[5]); end; end; local val = struct.pack('dLc0', tonumber(ARGV[4]), string.len(ARGV[6]), ARGV[6]); redis.call('hset', KEYS[1], ARGV[5], val); local msg = struct.pack('Lc0Lc0', string.len(ARGV[5]), ARGV[5], string.len(ARGV[6]), ARGV[6]); redis.call('publish', KEYS[4], msg); return nil; else local t, val = struct.unpack('dLc0', value); redis.call('zadd', KEYS[3], t + ARGV[1], ARGV[5]); return val; end; \n   ```\n\n这段Lua脚本用于Redis缓存的管理和插入操作，主要功能包括：\n- 判断是否需要插入或更新缓存。\n- 处理缓存的过期逻辑。\n- 实现基于LRU（最近最少使用）或LFU（最少使用频率）策略的缓存淘汰。\n- 在缓存项插入或更新时发布相关消息。\n\n具体的解读如下：\n\n1. **初始化和获取当前值**：\n   ```lua\n   local insertable = false\n   local value = redis.call('hget', KEYS[1], ARGV[5])\n   ```\n\n2. **判断当前缓存项是否存在**：\n    - 如果不存在，则设置`insertable`为`true`，表示可以插入新的缓存项。\n    - 如果存在，继续判断其过期时间。\n   ```lua\n   if value == false then \n       insertable = true \n   else\n       local t, val = struct.unpack('dLc0', value)\n       local expireDate = 92233720368547758\n       local expireDateScore = redis.call('zscore', KEYS[2], ARGV[5])\n       if expireDateScore ~= false then expireDate = tonumber(expireDateScore) end\n       if t ~= 0 then\n           local expireIdle = redis.call('zscore', KEYS[3], ARGV[5])\n           if expireIdle ~= false then expireDate = math.min(expireDate, tonumber(expireIdle)) end\n       end\n       if expireDate <= tonumber(ARGV[1]) then insertable = true end\n   end\n   ```\n\n3. **处理可插入的情况**：\n    - 更新或删除过期时间。\n    - 检查缓存大小，并根据LRU或LFU策略进行淘汰。\n   ```lua\n   if insertable == true then \n       if tonumber(ARGV[2]) > 0 then \n           redis.call('zadd', KEYS[2], ARGV[2], ARGV[5])\n       else \n           redis.call('zrem', KEYS[2], ARGV[5]) \n       end\n       if tonumber(ARGV[3]) > 0 then \n           redis.call('zadd', KEYS[3], ARGV[3], ARGV[5])\n       else \n           redis.call('zrem', KEYS[3], ARGV[5]) \n       end\n       local maxSize = tonumber(redis.call('hget', KEYS[7], 'max-size'))\n       if maxSize ~= nil and maxSize ~= 0 then\n           local currentTime = tonumber(ARGV[1])\n           local lastAccessTimeSetName = KEYS[5]\n           local mode = redis.call('hget', KEYS[7], 'mode')\n           if mode == false or mode == 'LRU' then \n               redis.call('zadd', lastAccessTimeSetName, currentTime, ARGV[5])\n           end\n           local cacheSize = tonumber(redis.call('hlen', KEYS[1]))\n           if cacheSize >= maxSize then\n               local lruItems = redis.call('zrange', lastAccessTimeSetName, 0, cacheSize - maxSize)\n               for index, lruItem in ipairs(lruItems) do\n                   if lruItem and lruItem ~= ARGV[5] then\n                       local lruItemValue = redis.call('hget', KEYS[1], lruItem)\n                       redis.call('hdel', KEYS[1], lruItem)\n                       redis.call('zrem', KEYS[2], lruItem)\n                       redis.call('zrem', KEYS[3], lruItem)\n                       redis.call('zrem', lastAccessTimeSetName, lruItem)\n                       if lruItemValue ~= false then\n                           local removedChannelName = KEYS[6]\n                           local ttl, obj = struct.unpack('dLc0', lruItemValue)\n                           local msg = struct.pack('Lc0Lc0', string.len(lruItem), lruItem, string.len(obj), obj)\n                           redis.call('publish', removedChannelName, msg)\n                       end\n                   end\n               end\n           end\n           if mode == 'LFU' then \n               redis.call('zincrby', lastAccessTimeSetName, 1, ARGV[5]) \n           end\n       end\n       local val = struct.pack('dLc0', tonumber(ARGV[4]), string.len(ARGV[6]), ARGV[6])\n       redis.call('hset', KEYS[1], ARGV[5], val)\n       local msg = struct.pack('Lc0Lc0', string.len(ARGV[5]), ARGV[5], string.len(ARGV[6]), ARGV[6])\n       redis.call('publish', KEYS[4], msg)\n       return nil\n   ```\n\n4. **处理不可插入的情况**：\n    - 更新过期时间，并返回现有值。\n   ```lua\n   else \n       local t, val = struct.unpack('dLc0', value)\n       redis.call('zadd', KEYS[3], t + ARGV[1], ARGV[5])\n       return val\n   end\n   ```\n\n### 参数和键值解释\n\n- `KEYS[1]`: 哈希表存储缓存项。\n- `KEYS[2]`: 有序集合存储过期时间。\n- `KEYS[3]`: 有序集合存储空闲时间。\n- `KEYS[4]`: 频道名称，用于发布缓存项变更消息。\n- `KEYS[5]`: 有序集合存储最近访问时间（LRU模式）。\n- `KEYS[6]`: 频道名称，用于发布被淘汰的缓存项。\n- `KEYS[7]`: 存储缓存配置（如最大尺寸、模式等）。\n\n- `ARGV[1]`: 当前时间戳。\n- `ARGV[2]`: 新的过期时间。\n- `ARGV[3]`: 新的空闲时间。\n- `ARGV[4]`: 新缓存项的TTL。\n- `ARGV[5]`: 缓存项的键名。\n- `ARGV[6]`: 缓存项的值。","slug":"redis/解读redis分布式锁核心逻辑","published":1,"updated":"2025-02-18T06:24:40.765Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3n000y8gjd8inehu90","content":"   <figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">local</span> insertable = <span class=\"hljs-literal\">false</span>; <span class=\"hljs-keyword\">local</span> value = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">if</span> value == <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> insertable = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">local</span> t, val = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, value); <span class=\"hljs-keyword\">local</span> expireDate = <span class=\"hljs-number\">92233720368547758</span>; <span class=\"hljs-keyword\">local</span> expireDateScore = redis.call(<span class=\"hljs-string\">&#x27;zscore&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">if</span> expireDateScore ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> expireDate = <span class=\"hljs-built_in\">tonumber</span>(expireDateScore) <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> t ~= <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> <span class=\"hljs-keyword\">local</span> expireIdle = redis.call(<span class=\"hljs-string\">&#x27;zscore&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">if</span> expireIdle ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> expireDate = <span class=\"hljs-built_in\">math</span>.<span class=\"hljs-built_in\">min</span>(expireDate, <span class=\"hljs-built_in\">tonumber</span>(expireIdle)) <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> expireDate &lt;= <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">1</span>]) <span class=\"hljs-keyword\">then</span> insertable = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> insertable == <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">then</span> <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">2</span>]) &gt; <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">else</span> redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">3</span>]) &gt; <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">else</span> redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">local</span> maxSize = <span class=\"hljs-built_in\">tonumber</span>(redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">7</span>], <span class=\"hljs-string\">&#x27;max-size&#x27;</span>)); <span class=\"hljs-keyword\">if</span> maxSize ~= <span class=\"hljs-literal\">nil</span> <span class=\"hljs-keyword\">and</span> maxSize ~= <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span>     <span class=\"hljs-keyword\">local</span> currentTime = <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">1</span>]);     <span class=\"hljs-keyword\">local</span> lastAccessTimeSetName = KEYS[<span class=\"hljs-number\">5</span>]; <span class=\"hljs-keyword\">local</span> mode = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">7</span>], <span class=\"hljs-string\">&#x27;mode&#x27;</span>); <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">or</span> mode == <span class=\"hljs-string\">&#x27;LRU&#x27;</span> <span class=\"hljs-keyword\">then</span> redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, lastAccessTimeSetName, currentTime, ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">end</span>;     <span class=\"hljs-keyword\">local</span> cacheSize = <span class=\"hljs-built_in\">tonumber</span>(redis.call(<span class=\"hljs-string\">&#x27;hlen&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>]));     <span class=\"hljs-keyword\">if</span> cacheSize &gt;= maxSize <span class=\"hljs-keyword\">then</span>         <span class=\"hljs-keyword\">local</span> lruItems = redis.call(<span class=\"hljs-string\">&#x27;zrange&#x27;</span>, lastAccessTimeSetName, <span class=\"hljs-number\">0</span>, cacheSize - maxSize);         <span class=\"hljs-keyword\">for</span> index, lruItem <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">ipairs</span>(lruItems) <span class=\"hljs-keyword\">do</span>             <span class=\"hljs-keyword\">if</span> lruItem <span class=\"hljs-keyword\">and</span> lruItem ~= ARGV[<span class=\"hljs-number\">5</span>] <span class=\"hljs-keyword\">then</span>                 <span class=\"hljs-keyword\">local</span> lruItemValue = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], lruItem);                 redis.call(<span class=\"hljs-string\">&#x27;hdel&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], lruItem);                 redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], lruItem);                 redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], lruItem);                 redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, lastAccessTimeSetName, lruItem);                 <span class=\"hljs-keyword\">if</span> lruItemValue ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span>                 <span class=\"hljs-keyword\">local</span> removedChannelName = KEYS[<span class=\"hljs-number\">6</span>]; <span class=\"hljs-keyword\">local</span> ttl, obj = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, lruItemValue);                    <span class=\"hljs-keyword\">local</span> msg = struct.pack(<span class=\"hljs-string\">&#x27;Lc0Lc0&#x27;</span>, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(lruItem), lruItem, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(obj), obj);                redis.call(<span class=\"hljs-string\">&#x27;publish&#x27;</span>, removedChannelName, msg); <span class=\"hljs-keyword\">end</span>;             <span class=\"hljs-keyword\">end</span>;         <span class=\"hljs-keyword\">end</span>;     <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-string\">&#x27;LFU&#x27;</span> <span class=\"hljs-keyword\">then</span> redis.call(<span class=\"hljs-string\">&#x27;zincrby&#x27;</span>, lastAccessTimeSetName, <span class=\"hljs-number\">1</span>, ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">local</span> val = struct.pack(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">4</span>]), <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">6</span>]), ARGV[<span class=\"hljs-number\">6</span>]); redis.call(<span class=\"hljs-string\">&#x27;hset&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>], val); <span class=\"hljs-keyword\">local</span> msg = struct.pack(<span class=\"hljs-string\">&#x27;Lc0Lc0&#x27;</span>, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">5</span>]), ARGV[<span class=\"hljs-number\">5</span>], <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">6</span>]), ARGV[<span class=\"hljs-number\">6</span>]); redis.call(<span class=\"hljs-string\">&#x27;publish&#x27;</span>, KEYS[<span class=\"hljs-number\">4</span>], msg); <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">local</span> t, val = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, value); redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], t + ARGV[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">return</span> val; <span class=\"hljs-keyword\">end</span>; <br></code></pre></td></tr></table></figure>\n\n<p>这段Lua脚本用于Redis缓存的管理和插入操作，主要功能包括：</p>\n<ul>\n<li>判断是否需要插入或更新缓存。</li>\n<li>处理缓存的过期逻辑。</li>\n<li>实现基于LRU（最近最少使用）或LFU（最少使用频率）策略的缓存淘汰。</li>\n<li>在缓存项插入或更新时发布相关消息。</li>\n</ul>\n<p>具体的解读如下：</p>\n<ol>\n<li><p><strong>初始化和获取当前值</strong>：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">local</span> insertable = <span class=\"hljs-literal\">false</span><br><span class=\"hljs-keyword\">local</span> value = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>])<br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>判断当前缓存项是否存在</strong>：</p>\n<ul>\n<li>如果不存在，则设置<code>insertable</code>为<code>true</code>，表示可以插入新的缓存项。</li>\n<li>如果存在，继续判断其过期时间。<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">if</span> value == <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> <br>    insertable = <span class=\"hljs-literal\">true</span> <br><span class=\"hljs-keyword\">else</span><br>    <span class=\"hljs-keyword\">local</span> t, val = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, value)<br>    <span class=\"hljs-keyword\">local</span> expireDate = <span class=\"hljs-number\">92233720368547758</span><br>    <span class=\"hljs-keyword\">local</span> expireDateScore = redis.call(<span class=\"hljs-string\">&#x27;zscore&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>    <span class=\"hljs-keyword\">if</span> expireDateScore ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> expireDate = <span class=\"hljs-built_in\">tonumber</span>(expireDateScore) <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">if</span> t ~= <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">local</span> expireIdle = redis.call(<span class=\"hljs-string\">&#x27;zscore&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>        <span class=\"hljs-keyword\">if</span> expireIdle ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> expireDate = <span class=\"hljs-built_in\">math</span>.<span class=\"hljs-built_in\">min</span>(expireDate, <span class=\"hljs-built_in\">tonumber</span>(expireIdle)) <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">if</span> expireDate &lt;= <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">1</span>]) <span class=\"hljs-keyword\">then</span> insertable = <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">end</span><br><span class=\"hljs-keyword\">end</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong>处理可插入的情况</strong>：</p>\n<ul>\n<li>更新或删除过期时间。</li>\n<li>检查缓存大小，并根据LRU或LFU策略进行淘汰。<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">if</span> insertable == <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">then</span> <br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">2</span>]) &gt; <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> <br>        redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>    <span class=\"hljs-keyword\">else</span> <br>        redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>]) <br>    <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">3</span>]) &gt; <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> <br>        redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>    <span class=\"hljs-keyword\">else</span> <br>        redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>]) <br>    <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">local</span> maxSize = <span class=\"hljs-built_in\">tonumber</span>(redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">7</span>], <span class=\"hljs-string\">&#x27;max-size&#x27;</span>))<br>    <span class=\"hljs-keyword\">if</span> maxSize ~= <span class=\"hljs-literal\">nil</span> <span class=\"hljs-keyword\">and</span> maxSize ~= <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">local</span> currentTime = <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">1</span>])<br>        <span class=\"hljs-keyword\">local</span> lastAccessTimeSetName = KEYS[<span class=\"hljs-number\">5</span>]<br>        <span class=\"hljs-keyword\">local</span> mode = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">7</span>], <span class=\"hljs-string\">&#x27;mode&#x27;</span>)<br>        <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">or</span> mode == <span class=\"hljs-string\">&#x27;LRU&#x27;</span> <span class=\"hljs-keyword\">then</span> <br>            redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, lastAccessTimeSetName, currentTime, ARGV[<span class=\"hljs-number\">5</span>])<br>        <span class=\"hljs-keyword\">end</span><br>        <span class=\"hljs-keyword\">local</span> cacheSize = <span class=\"hljs-built_in\">tonumber</span>(redis.call(<span class=\"hljs-string\">&#x27;hlen&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>]))<br>        <span class=\"hljs-keyword\">if</span> cacheSize &gt;= maxSize <span class=\"hljs-keyword\">then</span><br>            <span class=\"hljs-keyword\">local</span> lruItems = redis.call(<span class=\"hljs-string\">&#x27;zrange&#x27;</span>, lastAccessTimeSetName, <span class=\"hljs-number\">0</span>, cacheSize - maxSize)<br>            <span class=\"hljs-keyword\">for</span> index, lruItem <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">ipairs</span>(lruItems) <span class=\"hljs-keyword\">do</span><br>                <span class=\"hljs-keyword\">if</span> lruItem <span class=\"hljs-keyword\">and</span> lruItem ~= ARGV[<span class=\"hljs-number\">5</span>] <span class=\"hljs-keyword\">then</span><br>                    <span class=\"hljs-keyword\">local</span> lruItemValue = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], lruItem)<br>                    redis.call(<span class=\"hljs-string\">&#x27;hdel&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], lruItem)<br>                    redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], lruItem)<br>                    redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], lruItem)<br>                    redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, lastAccessTimeSetName, lruItem)<br>                    <span class=\"hljs-keyword\">if</span> lruItemValue ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span><br>                        <span class=\"hljs-keyword\">local</span> removedChannelName = KEYS[<span class=\"hljs-number\">6</span>]<br>                        <span class=\"hljs-keyword\">local</span> ttl, obj = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, lruItemValue)<br>                        <span class=\"hljs-keyword\">local</span> msg = struct.pack(<span class=\"hljs-string\">&#x27;Lc0Lc0&#x27;</span>, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(lruItem), lruItem, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(obj), obj)<br>                        redis.call(<span class=\"hljs-string\">&#x27;publish&#x27;</span>, removedChannelName, msg)<br>                    <span class=\"hljs-keyword\">end</span><br>                <span class=\"hljs-keyword\">end</span><br>            <span class=\"hljs-keyword\">end</span><br>        <span class=\"hljs-keyword\">end</span><br>        <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-string\">&#x27;LFU&#x27;</span> <span class=\"hljs-keyword\">then</span> <br>            redis.call(<span class=\"hljs-string\">&#x27;zincrby&#x27;</span>, lastAccessTimeSetName, <span class=\"hljs-number\">1</span>, ARGV[<span class=\"hljs-number\">5</span>]) <br>        <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">local</span> val = struct.pack(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">4</span>]), <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">6</span>]), ARGV[<span class=\"hljs-number\">6</span>])<br>    redis.call(<span class=\"hljs-string\">&#x27;hset&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>], val)<br>    <span class=\"hljs-keyword\">local</span> msg = struct.pack(<span class=\"hljs-string\">&#x27;Lc0Lc0&#x27;</span>, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">5</span>]), ARGV[<span class=\"hljs-number\">5</span>], <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">6</span>]), ARGV[<span class=\"hljs-number\">6</span>])<br>    redis.call(<span class=\"hljs-string\">&#x27;publish&#x27;</span>, KEYS[<span class=\"hljs-number\">4</span>], msg)<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong>处理不可插入的情况</strong>：</p>\n<ul>\n<li>更新过期时间，并返回现有值。<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">else</span> <br>    <span class=\"hljs-keyword\">local</span> t, val = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, value)<br>    redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], t + ARGV[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>    <span class=\"hljs-keyword\">return</span> val<br><span class=\"hljs-keyword\">end</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ol>\n<h3 id=\"参数和键值解释\"><a href=\"#参数和键值解释\" class=\"headerlink\" title=\"参数和键值解释\"></a>参数和键值解释</h3><ul>\n<li><p><code>KEYS[1]</code>: 哈希表存储缓存项。</p>\n</li>\n<li><p><code>KEYS[2]</code>: 有序集合存储过期时间。</p>\n</li>\n<li><p><code>KEYS[3]</code>: 有序集合存储空闲时间。</p>\n</li>\n<li><p><code>KEYS[4]</code>: 频道名称，用于发布缓存项变更消息。</p>\n</li>\n<li><p><code>KEYS[5]</code>: 有序集合存储最近访问时间（LRU模式）。</p>\n</li>\n<li><p><code>KEYS[6]</code>: 频道名称，用于发布被淘汰的缓存项。</p>\n</li>\n<li><p><code>KEYS[7]</code>: 存储缓存配置（如最大尺寸、模式等）。</p>\n</li>\n<li><p><code>ARGV[1]</code>: 当前时间戳。</p>\n</li>\n<li><p><code>ARGV[2]</code>: 新的过期时间。</p>\n</li>\n<li><p><code>ARGV[3]</code>: 新的空闲时间。</p>\n</li>\n<li><p><code>ARGV[4]</code>: 新缓存项的TTL。</p>\n</li>\n<li><p><code>ARGV[5]</code>: 缓存项的键名。</p>\n</li>\n<li><p><code>ARGV[6]</code>: 缓存项的值。</p>\n</li>\n</ul>\n","excerpt":"","more":"   <figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">local</span> insertable = <span class=\"hljs-literal\">false</span>; <span class=\"hljs-keyword\">local</span> value = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">if</span> value == <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> insertable = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">local</span> t, val = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, value); <span class=\"hljs-keyword\">local</span> expireDate = <span class=\"hljs-number\">92233720368547758</span>; <span class=\"hljs-keyword\">local</span> expireDateScore = redis.call(<span class=\"hljs-string\">&#x27;zscore&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">if</span> expireDateScore ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> expireDate = <span class=\"hljs-built_in\">tonumber</span>(expireDateScore) <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> t ~= <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> <span class=\"hljs-keyword\">local</span> expireIdle = redis.call(<span class=\"hljs-string\">&#x27;zscore&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">if</span> expireIdle ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> expireDate = <span class=\"hljs-built_in\">math</span>.<span class=\"hljs-built_in\">min</span>(expireDate, <span class=\"hljs-built_in\">tonumber</span>(expireIdle)) <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> expireDate &lt;= <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">1</span>]) <span class=\"hljs-keyword\">then</span> insertable = <span class=\"hljs-literal\">true</span>; <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> insertable == <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">then</span> <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">2</span>]) &gt; <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">else</span> redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">3</span>]) &gt; <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">else</span> redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">local</span> maxSize = <span class=\"hljs-built_in\">tonumber</span>(redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">7</span>], <span class=\"hljs-string\">&#x27;max-size&#x27;</span>)); <span class=\"hljs-keyword\">if</span> maxSize ~= <span class=\"hljs-literal\">nil</span> <span class=\"hljs-keyword\">and</span> maxSize ~= <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span>     <span class=\"hljs-keyword\">local</span> currentTime = <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">1</span>]);     <span class=\"hljs-keyword\">local</span> lastAccessTimeSetName = KEYS[<span class=\"hljs-number\">5</span>]; <span class=\"hljs-keyword\">local</span> mode = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">7</span>], <span class=\"hljs-string\">&#x27;mode&#x27;</span>); <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">or</span> mode == <span class=\"hljs-string\">&#x27;LRU&#x27;</span> <span class=\"hljs-keyword\">then</span> redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, lastAccessTimeSetName, currentTime, ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">end</span>;     <span class=\"hljs-keyword\">local</span> cacheSize = <span class=\"hljs-built_in\">tonumber</span>(redis.call(<span class=\"hljs-string\">&#x27;hlen&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>]));     <span class=\"hljs-keyword\">if</span> cacheSize &gt;= maxSize <span class=\"hljs-keyword\">then</span>         <span class=\"hljs-keyword\">local</span> lruItems = redis.call(<span class=\"hljs-string\">&#x27;zrange&#x27;</span>, lastAccessTimeSetName, <span class=\"hljs-number\">0</span>, cacheSize - maxSize);         <span class=\"hljs-keyword\">for</span> index, lruItem <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">ipairs</span>(lruItems) <span class=\"hljs-keyword\">do</span>             <span class=\"hljs-keyword\">if</span> lruItem <span class=\"hljs-keyword\">and</span> lruItem ~= ARGV[<span class=\"hljs-number\">5</span>] <span class=\"hljs-keyword\">then</span>                 <span class=\"hljs-keyword\">local</span> lruItemValue = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], lruItem);                 redis.call(<span class=\"hljs-string\">&#x27;hdel&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], lruItem);                 redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], lruItem);                 redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], lruItem);                 redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, lastAccessTimeSetName, lruItem);                 <span class=\"hljs-keyword\">if</span> lruItemValue ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span>                 <span class=\"hljs-keyword\">local</span> removedChannelName = KEYS[<span class=\"hljs-number\">6</span>]; <span class=\"hljs-keyword\">local</span> ttl, obj = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, lruItemValue);                    <span class=\"hljs-keyword\">local</span> msg = struct.pack(<span class=\"hljs-string\">&#x27;Lc0Lc0&#x27;</span>, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(lruItem), lruItem, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(obj), obj);                redis.call(<span class=\"hljs-string\">&#x27;publish&#x27;</span>, removedChannelName, msg); <span class=\"hljs-keyword\">end</span>;             <span class=\"hljs-keyword\">end</span>;         <span class=\"hljs-keyword\">end</span>;     <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-string\">&#x27;LFU&#x27;</span> <span class=\"hljs-keyword\">then</span> redis.call(<span class=\"hljs-string\">&#x27;zincrby&#x27;</span>, lastAccessTimeSetName, <span class=\"hljs-number\">1</span>, ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">end</span>; <span class=\"hljs-keyword\">local</span> val = struct.pack(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">4</span>]), <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">6</span>]), ARGV[<span class=\"hljs-number\">6</span>]); redis.call(<span class=\"hljs-string\">&#x27;hset&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>], val); <span class=\"hljs-keyword\">local</span> msg = struct.pack(<span class=\"hljs-string\">&#x27;Lc0Lc0&#x27;</span>, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">5</span>]), ARGV[<span class=\"hljs-number\">5</span>], <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">6</span>]), ARGV[<span class=\"hljs-number\">6</span>]); redis.call(<span class=\"hljs-string\">&#x27;publish&#x27;</span>, KEYS[<span class=\"hljs-number\">4</span>], msg); <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span>; <span class=\"hljs-keyword\">else</span> <span class=\"hljs-keyword\">local</span> t, val = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, value); redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], t + ARGV[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>]); <span class=\"hljs-keyword\">return</span> val; <span class=\"hljs-keyword\">end</span>; <br></code></pre></td></tr></table></figure>\n\n<p>这段Lua脚本用于Redis缓存的管理和插入操作，主要功能包括：</p>\n<ul>\n<li>判断是否需要插入或更新缓存。</li>\n<li>处理缓存的过期逻辑。</li>\n<li>实现基于LRU（最近最少使用）或LFU（最少使用频率）策略的缓存淘汰。</li>\n<li>在缓存项插入或更新时发布相关消息。</li>\n</ul>\n<p>具体的解读如下：</p>\n<ol>\n<li><p><strong>初始化和获取当前值</strong>：</p>\n<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">local</span> insertable = <span class=\"hljs-literal\">false</span><br><span class=\"hljs-keyword\">local</span> value = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>])<br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>判断当前缓存项是否存在</strong>：</p>\n<ul>\n<li>如果不存在，则设置<code>insertable</code>为<code>true</code>，表示可以插入新的缓存项。</li>\n<li>如果存在，继续判断其过期时间。<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">if</span> value == <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> <br>    insertable = <span class=\"hljs-literal\">true</span> <br><span class=\"hljs-keyword\">else</span><br>    <span class=\"hljs-keyword\">local</span> t, val = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, value)<br>    <span class=\"hljs-keyword\">local</span> expireDate = <span class=\"hljs-number\">92233720368547758</span><br>    <span class=\"hljs-keyword\">local</span> expireDateScore = redis.call(<span class=\"hljs-string\">&#x27;zscore&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>    <span class=\"hljs-keyword\">if</span> expireDateScore ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> expireDate = <span class=\"hljs-built_in\">tonumber</span>(expireDateScore) <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">if</span> t ~= <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">local</span> expireIdle = redis.call(<span class=\"hljs-string\">&#x27;zscore&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>        <span class=\"hljs-keyword\">if</span> expireIdle ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span> expireDate = <span class=\"hljs-built_in\">math</span>.<span class=\"hljs-built_in\">min</span>(expireDate, <span class=\"hljs-built_in\">tonumber</span>(expireIdle)) <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">if</span> expireDate &lt;= <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">1</span>]) <span class=\"hljs-keyword\">then</span> insertable = <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">end</span><br><span class=\"hljs-keyword\">end</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong>处理可插入的情况</strong>：</p>\n<ul>\n<li>更新或删除过期时间。</li>\n<li>检查缓存大小，并根据LRU或LFU策略进行淘汰。<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">if</span> insertable == <span class=\"hljs-literal\">true</span> <span class=\"hljs-keyword\">then</span> <br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">2</span>]) &gt; <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> <br>        redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>    <span class=\"hljs-keyword\">else</span> <br>        redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], ARGV[<span class=\"hljs-number\">5</span>]) <br>    <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">if</span> <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">3</span>]) &gt; <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span> <br>        redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>    <span class=\"hljs-keyword\">else</span> <br>        redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], ARGV[<span class=\"hljs-number\">5</span>]) <br>    <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">local</span> maxSize = <span class=\"hljs-built_in\">tonumber</span>(redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">7</span>], <span class=\"hljs-string\">&#x27;max-size&#x27;</span>))<br>    <span class=\"hljs-keyword\">if</span> maxSize ~= <span class=\"hljs-literal\">nil</span> <span class=\"hljs-keyword\">and</span> maxSize ~= <span class=\"hljs-number\">0</span> <span class=\"hljs-keyword\">then</span><br>        <span class=\"hljs-keyword\">local</span> currentTime = <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">1</span>])<br>        <span class=\"hljs-keyword\">local</span> lastAccessTimeSetName = KEYS[<span class=\"hljs-number\">5</span>]<br>        <span class=\"hljs-keyword\">local</span> mode = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">7</span>], <span class=\"hljs-string\">&#x27;mode&#x27;</span>)<br>        <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">or</span> mode == <span class=\"hljs-string\">&#x27;LRU&#x27;</span> <span class=\"hljs-keyword\">then</span> <br>            redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, lastAccessTimeSetName, currentTime, ARGV[<span class=\"hljs-number\">5</span>])<br>        <span class=\"hljs-keyword\">end</span><br>        <span class=\"hljs-keyword\">local</span> cacheSize = <span class=\"hljs-built_in\">tonumber</span>(redis.call(<span class=\"hljs-string\">&#x27;hlen&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>]))<br>        <span class=\"hljs-keyword\">if</span> cacheSize &gt;= maxSize <span class=\"hljs-keyword\">then</span><br>            <span class=\"hljs-keyword\">local</span> lruItems = redis.call(<span class=\"hljs-string\">&#x27;zrange&#x27;</span>, lastAccessTimeSetName, <span class=\"hljs-number\">0</span>, cacheSize - maxSize)<br>            <span class=\"hljs-keyword\">for</span> index, lruItem <span class=\"hljs-keyword\">in</span> <span class=\"hljs-built_in\">ipairs</span>(lruItems) <span class=\"hljs-keyword\">do</span><br>                <span class=\"hljs-keyword\">if</span> lruItem <span class=\"hljs-keyword\">and</span> lruItem ~= ARGV[<span class=\"hljs-number\">5</span>] <span class=\"hljs-keyword\">then</span><br>                    <span class=\"hljs-keyword\">local</span> lruItemValue = redis.call(<span class=\"hljs-string\">&#x27;hget&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], lruItem)<br>                    redis.call(<span class=\"hljs-string\">&#x27;hdel&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], lruItem)<br>                    redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">2</span>], lruItem)<br>                    redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], lruItem)<br>                    redis.call(<span class=\"hljs-string\">&#x27;zrem&#x27;</span>, lastAccessTimeSetName, lruItem)<br>                    <span class=\"hljs-keyword\">if</span> lruItemValue ~= <span class=\"hljs-literal\">false</span> <span class=\"hljs-keyword\">then</span><br>                        <span class=\"hljs-keyword\">local</span> removedChannelName = KEYS[<span class=\"hljs-number\">6</span>]<br>                        <span class=\"hljs-keyword\">local</span> ttl, obj = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, lruItemValue)<br>                        <span class=\"hljs-keyword\">local</span> msg = struct.pack(<span class=\"hljs-string\">&#x27;Lc0Lc0&#x27;</span>, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(lruItem), lruItem, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(obj), obj)<br>                        redis.call(<span class=\"hljs-string\">&#x27;publish&#x27;</span>, removedChannelName, msg)<br>                    <span class=\"hljs-keyword\">end</span><br>                <span class=\"hljs-keyword\">end</span><br>            <span class=\"hljs-keyword\">end</span><br>        <span class=\"hljs-keyword\">end</span><br>        <span class=\"hljs-keyword\">if</span> mode == <span class=\"hljs-string\">&#x27;LFU&#x27;</span> <span class=\"hljs-keyword\">then</span> <br>            redis.call(<span class=\"hljs-string\">&#x27;zincrby&#x27;</span>, lastAccessTimeSetName, <span class=\"hljs-number\">1</span>, ARGV[<span class=\"hljs-number\">5</span>]) <br>        <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">end</span><br>    <span class=\"hljs-keyword\">local</span> val = struct.pack(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, <span class=\"hljs-built_in\">tonumber</span>(ARGV[<span class=\"hljs-number\">4</span>]), <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">6</span>]), ARGV[<span class=\"hljs-number\">6</span>])<br>    redis.call(<span class=\"hljs-string\">&#x27;hset&#x27;</span>, KEYS[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>], val)<br>    <span class=\"hljs-keyword\">local</span> msg = struct.pack(<span class=\"hljs-string\">&#x27;Lc0Lc0&#x27;</span>, <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">5</span>]), ARGV[<span class=\"hljs-number\">5</span>], <span class=\"hljs-built_in\">string</span>.<span class=\"hljs-built_in\">len</span>(ARGV[<span class=\"hljs-number\">6</span>]), ARGV[<span class=\"hljs-number\">6</span>])<br>    redis.call(<span class=\"hljs-string\">&#x27;publish&#x27;</span>, KEYS[<span class=\"hljs-number\">4</span>], msg)<br>    <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">nil</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n</li>\n<li><p><strong>处理不可插入的情况</strong>：</p>\n<ul>\n<li>更新过期时间，并返回现有值。<figure class=\"highlight lua\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs lua\"><span class=\"hljs-keyword\">else</span> <br>    <span class=\"hljs-keyword\">local</span> t, val = struct.<span class=\"hljs-built_in\">unpack</span>(<span class=\"hljs-string\">&#x27;dLc0&#x27;</span>, value)<br>    redis.call(<span class=\"hljs-string\">&#x27;zadd&#x27;</span>, KEYS[<span class=\"hljs-number\">3</span>], t + ARGV[<span class=\"hljs-number\">1</span>], ARGV[<span class=\"hljs-number\">5</span>])<br>    <span class=\"hljs-keyword\">return</span> val<br><span class=\"hljs-keyword\">end</span><br></code></pre></td></tr></table></figure></li>\n</ul>\n</li>\n</ol>\n<h3 id=\"参数和键值解释\"><a href=\"#参数和键值解释\" class=\"headerlink\" title=\"参数和键值解释\"></a>参数和键值解释</h3><ul>\n<li><p><code>KEYS[1]</code>: 哈希表存储缓存项。</p>\n</li>\n<li><p><code>KEYS[2]</code>: 有序集合存储过期时间。</p>\n</li>\n<li><p><code>KEYS[3]</code>: 有序集合存储空闲时间。</p>\n</li>\n<li><p><code>KEYS[4]</code>: 频道名称，用于发布缓存项变更消息。</p>\n</li>\n<li><p><code>KEYS[5]</code>: 有序集合存储最近访问时间（LRU模式）。</p>\n</li>\n<li><p><code>KEYS[6]</code>: 频道名称，用于发布被淘汰的缓存项。</p>\n</li>\n<li><p><code>KEYS[7]</code>: 存储缓存配置（如最大尺寸、模式等）。</p>\n</li>\n<li><p><code>ARGV[1]</code>: 当前时间戳。</p>\n</li>\n<li><p><code>ARGV[2]</code>: 新的过期时间。</p>\n</li>\n<li><p><code>ARGV[3]</code>: 新的空闲时间。</p>\n</li>\n<li><p><code>ARGV[4]</code>: 新缓存项的TTL。</p>\n</li>\n<li><p><code>ARGV[5]</code>: 缓存项的键名。</p>\n</li>\n<li><p><code>ARGV[6]</code>: 缓存项的值。</p>\n</li>\n</ul>\n"},{"title":"spring_state_machine","date":"2024-09-19T08:35:59.000Z","_content":"Spring Statemachine 是一个用于处理复杂状态机的框架，能够帮助你管理和控制状态转换。以下是如何在 Spring Boot 项目中使用 Spring Statemachine 的基本步骤：\n\n### 1. **添加依赖**\n\n首先，在你的 `pom.xml` 文件中添加 Spring Statemachine 依赖：\n\n```xml\n<dependency>\n    <groupId>org.springframework.statemachine</groupId>\n    <artifactId>spring-statemachine-core</artifactId>\n    <version>3.0.0</version> <!-- 或者使用最新版本 -->\n</dependency>\n```\n\n### 2. **定义状态和事件**\n\n在 Spring Statemachine 中，你需要定义状态和事件。这些通常是枚举类型。\n\n```java\npublic enum States {\n    START,\n    PROCESSING,\n    FINISHED,\n    ERROR\n}\n\npublic enum Events {\n    BEGIN,\n    COMPLETE,\n    FAIL\n}\n```\n\n### 3. **配置状态机**\n\n接下来，你需要配置状态机的状态和事件。你可以创建一个配置类来完成这一工作。\n\n```java\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.statemachine.config.EnableStateMachine;\nimport org.springframework.statemachine.config.builders.StateMachineBuilder;\nimport org.springframework.statemachine.config.builders.StateMachineConfigurerAdapter;\nimport org.springframework.statemachine.config.builders.StateMachineStateConfigurer;\nimport org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;\nimport org.springframework.statemachine.config.builders.StateMachineStateConfigurer;\nimport org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;\n\n@Configuration\n@EnableStateMachine\npublic class StateMachineConfig extends StateMachineConfigurerAdapter<States, Events> {\n\n    @Override\n    public void configure(StateMachineStateConfigurer<States, Events> states) throws Exception {\n        states\n            .withStates()\n                .initial(States.START)\n                .state(States.PROCESSING)\n                .state(States.FINISHED)\n                .state(States.ERROR);\n    }\n\n    @Override\n    public void configure(StateMachineTransitionConfigurer<States, Events> transitions) throws Exception {\n        transitions\n            .withExternal()\n                .source(States.START).target(States.PROCESSING).event(Events.BEGIN)\n            .and()\n            .withExternal()\n                .source(States.PROCESSING).target(States.FINISHED).event(Events.COMPLETE)\n            .and()\n            .withExternal()\n                .source(States.PROCESSING).target(States.ERROR).event(Events.FAIL);\n    }\n}\n```\n\n### 4. **使用状态机**\n\n你可以在 Spring 组件中注入状态机并使用它来处理状态转换。\n\n```java\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.statemachine.StateMachine;\nimport org.springframework.statemachine.config.StateMachineFactory;\nimport org.springframework.stereotype.Service;\n\n@Service\npublic class StateMachineService {\n\n    @Autowired\n    private StateMachine<States, Events> stateMachine;\n\n    public void startProcess() {\n        stateMachine.sendEvent(Events.BEGIN);\n    }\n\n    public void completeProcess() {\n        stateMachine.sendEvent(Events.COMPLETE);\n    }\n\n    public void failProcess() {\n        stateMachine.sendEvent(Events.FAIL);\n    }\n}\n```\n\n### 5. **运行和测试**\n\n确保你已经启动了 Spring Boot 应用程序，并且在你的服务中调用状态机的方法来触发事件和状态转换。\n\n### 6. **进一步定制**\n\nSpring Statemachine 提供了很多高级功能，比如状态持久化、事件监听器、状态机持久化等。如果你有更多复杂的需求，可以参考 [Spring Statemachine 官方文档](https://docs.spring.io/spring-statemachine/docs/current/reference/html/) 以获取详细的配置信息和示例。\n\n这些是基本的使用步骤，你可以根据实际需要进行更复杂的配置和定制。","source":"_posts/spring-boot/spring-state-machine.md","raw":"---\ntitle: spring_state_machine\ndate: 2024-09-19 16:35:59\ncategories: spring-boot\ntag: 状态机\n---\nSpring Statemachine 是一个用于处理复杂状态机的框架，能够帮助你管理和控制状态转换。以下是如何在 Spring Boot 项目中使用 Spring Statemachine 的基本步骤：\n\n### 1. **添加依赖**\n\n首先，在你的 `pom.xml` 文件中添加 Spring Statemachine 依赖：\n\n```xml\n<dependency>\n    <groupId>org.springframework.statemachine</groupId>\n    <artifactId>spring-statemachine-core</artifactId>\n    <version>3.0.0</version> <!-- 或者使用最新版本 -->\n</dependency>\n```\n\n### 2. **定义状态和事件**\n\n在 Spring Statemachine 中，你需要定义状态和事件。这些通常是枚举类型。\n\n```java\npublic enum States {\n    START,\n    PROCESSING,\n    FINISHED,\n    ERROR\n}\n\npublic enum Events {\n    BEGIN,\n    COMPLETE,\n    FAIL\n}\n```\n\n### 3. **配置状态机**\n\n接下来，你需要配置状态机的状态和事件。你可以创建一个配置类来完成这一工作。\n\n```java\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.statemachine.config.EnableStateMachine;\nimport org.springframework.statemachine.config.builders.StateMachineBuilder;\nimport org.springframework.statemachine.config.builders.StateMachineConfigurerAdapter;\nimport org.springframework.statemachine.config.builders.StateMachineStateConfigurer;\nimport org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;\nimport org.springframework.statemachine.config.builders.StateMachineStateConfigurer;\nimport org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;\n\n@Configuration\n@EnableStateMachine\npublic class StateMachineConfig extends StateMachineConfigurerAdapter<States, Events> {\n\n    @Override\n    public void configure(StateMachineStateConfigurer<States, Events> states) throws Exception {\n        states\n            .withStates()\n                .initial(States.START)\n                .state(States.PROCESSING)\n                .state(States.FINISHED)\n                .state(States.ERROR);\n    }\n\n    @Override\n    public void configure(StateMachineTransitionConfigurer<States, Events> transitions) throws Exception {\n        transitions\n            .withExternal()\n                .source(States.START).target(States.PROCESSING).event(Events.BEGIN)\n            .and()\n            .withExternal()\n                .source(States.PROCESSING).target(States.FINISHED).event(Events.COMPLETE)\n            .and()\n            .withExternal()\n                .source(States.PROCESSING).target(States.ERROR).event(Events.FAIL);\n    }\n}\n```\n\n### 4. **使用状态机**\n\n你可以在 Spring 组件中注入状态机并使用它来处理状态转换。\n\n```java\nimport org.springframework.beans.factory.annotation.Autowired;\nimport org.springframework.statemachine.StateMachine;\nimport org.springframework.statemachine.config.StateMachineFactory;\nimport org.springframework.stereotype.Service;\n\n@Service\npublic class StateMachineService {\n\n    @Autowired\n    private StateMachine<States, Events> stateMachine;\n\n    public void startProcess() {\n        stateMachine.sendEvent(Events.BEGIN);\n    }\n\n    public void completeProcess() {\n        stateMachine.sendEvent(Events.COMPLETE);\n    }\n\n    public void failProcess() {\n        stateMachine.sendEvent(Events.FAIL);\n    }\n}\n```\n\n### 5. **运行和测试**\n\n确保你已经启动了 Spring Boot 应用程序，并且在你的服务中调用状态机的方法来触发事件和状态转换。\n\n### 6. **进一步定制**\n\nSpring Statemachine 提供了很多高级功能，比如状态持久化、事件监听器、状态机持久化等。如果你有更多复杂的需求，可以参考 [Spring Statemachine 官方文档](https://docs.spring.io/spring-statemachine/docs/current/reference/html/) 以获取详细的配置信息和示例。\n\n这些是基本的使用步骤，你可以根据实际需要进行更复杂的配置和定制。","slug":"spring-boot/spring-state-machine","published":1,"updated":"2025-02-18T06:28:00.116Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3n00108gjd2qeggfk5","content":"<p>Spring Statemachine 是一个用于处理复杂状态机的框架，能够帮助你管理和控制状态转换。以下是如何在 Spring Boot 项目中使用 Spring Statemachine 的基本步骤：</p>\n<h3 id=\"1-添加依赖\"><a href=\"#1-添加依赖\" class=\"headerlink\" title=\"1. 添加依赖\"></a>1. <strong>添加依赖</strong></h3><p>首先，在你的 <code>pom.xml</code> 文件中添加 Spring Statemachine 依赖：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.statemachine<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-statemachine-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span> <span class=\"hljs-comment\">&lt;!-- 或者使用最新版本 --&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-定义状态和事件\"><a href=\"#2-定义状态和事件\" class=\"headerlink\" title=\"2. 定义状态和事件\"></a>2. <strong>定义状态和事件</strong></h3><p>在 Spring Statemachine 中，你需要定义状态和事件。这些通常是枚举类型。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">enum</span> <span class=\"hljs-title class_\">States</span> &#123;<br>    START,<br>    PROCESSING,<br>    FINISHED,<br>    ERROR<br>&#125;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">enum</span> <span class=\"hljs-title class_\">Events</span> &#123;<br>    BEGIN,<br>    COMPLETE,<br>    FAIL<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-配置状态机\"><a href=\"#3-配置状态机\" class=\"headerlink\" title=\"3. 配置状态机\"></a>3. <strong>配置状态机</strong></h3><p>接下来，你需要配置状态机的状态和事件。你可以创建一个配置类来完成这一工作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.EnableStateMachine;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineBuilder;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineConfigurerAdapter;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineStateConfigurer;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineStateConfigurer;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;<br><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@EnableStateMachine</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">StateMachineConfig</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">StateMachineConfigurerAdapter</span>&lt;States, Events&gt; &#123;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">configure</span><span class=\"hljs-params\">(StateMachineStateConfigurer&lt;States, Events&gt; states)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        states<br>            .withStates()<br>                .initial(States.START)<br>                .state(States.PROCESSING)<br>                .state(States.FINISHED)<br>                .state(States.ERROR);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">configure</span><span class=\"hljs-params\">(StateMachineTransitionConfigurer&lt;States, Events&gt; transitions)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        transitions<br>            .withExternal()<br>                .source(States.START).target(States.PROCESSING).event(Events.BEGIN)<br>            .and()<br>            .withExternal()<br>                .source(States.PROCESSING).target(States.FINISHED).event(Events.COMPLETE)<br>            .and()<br>            .withExternal()<br>                .source(States.PROCESSING).target(States.ERROR).event(Events.FAIL);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"4-使用状态机\"><a href=\"#4-使用状态机\" class=\"headerlink\" title=\"4. 使用状态机\"></a>4. <strong>使用状态机</strong></h3><p>你可以在 Spring 组件中注入状态机并使用它来处理状态转换。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.StateMachine;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.StateMachineFactory;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">StateMachineService</span> &#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> StateMachine&lt;States, Events&gt; stateMachine;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">startProcess</span><span class=\"hljs-params\">()</span> &#123;<br>        stateMachine.sendEvent(Events.BEGIN);<br>    &#125;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">completeProcess</span><span class=\"hljs-params\">()</span> &#123;<br>        stateMachine.sendEvent(Events.COMPLETE);<br>    &#125;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">failProcess</span><span class=\"hljs-params\">()</span> &#123;<br>        stateMachine.sendEvent(Events.FAIL);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"5-运行和测试\"><a href=\"#5-运行和测试\" class=\"headerlink\" title=\"5. 运行和测试\"></a>5. <strong>运行和测试</strong></h3><p>确保你已经启动了 Spring Boot 应用程序，并且在你的服务中调用状态机的方法来触发事件和状态转换。</p>\n<h3 id=\"6-进一步定制\"><a href=\"#6-进一步定制\" class=\"headerlink\" title=\"6. 进一步定制\"></a>6. <strong>进一步定制</strong></h3><p>Spring Statemachine 提供了很多高级功能，比如状态持久化、事件监听器、状态机持久化等。如果你有更多复杂的需求，可以参考 <a href=\"https://docs.spring.io/spring-statemachine/docs/current/reference/html/\">Spring Statemachine 官方文档</a> 以获取详细的配置信息和示例。</p>\n<p>这些是基本的使用步骤，你可以根据实际需要进行更复杂的配置和定制。</p>\n","excerpt":"","more":"<p>Spring Statemachine 是一个用于处理复杂状态机的框架，能够帮助你管理和控制状态转换。以下是如何在 Spring Boot 项目中使用 Spring Statemachine 的基本步骤：</p>\n<h3 id=\"1-添加依赖\"><a href=\"#1-添加依赖\" class=\"headerlink\" title=\"1. 添加依赖\"></a>1. <strong>添加依赖</strong></h3><p>首先，在你的 <code>pom.xml</code> 文件中添加 Spring Statemachine 依赖：</p>\n<figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.statemachine<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-statemachine-core<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>3.0.0<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span> <span class=\"hljs-comment\">&lt;!-- 或者使用最新版本 --&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n\n<h3 id=\"2-定义状态和事件\"><a href=\"#2-定义状态和事件\" class=\"headerlink\" title=\"2. 定义状态和事件\"></a>2. <strong>定义状态和事件</strong></h3><p>在 Spring Statemachine 中，你需要定义状态和事件。这些通常是枚举类型。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">enum</span> <span class=\"hljs-title class_\">States</span> &#123;<br>    START,<br>    PROCESSING,<br>    FINISHED,<br>    ERROR<br>&#125;<br><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">enum</span> <span class=\"hljs-title class_\">Events</span> &#123;<br>    BEGIN,<br>    COMPLETE,<br>    FAIL<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"3-配置状态机\"><a href=\"#3-配置状态机\" class=\"headerlink\" title=\"3. 配置状态机\"></a>3. <strong>配置状态机</strong></h3><p>接下来，你需要配置状态机的状态和事件。你可以创建一个配置类来完成这一工作。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Bean;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.EnableStateMachine;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineBuilder;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineConfigurerAdapter;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineStateConfigurer;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineStateConfigurer;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.builders.StateMachineTransitionConfigurer;<br><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-meta\">@EnableStateMachine</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">StateMachineConfig</span> <span class=\"hljs-keyword\">extends</span> <span class=\"hljs-title class_\">StateMachineConfigurerAdapter</span>&lt;States, Events&gt; &#123;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">configure</span><span class=\"hljs-params\">(StateMachineStateConfigurer&lt;States, Events&gt; states)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        states<br>            .withStates()<br>                .initial(States.START)<br>                .state(States.PROCESSING)<br>                .state(States.FINISHED)<br>                .state(States.ERROR);<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">configure</span><span class=\"hljs-params\">(StateMachineTransitionConfigurer&lt;States, Events&gt; transitions)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        transitions<br>            .withExternal()<br>                .source(States.START).target(States.PROCESSING).event(Events.BEGIN)<br>            .and()<br>            .withExternal()<br>                .source(States.PROCESSING).target(States.FINISHED).event(Events.COMPLETE)<br>            .and()<br>            .withExternal()<br>                .source(States.PROCESSING).target(States.ERROR).event(Events.FAIL);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"4-使用状态机\"><a href=\"#4-使用状态机\" class=\"headerlink\" title=\"4. 使用状态机\"></a>4. <strong>使用状态机</strong></h3><p>你可以在 Spring 组件中注入状态机并使用它来处理状态转换。</p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.StateMachine;<br><span class=\"hljs-keyword\">import</span> org.springframework.statemachine.config.StateMachineFactory;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Service;<br><br><span class=\"hljs-meta\">@Service</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">StateMachineService</span> &#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> StateMachine&lt;States, Events&gt; stateMachine;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">startProcess</span><span class=\"hljs-params\">()</span> &#123;<br>        stateMachine.sendEvent(Events.BEGIN);<br>    &#125;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">completeProcess</span><span class=\"hljs-params\">()</span> &#123;<br>        stateMachine.sendEvent(Events.COMPLETE);<br>    &#125;<br><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">failProcess</span><span class=\"hljs-params\">()</span> &#123;<br>        stateMachine.sendEvent(Events.FAIL);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<h3 id=\"5-运行和测试\"><a href=\"#5-运行和测试\" class=\"headerlink\" title=\"5. 运行和测试\"></a>5. <strong>运行和测试</strong></h3><p>确保你已经启动了 Spring Boot 应用程序，并且在你的服务中调用状态机的方法来触发事件和状态转换。</p>\n<h3 id=\"6-进一步定制\"><a href=\"#6-进一步定制\" class=\"headerlink\" title=\"6. 进一步定制\"></a>6. <strong>进一步定制</strong></h3><p>Spring Statemachine 提供了很多高级功能，比如状态持久化、事件监听器、状态机持久化等。如果你有更多复杂的需求，可以参考 <a href=\"https://docs.spring.io/spring-statemachine/docs/current/reference/html/\">Spring Statemachine 官方文档</a> 以获取详细的配置信息和示例。</p>\n<p>这些是基本的使用步骤，你可以根据实际需要进行更复杂的配置和定制。</p>\n"},{"title":"使用切面或拦截器打印异常日志","date":"2024-07-26T09:01:47.000Z","_content":"在Spring Boot中，使用切面（Aspect）或拦截器（Interceptor）来捕获异常并记录日志是一种常见的做法。下面介绍如何使用这两种方式来实现。\n\n### 1. 使用切面（Aspect）记录异常日志\n\nSpring AOP（Aspect-Oriented Programming）允许你定义横切关注点，比如日志记录、事务管理等。可以通过编写一个切面来捕获所有方法中的异常并记录日志。\n\n#### 步骤：\n\n1. **添加依赖**：\n   确保你的项目中包含Spring AOP相关依赖。如果你使用的是Maven，确保`spring-boot-starter-aop`已经在你的`pom.xml`中。\n\n    ```xml\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-aop</artifactId>\n    </dependency>\n    ```\n\n2. **创建切面类**：\n\n    ```java\n    import org.aspectj.lang.annotation.AfterThrowing;\n    import org.aspectj.lang.annotation.Aspect;\n    import org.springframework.stereotype.Component;\n    import org.slf4j.Logger;\n    import org.slf4j.LoggerFactory;\n\n    @Aspect\n    @Component\n    public class ExceptionLoggingAspect {\n\n        private static final Logger logger = LoggerFactory.getLogger(ExceptionLoggingAspect.class);\n\n        // 定义一个切入点，拦截所有方法\n        @AfterThrowing(pointcut = \"execution(* com.yourpackage..*(..))\", throwing = \"exception\")\n        public void logException(Exception exception) {\n            logger.error(\"Exception caught: \", exception);\n        }\n    }\n    ```\n\n   在上述代码中，`@AfterThrowing`注解用于定义在方法抛出异常后执行的通知。`execution(* com.yourpackage..*(..))`表示拦截`com.yourpackage`包及其子包中所有类的所有方法。\n\n### 2. 使用拦截器（Interceptor）记录异常日志\n\nSpring中的拦截器允许你在HTTP请求处理的各个阶段执行一些操作，可以用来记录异常日志。\n\n#### 步骤：\n\n1. **创建拦截器类**：\n\n    ```java\n    import org.springframework.stereotype.Component;\n    import org.springframework.web.servlet.HandlerInterceptor;\n    import org.springframework.web.servlet.ModelAndView;\n\n    import javax.servlet.http.HttpServletRequest;\n    import javax.servlet.http.HttpServletResponse;\n\n    @Component\n    public class ExceptionLoggingInterceptor implements HandlerInterceptor {\n\n        @Override\n        public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n            return true;\n        }\n\n        @Override\n        public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        }\n\n        @Override\n        public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n            if (ex != null) {\n                // 记录异常日志\n                Logger logger = LoggerFactory.getLogger(handler.getClass());\n                logger.error(\"Exception caught during request processing: \", ex);\n            }\n        }\n    }\n    ```\n\n2. **注册拦截器**：\n\n   在Spring Boot应用中，通过配置类注册拦截器。\n\n    ```java\n    import org.springframework.beans.factory.annotation.Autowired;\n    import org.springframework.context.annotation.Configuration;\n    import org.springframework.web.servlet.config.annotation.InterceptorRegistry;\n    import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n    @Configuration\n    public class WebConfig implements WebMvcConfigurer {\n\n        @Autowired\n        private ExceptionLoggingInterceptor exceptionLoggingInterceptor;\n\n        @Override\n        public void addInterceptors(InterceptorRegistry registry) {\n            registry.addInterceptor(exceptionLoggingInterceptor);\n        }\n    }\n    ```\n\n### 总结\n\n这两种方式各有优劣：\n\n- **切面（Aspect）**适用于需要在方法级别捕获异常的情况，可以轻松应用于所有方法。\n- **拦截器（Interceptor）**适用于需要在请求级别捕获异常的情况，更适合Web应用程序中的HTTP请求处理。\n\n选择哪种方式取决于你的具体需求。如果你希望对所有方法的异常进行统一处理，切面可能更合适；如果你需要对HTTP请求处理的异常进行统一处理，拦截器则更为合适。","source":"_posts/spring-boot/使用切面或拦截器打印异常日志.md","raw":"---\ntitle: 使用切面或拦截器打印异常日志\ndate: 2024-07-26 17:01:47\ncategories: spring-boot\ntag: 打印异常日志\n---\n在Spring Boot中，使用切面（Aspect）或拦截器（Interceptor）来捕获异常并记录日志是一种常见的做法。下面介绍如何使用这两种方式来实现。\n\n### 1. 使用切面（Aspect）记录异常日志\n\nSpring AOP（Aspect-Oriented Programming）允许你定义横切关注点，比如日志记录、事务管理等。可以通过编写一个切面来捕获所有方法中的异常并记录日志。\n\n#### 步骤：\n\n1. **添加依赖**：\n   确保你的项目中包含Spring AOP相关依赖。如果你使用的是Maven，确保`spring-boot-starter-aop`已经在你的`pom.xml`中。\n\n    ```xml\n    <dependency>\n        <groupId>org.springframework.boot</groupId>\n        <artifactId>spring-boot-starter-aop</artifactId>\n    </dependency>\n    ```\n\n2. **创建切面类**：\n\n    ```java\n    import org.aspectj.lang.annotation.AfterThrowing;\n    import org.aspectj.lang.annotation.Aspect;\n    import org.springframework.stereotype.Component;\n    import org.slf4j.Logger;\n    import org.slf4j.LoggerFactory;\n\n    @Aspect\n    @Component\n    public class ExceptionLoggingAspect {\n\n        private static final Logger logger = LoggerFactory.getLogger(ExceptionLoggingAspect.class);\n\n        // 定义一个切入点，拦截所有方法\n        @AfterThrowing(pointcut = \"execution(* com.yourpackage..*(..))\", throwing = \"exception\")\n        public void logException(Exception exception) {\n            logger.error(\"Exception caught: \", exception);\n        }\n    }\n    ```\n\n   在上述代码中，`@AfterThrowing`注解用于定义在方法抛出异常后执行的通知。`execution(* com.yourpackage..*(..))`表示拦截`com.yourpackage`包及其子包中所有类的所有方法。\n\n### 2. 使用拦截器（Interceptor）记录异常日志\n\nSpring中的拦截器允许你在HTTP请求处理的各个阶段执行一些操作，可以用来记录异常日志。\n\n#### 步骤：\n\n1. **创建拦截器类**：\n\n    ```java\n    import org.springframework.stereotype.Component;\n    import org.springframework.web.servlet.HandlerInterceptor;\n    import org.springframework.web.servlet.ModelAndView;\n\n    import javax.servlet.http.HttpServletRequest;\n    import javax.servlet.http.HttpServletResponse;\n\n    @Component\n    public class ExceptionLoggingInterceptor implements HandlerInterceptor {\n\n        @Override\n        public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {\n            return true;\n        }\n\n        @Override\n        public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception {\n        }\n\n        @Override\n        public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception {\n            if (ex != null) {\n                // 记录异常日志\n                Logger logger = LoggerFactory.getLogger(handler.getClass());\n                logger.error(\"Exception caught during request processing: \", ex);\n            }\n        }\n    }\n    ```\n\n2. **注册拦截器**：\n\n   在Spring Boot应用中，通过配置类注册拦截器。\n\n    ```java\n    import org.springframework.beans.factory.annotation.Autowired;\n    import org.springframework.context.annotation.Configuration;\n    import org.springframework.web.servlet.config.annotation.InterceptorRegistry;\n    import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;\n\n    @Configuration\n    public class WebConfig implements WebMvcConfigurer {\n\n        @Autowired\n        private ExceptionLoggingInterceptor exceptionLoggingInterceptor;\n\n        @Override\n        public void addInterceptors(InterceptorRegistry registry) {\n            registry.addInterceptor(exceptionLoggingInterceptor);\n        }\n    }\n    ```\n\n### 总结\n\n这两种方式各有优劣：\n\n- **切面（Aspect）**适用于需要在方法级别捕获异常的情况，可以轻松应用于所有方法。\n- **拦截器（Interceptor）**适用于需要在请求级别捕获异常的情况，更适合Web应用程序中的HTTP请求处理。\n\n选择哪种方式取决于你的具体需求。如果你希望对所有方法的异常进行统一处理，切面可能更合适；如果你需要对HTTP请求处理的异常进行统一处理，拦截器则更为合适。","slug":"spring-boot/使用切面或拦截器打印异常日志","published":1,"updated":"2025-02-18T06:26:47.387Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3o00148gjd872m7uzz","content":"<p>在Spring Boot中，使用切面（Aspect）或拦截器（Interceptor）来捕获异常并记录日志是一种常见的做法。下面介绍如何使用这两种方式来实现。</p>\n<h3 id=\"1-使用切面（Aspect）记录异常日志\"><a href=\"#1-使用切面（Aspect）记录异常日志\" class=\"headerlink\" title=\"1. 使用切面（Aspect）记录异常日志\"></a>1. 使用切面（Aspect）记录异常日志</h3><p>Spring AOP（Aspect-Oriented Programming）允许你定义横切关注点，比如日志记录、事务管理等。可以通过编写一个切面来捕获所有方法中的异常并记录日志。</p>\n<h4 id=\"步骤：\"><a href=\"#步骤：\" class=\"headerlink\" title=\"步骤：\"></a>步骤：</h4><ol>\n<li><p><strong>添加依赖</strong>：<br>确保你的项目中包含Spring AOP相关依赖。如果你使用的是Maven，确保<code>spring-boot-starter-aop</code>已经在你的<code>pom.xml</code>中。</p>\n <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-aop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>创建切面类</strong>：</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.aspectj.lang.annotation.AfterThrowing;<br><span class=\"hljs-keyword\">import</span> org.aspectj.lang.annotation.Aspect;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;<br><span class=\"hljs-keyword\">import</span> org.slf4j.Logger;<br><span class=\"hljs-keyword\">import</span> org.slf4j.LoggerFactory;<br><br><span class=\"hljs-meta\">@Aspect</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ExceptionLoggingAspect</span> &#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Logger</span> <span class=\"hljs-variable\">logger</span> <span class=\"hljs-operator\">=</span> LoggerFactory.getLogger(ExceptionLoggingAspect.class);<br><br>    <span class=\"hljs-comment\">// 定义一个切入点，拦截所有方法</span><br>    <span class=\"hljs-meta\">@AfterThrowing(pointcut = &quot;execution(* com.yourpackage..*(..))&quot;, throwing = &quot;exception&quot;)</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">logException</span><span class=\"hljs-params\">(Exception exception)</span> &#123;<br>        logger.error(<span class=\"hljs-string\">&quot;Exception caught: &quot;</span>, exception);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在上述代码中，<code>@AfterThrowing</code>注解用于定义在方法抛出异常后执行的通知。<code>execution(* com.yourpackage..*(..))</code>表示拦截<code>com.yourpackage</code>包及其子包中所有类的所有方法。</p>\n</li>\n</ol>\n<h3 id=\"2-使用拦截器（Interceptor）记录异常日志\"><a href=\"#2-使用拦截器（Interceptor）记录异常日志\" class=\"headerlink\" title=\"2. 使用拦截器（Interceptor）记录异常日志\"></a>2. 使用拦截器（Interceptor）记录异常日志</h3><p>Spring中的拦截器允许你在HTTP请求处理的各个阶段执行一些操作，可以用来记录异常日志。</p>\n<h4 id=\"步骤：-1\"><a href=\"#步骤：-1\" class=\"headerlink\" title=\"步骤：\"></a>步骤：</h4><ol>\n<li><p><strong>创建拦截器类</strong>：</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.servlet.ModelAndView;<br><br><span class=\"hljs-keyword\">import</span> javax.servlet.http.HttpServletRequest;<br><span class=\"hljs-keyword\">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ExceptionLoggingInterceptor</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">HandlerInterceptor</span> &#123;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">preHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">postHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">afterCompletion</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        <span class=\"hljs-keyword\">if</span> (ex != <span class=\"hljs-literal\">null</span>) &#123;<br>            <span class=\"hljs-comment\">// 记录异常日志</span><br>            <span class=\"hljs-type\">Logger</span> <span class=\"hljs-variable\">logger</span> <span class=\"hljs-operator\">=</span> LoggerFactory.getLogger(handler.getClass());<br>            logger.error(<span class=\"hljs-string\">&quot;Exception caught during request processing: &quot;</span>, ex);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>注册拦截器</strong>：</p>\n<p>在Spring Boot应用中，通过配置类注册拦截器。</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">WebConfig</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">WebMvcConfigurer</span> &#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> ExceptionLoggingInterceptor exceptionLoggingInterceptor;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">addInterceptors</span><span class=\"hljs-params\">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(exceptionLoggingInterceptor);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>这两种方式各有优劣：</p>\n<ul>\n<li><strong>切面（Aspect）</strong>适用于需要在方法级别捕获异常的情况，可以轻松应用于所有方法。</li>\n<li><strong>拦截器（Interceptor）</strong>适用于需要在请求级别捕获异常的情况，更适合Web应用程序中的HTTP请求处理。</li>\n</ul>\n<p>选择哪种方式取决于你的具体需求。如果你希望对所有方法的异常进行统一处理，切面可能更合适；如果你需要对HTTP请求处理的异常进行统一处理，拦截器则更为合适。</p>\n","excerpt":"","more":"<p>在Spring Boot中，使用切面（Aspect）或拦截器（Interceptor）来捕获异常并记录日志是一种常见的做法。下面介绍如何使用这两种方式来实现。</p>\n<h3 id=\"1-使用切面（Aspect）记录异常日志\"><a href=\"#1-使用切面（Aspect）记录异常日志\" class=\"headerlink\" title=\"1. 使用切面（Aspect）记录异常日志\"></a>1. 使用切面（Aspect）记录异常日志</h3><p>Spring AOP（Aspect-Oriented Programming）允许你定义横切关注点，比如日志记录、事务管理等。可以通过编写一个切面来捕获所有方法中的异常并记录日志。</p>\n<h4 id=\"步骤：\"><a href=\"#步骤：\" class=\"headerlink\" title=\"步骤：\"></a>步骤：</h4><ol>\n<li><p><strong>添加依赖</strong>：<br>确保你的项目中包含Spring AOP相关依赖。如果你使用的是Maven，确保<code>spring-boot-starter-aop</code>已经在你的<code>pom.xml</code>中。</p>\n <figure class=\"highlight xml\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs xml\"><span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>org.springframework.boot<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span><br>    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>spring-boot-starter-aop<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span><br><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>创建切面类</strong>：</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.aspectj.lang.annotation.AfterThrowing;<br><span class=\"hljs-keyword\">import</span> org.aspectj.lang.annotation.Aspect;<br><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;<br><span class=\"hljs-keyword\">import</span> org.slf4j.Logger;<br><span class=\"hljs-keyword\">import</span> org.slf4j.LoggerFactory;<br><br><span class=\"hljs-meta\">@Aspect</span><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ExceptionLoggingAspect</span> &#123;<br><br>    <span class=\"hljs-keyword\">private</span> <span class=\"hljs-keyword\">static</span> <span class=\"hljs-keyword\">final</span> <span class=\"hljs-type\">Logger</span> <span class=\"hljs-variable\">logger</span> <span class=\"hljs-operator\">=</span> LoggerFactory.getLogger(ExceptionLoggingAspect.class);<br><br>    <span class=\"hljs-comment\">// 定义一个切入点，拦截所有方法</span><br>    <span class=\"hljs-meta\">@AfterThrowing(pointcut = &quot;execution(* com.yourpackage..*(..))&quot;, throwing = &quot;exception&quot;)</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">logException</span><span class=\"hljs-params\">(Exception exception)</span> &#123;<br>        logger.error(<span class=\"hljs-string\">&quot;Exception caught: &quot;</span>, exception);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n\n<p>在上述代码中，<code>@AfterThrowing</code>注解用于定义在方法抛出异常后执行的通知。<code>execution(* com.yourpackage..*(..))</code>表示拦截<code>com.yourpackage</code>包及其子包中所有类的所有方法。</p>\n</li>\n</ol>\n<h3 id=\"2-使用拦截器（Interceptor）记录异常日志\"><a href=\"#2-使用拦截器（Interceptor）记录异常日志\" class=\"headerlink\" title=\"2. 使用拦截器（Interceptor）记录异常日志\"></a>2. 使用拦截器（Interceptor）记录异常日志</h3><p>Spring中的拦截器允许你在HTTP请求处理的各个阶段执行一些操作，可以用来记录异常日志。</p>\n<h4 id=\"步骤：-1\"><a href=\"#步骤：-1\" class=\"headerlink\" title=\"步骤：\"></a>步骤：</h4><ol>\n<li><p><strong>创建拦截器类</strong>：</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.springframework.stereotype.Component;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.servlet.HandlerInterceptor;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.servlet.ModelAndView;<br><br><span class=\"hljs-keyword\">import</span> javax.servlet.http.HttpServletRequest;<br><span class=\"hljs-keyword\">import</span> javax.servlet.http.HttpServletResponse;<br><br><span class=\"hljs-meta\">@Component</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">ExceptionLoggingInterceptor</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">HandlerInterceptor</span> &#123;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-type\">boolean</span> <span class=\"hljs-title function_\">preHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        <span class=\"hljs-keyword\">return</span> <span class=\"hljs-literal\">true</span>;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">postHandle</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>    &#125;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">afterCompletion</span><span class=\"hljs-params\">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class=\"hljs-keyword\">throws</span> Exception &#123;<br>        <span class=\"hljs-keyword\">if</span> (ex != <span class=\"hljs-literal\">null</span>) &#123;<br>            <span class=\"hljs-comment\">// 记录异常日志</span><br>            <span class=\"hljs-type\">Logger</span> <span class=\"hljs-variable\">logger</span> <span class=\"hljs-operator\">=</span> LoggerFactory.getLogger(handler.getClass());<br>            logger.error(<span class=\"hljs-string\">&quot;Exception caught during request processing: &quot;</span>, ex);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>\n</li>\n<li><p><strong>注册拦截器</strong>：</p>\n<p>在Spring Boot应用中，通过配置类注册拦截器。</p>\n <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs java\"><span class=\"hljs-keyword\">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class=\"hljs-keyword\">import</span> org.springframework.context.annotation.Configuration;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.servlet.config.annotation.InterceptorRegistry;<br><span class=\"hljs-keyword\">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class=\"hljs-meta\">@Configuration</span><br><span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">class</span> <span class=\"hljs-title class_\">WebConfig</span> <span class=\"hljs-keyword\">implements</span> <span class=\"hljs-title class_\">WebMvcConfigurer</span> &#123;<br><br>    <span class=\"hljs-meta\">@Autowired</span><br>    <span class=\"hljs-keyword\">private</span> ExceptionLoggingInterceptor exceptionLoggingInterceptor;<br><br>    <span class=\"hljs-meta\">@Override</span><br>    <span class=\"hljs-keyword\">public</span> <span class=\"hljs-keyword\">void</span> <span class=\"hljs-title function_\">addInterceptors</span><span class=\"hljs-params\">(InterceptorRegistry registry)</span> &#123;<br>        registry.addInterceptor(exceptionLoggingInterceptor);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>\n</ol>\n<h3 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h3><p>这两种方式各有优劣：</p>\n<ul>\n<li><strong>切面（Aspect）</strong>适用于需要在方法级别捕获异常的情况，可以轻松应用于所有方法。</li>\n<li><strong>拦截器（Interceptor）</strong>适用于需要在请求级别捕获异常的情况，更适合Web应用程序中的HTTP请求处理。</li>\n</ul>\n<p>选择哪种方式取决于你的具体需求。如果你希望对所有方法的异常进行统一处理，切面可能更合适；如果你需要对HTTP请求处理的异常进行统一处理，拦截器则更为合适。</p>\n"},{"title":"select for update用法的好处","date":"2024-07-25T11:10:03.000Z","_content":"`SELECT FOR UPDATE` 是一种用于数据库管理系统（DBMS）的 SQL 语句，主要用于在事务处理过程中锁定选定的行，防止其他事务修改这些行，直到当前事务完成。这种机制在处理并发访问时尤其有用，以下是其具体好处：\n\n### 1. **避免脏读、不可重复读和幻读**\n通过使用 `SELECT FOR UPDATE`，可以锁定选定的行，确保其他事务无法对这些行进行修改，从而防止以下类型的并发问题：\n- **脏读**：一个事务可以读取到另一个未提交事务的修改。\n- **不可重复读**：一个事务在两次读取之间，另一个事务修改了数据，导致两次读取结果不同。\n- **幻读**：一个事务在两次读取之间，另一个事务插入了新行，导致第二次读取返回更多行。\n\n### 2. **确保一致性和完整性**\n在执行复杂的业务逻辑时，例如账户转账、库存更新等，使用 `SELECT FOR UPDATE` 可以确保在整个事务过程中数据的一致性和完整性。这样可以避免在事务中间其他事务对数据的修改，导致数据不一致。\n\n### 3. **防止丢失更新**\n当多个事务试图同时更新同一行时，`SELECT FOR UPDATE` 可以防止丢失更新问题。它确保一个事务完成后，其他事务才能继续执行更新操作，避免了两个事务的更新互相覆盖。\n\n### 4. **优化并发控制**\n使用 `SELECT FOR UPDATE` 可以提供细粒度的并发控制，通过只锁定必要的行，而不是整个表，从而提高系统的并发性能和资源利用率。\n\n### 5. **简化编程模型**\n`SELECT FOR UPDATE` 可以简化开发人员的编程模型，不需要手动处理复杂的锁机制，数据库会自动处理行锁定和释放，从而减少编程错误的机会。\n\n### 使用示例\n```sql\nBEGIN;\nSELECT * FROM accounts WHERE account_id = 1 FOR UPDATE;\n-- 执行一些需要锁定这行的操作，例如更新账户余额\nUPDATE accounts SET balance = balance - 100 WHERE account_id = 1;\nCOMMIT;\n```\n\n在这个示例中，通过 `SELECT FOR UPDATE` 锁定 `account_id = 1` 的行，确保在事务提交之前，没有其他事务可以修改该行。\n\n总的来说，`SELECT FOR UPDATE` 提供了一种强大的并发控制机制，帮助确保数据的完整性、一致性，并防止并发修改导致的问题。","source":"_posts/mysql/select-for-update用法的好处.md","raw":"---\ntitle: select for update用法的好处\ndate: 2024-07-25 19:10:03\ncategories: mysql\ntag: 事务\n---\n`SELECT FOR UPDATE` 是一种用于数据库管理系统（DBMS）的 SQL 语句，主要用于在事务处理过程中锁定选定的行，防止其他事务修改这些行，直到当前事务完成。这种机制在处理并发访问时尤其有用，以下是其具体好处：\n\n### 1. **避免脏读、不可重复读和幻读**\n通过使用 `SELECT FOR UPDATE`，可以锁定选定的行，确保其他事务无法对这些行进行修改，从而防止以下类型的并发问题：\n- **脏读**：一个事务可以读取到另一个未提交事务的修改。\n- **不可重复读**：一个事务在两次读取之间，另一个事务修改了数据，导致两次读取结果不同。\n- **幻读**：一个事务在两次读取之间，另一个事务插入了新行，导致第二次读取返回更多行。\n\n### 2. **确保一致性和完整性**\n在执行复杂的业务逻辑时，例如账户转账、库存更新等，使用 `SELECT FOR UPDATE` 可以确保在整个事务过程中数据的一致性和完整性。这样可以避免在事务中间其他事务对数据的修改，导致数据不一致。\n\n### 3. **防止丢失更新**\n当多个事务试图同时更新同一行时，`SELECT FOR UPDATE` 可以防止丢失更新问题。它确保一个事务完成后，其他事务才能继续执行更新操作，避免了两个事务的更新互相覆盖。\n\n### 4. **优化并发控制**\n使用 `SELECT FOR UPDATE` 可以提供细粒度的并发控制，通过只锁定必要的行，而不是整个表，从而提高系统的并发性能和资源利用率。\n\n### 5. **简化编程模型**\n`SELECT FOR UPDATE` 可以简化开发人员的编程模型，不需要手动处理复杂的锁机制，数据库会自动处理行锁定和释放，从而减少编程错误的机会。\n\n### 使用示例\n```sql\nBEGIN;\nSELECT * FROM accounts WHERE account_id = 1 FOR UPDATE;\n-- 执行一些需要锁定这行的操作，例如更新账户余额\nUPDATE accounts SET balance = balance - 100 WHERE account_id = 1;\nCOMMIT;\n```\n\n在这个示例中，通过 `SELECT FOR UPDATE` 锁定 `account_id = 1` 的行，确保在事务提交之前，没有其他事务可以修改该行。\n\n总的来说，`SELECT FOR UPDATE` 提供了一种强大的并发控制机制，帮助确保数据的完整性、一致性，并防止并发修改导致的问题。","slug":"mysql/select-for-update用法的好处","published":1,"updated":"2025-02-18T06:28:30.279Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3o00178gjd1p7p6ny6","content":"<p><code>SELECT FOR UPDATE</code> 是一种用于数据库管理系统（DBMS）的 SQL 语句，主要用于在事务处理过程中锁定选定的行，防止其他事务修改这些行，直到当前事务完成。这种机制在处理并发访问时尤其有用，以下是其具体好处：</p>\n<h3 id=\"1-避免脏读、不可重复读和幻读\"><a href=\"#1-避免脏读、不可重复读和幻读\" class=\"headerlink\" title=\"1. 避免脏读、不可重复读和幻读\"></a>1. <strong>避免脏读、不可重复读和幻读</strong></h3><p>通过使用 <code>SELECT FOR UPDATE</code>，可以锁定选定的行，确保其他事务无法对这些行进行修改，从而防止以下类型的并发问题：</p>\n<ul>\n<li><strong>脏读</strong>：一个事务可以读取到另一个未提交事务的修改。</li>\n<li><strong>不可重复读</strong>：一个事务在两次读取之间，另一个事务修改了数据，导致两次读取结果不同。</li>\n<li><strong>幻读</strong>：一个事务在两次读取之间，另一个事务插入了新行，导致第二次读取返回更多行。</li>\n</ul>\n<h3 id=\"2-确保一致性和完整性\"><a href=\"#2-确保一致性和完整性\" class=\"headerlink\" title=\"2. 确保一致性和完整性\"></a>2. <strong>确保一致性和完整性</strong></h3><p>在执行复杂的业务逻辑时，例如账户转账、库存更新等，使用 <code>SELECT FOR UPDATE</code> 可以确保在整个事务过程中数据的一致性和完整性。这样可以避免在事务中间其他事务对数据的修改，导致数据不一致。</p>\n<h3 id=\"3-防止丢失更新\"><a href=\"#3-防止丢失更新\" class=\"headerlink\" title=\"3. 防止丢失更新\"></a>3. <strong>防止丢失更新</strong></h3><p>当多个事务试图同时更新同一行时，<code>SELECT FOR UPDATE</code> 可以防止丢失更新问题。它确保一个事务完成后，其他事务才能继续执行更新操作，避免了两个事务的更新互相覆盖。</p>\n<h3 id=\"4-优化并发控制\"><a href=\"#4-优化并发控制\" class=\"headerlink\" title=\"4. 优化并发控制\"></a>4. <strong>优化并发控制</strong></h3><p>使用 <code>SELECT FOR UPDATE</code> 可以提供细粒度的并发控制，通过只锁定必要的行，而不是整个表，从而提高系统的并发性能和资源利用率。</p>\n<h3 id=\"5-简化编程模型\"><a href=\"#5-简化编程模型\" class=\"headerlink\" title=\"5. 简化编程模型\"></a>5. <strong>简化编程模型</strong></h3><p><code>SELECT FOR UPDATE</code> 可以简化开发人员的编程模型，不需要手动处理复杂的锁机制，数据库会自动处理行锁定和释放，从而减少编程错误的机会。</p>\n<h3 id=\"使用示例\"><a href=\"#使用示例\" class=\"headerlink\" title=\"使用示例\"></a>使用示例</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">BEGIN</span>;<br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> accounts <span class=\"hljs-keyword\">WHERE</span> account_id <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">FOR</span> <span class=\"hljs-keyword\">UPDATE</span>;<br><span class=\"hljs-comment\">-- 执行一些需要锁定这行的操作，例如更新账户余额</span><br><span class=\"hljs-keyword\">UPDATE</span> accounts <span class=\"hljs-keyword\">SET</span> balance <span class=\"hljs-operator\">=</span> balance <span class=\"hljs-operator\">-</span> <span class=\"hljs-number\">100</span> <span class=\"hljs-keyword\">WHERE</span> account_id <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span>;<br><span class=\"hljs-keyword\">COMMIT</span>;<br></code></pre></td></tr></table></figure>\n\n<p>在这个示例中，通过 <code>SELECT FOR UPDATE</code> 锁定 <code>account_id = 1</code> 的行，确保在事务提交之前，没有其他事务可以修改该行。</p>\n<p>总的来说，<code>SELECT FOR UPDATE</code> 提供了一种强大的并发控制机制，帮助确保数据的完整性、一致性，并防止并发修改导致的问题。</p>\n","excerpt":"","more":"<p><code>SELECT FOR UPDATE</code> 是一种用于数据库管理系统（DBMS）的 SQL 语句，主要用于在事务处理过程中锁定选定的行，防止其他事务修改这些行，直到当前事务完成。这种机制在处理并发访问时尤其有用，以下是其具体好处：</p>\n<h3 id=\"1-避免脏读、不可重复读和幻读\"><a href=\"#1-避免脏读、不可重复读和幻读\" class=\"headerlink\" title=\"1. 避免脏读、不可重复读和幻读\"></a>1. <strong>避免脏读、不可重复读和幻读</strong></h3><p>通过使用 <code>SELECT FOR UPDATE</code>，可以锁定选定的行，确保其他事务无法对这些行进行修改，从而防止以下类型的并发问题：</p>\n<ul>\n<li><strong>脏读</strong>：一个事务可以读取到另一个未提交事务的修改。</li>\n<li><strong>不可重复读</strong>：一个事务在两次读取之间，另一个事务修改了数据，导致两次读取结果不同。</li>\n<li><strong>幻读</strong>：一个事务在两次读取之间，另一个事务插入了新行，导致第二次读取返回更多行。</li>\n</ul>\n<h3 id=\"2-确保一致性和完整性\"><a href=\"#2-确保一致性和完整性\" class=\"headerlink\" title=\"2. 确保一致性和完整性\"></a>2. <strong>确保一致性和完整性</strong></h3><p>在执行复杂的业务逻辑时，例如账户转账、库存更新等，使用 <code>SELECT FOR UPDATE</code> 可以确保在整个事务过程中数据的一致性和完整性。这样可以避免在事务中间其他事务对数据的修改，导致数据不一致。</p>\n<h3 id=\"3-防止丢失更新\"><a href=\"#3-防止丢失更新\" class=\"headerlink\" title=\"3. 防止丢失更新\"></a>3. <strong>防止丢失更新</strong></h3><p>当多个事务试图同时更新同一行时，<code>SELECT FOR UPDATE</code> 可以防止丢失更新问题。它确保一个事务完成后，其他事务才能继续执行更新操作，避免了两个事务的更新互相覆盖。</p>\n<h3 id=\"4-优化并发控制\"><a href=\"#4-优化并发控制\" class=\"headerlink\" title=\"4. 优化并发控制\"></a>4. <strong>优化并发控制</strong></h3><p>使用 <code>SELECT FOR UPDATE</code> 可以提供细粒度的并发控制，通过只锁定必要的行，而不是整个表，从而提高系统的并发性能和资源利用率。</p>\n<h3 id=\"5-简化编程模型\"><a href=\"#5-简化编程模型\" class=\"headerlink\" title=\"5. 简化编程模型\"></a>5. <strong>简化编程模型</strong></h3><p><code>SELECT FOR UPDATE</code> 可以简化开发人员的编程模型，不需要手动处理复杂的锁机制，数据库会自动处理行锁定和释放，从而减少编程错误的机会。</p>\n<h3 id=\"使用示例\"><a href=\"#使用示例\" class=\"headerlink\" title=\"使用示例\"></a>使用示例</h3><figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs sql\"><span class=\"hljs-keyword\">BEGIN</span>;<br><span class=\"hljs-keyword\">SELECT</span> <span class=\"hljs-operator\">*</span> <span class=\"hljs-keyword\">FROM</span> accounts <span class=\"hljs-keyword\">WHERE</span> account_id <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span> <span class=\"hljs-keyword\">FOR</span> <span class=\"hljs-keyword\">UPDATE</span>;<br><span class=\"hljs-comment\">-- 执行一些需要锁定这行的操作，例如更新账户余额</span><br><span class=\"hljs-keyword\">UPDATE</span> accounts <span class=\"hljs-keyword\">SET</span> balance <span class=\"hljs-operator\">=</span> balance <span class=\"hljs-operator\">-</span> <span class=\"hljs-number\">100</span> <span class=\"hljs-keyword\">WHERE</span> account_id <span class=\"hljs-operator\">=</span> <span class=\"hljs-number\">1</span>;<br><span class=\"hljs-keyword\">COMMIT</span>;<br></code></pre></td></tr></table></figure>\n\n<p>在这个示例中，通过 <code>SELECT FOR UPDATE</code> 锁定 <code>account_id = 1</code> 的行，确保在事务提交之前，没有其他事务可以修改该行。</p>\n<p>总的来说，<code>SELECT FOR UPDATE</code> 提供了一种强大的并发控制机制，帮助确保数据的完整性、一致性，并防止并发修改导致的问题。</p>\n"},{"title":"交易下单时金额变化","date":"2024-09-11T07:14:06.000Z","_content":"\n账户信息:\n\n​\t余额 : 100000 信用 : 0 净值 : 100000 可用保证金 : 100000 已用保证金 : 0 预付款比例 : 0 仓息 : 手续费 : 盈亏 : 0\n\n​\t净值 = 余额+信用+浮动盈亏（平仓后，浮动盈亏转为余额）\n\n​\t净值 = 可用保证金+已用保证金\n\n​\t浮动盈亏=订单盈亏+手续费+隔夜仓息\n\n\n\n下单时：\n\n​\t余额 : 100000 信用 : 0 净值（通过公式计算） : 100000 可用保证金 : 100000 已用保证金 : 0 预付款比例 : 0 仓息 : 手续费 : 盈亏 : 0\n\n​\t\n\n占用10元的保证金：   浮动盈亏：+1  ，开仓手续费：-50\n\n​\t余额 : 100000 信用 : 0 净值（通过公式计算） : 100000+1 -50 可用保证金 : 100000 +1 -50  -10  已用保证金 : 10 预付款比例 : 0 仓息 : 手续费 :50  ， 浮动盈亏 : -50 +1  ，订单盈亏：1\n\n\n\n发生平仓：释放占用的10元的保证金：   浮动盈亏：+1，开仓手续费：-50 ， 关仓手续费：-40\n\n​\t余额 : 100000 -50-40 +1 信用 : 0  净值（通过公式计算） : 100000+1 -50-40  可用保证金 : 100000 +1 -50 -40  -10+10  已用保证金 : 0  预付款比例 : 0 仓息 : 手续费 :  50+40， 浮动盈亏 :0  ，订单盈亏：1\n\n\n\n\n\n\n\n","source":"_posts/交易/交易下单时金额变化.md","raw":"---\ntitle: 交易下单时金额变化\ndate: 2024-09-11 15:14:06\ncategories: 交易\ntag: 账户资金\n---\n\n账户信息:\n\n​\t余额 : 100000 信用 : 0 净值 : 100000 可用保证金 : 100000 已用保证金 : 0 预付款比例 : 0 仓息 : 手续费 : 盈亏 : 0\n\n​\t净值 = 余额+信用+浮动盈亏（平仓后，浮动盈亏转为余额）\n\n​\t净值 = 可用保证金+已用保证金\n\n​\t浮动盈亏=订单盈亏+手续费+隔夜仓息\n\n\n\n下单时：\n\n​\t余额 : 100000 信用 : 0 净值（通过公式计算） : 100000 可用保证金 : 100000 已用保证金 : 0 预付款比例 : 0 仓息 : 手续费 : 盈亏 : 0\n\n​\t\n\n占用10元的保证金：   浮动盈亏：+1  ，开仓手续费：-50\n\n​\t余额 : 100000 信用 : 0 净值（通过公式计算） : 100000+1 -50 可用保证金 : 100000 +1 -50  -10  已用保证金 : 10 预付款比例 : 0 仓息 : 手续费 :50  ， 浮动盈亏 : -50 +1  ，订单盈亏：1\n\n\n\n发生平仓：释放占用的10元的保证金：   浮动盈亏：+1，开仓手续费：-50 ， 关仓手续费：-40\n\n​\t余额 : 100000 -50-40 +1 信用 : 0  净值（通过公式计算） : 100000+1 -50-40  可用保证金 : 100000 +1 -50 -40  -10+10  已用保证金 : 0  预付款比例 : 0 仓息 : 手续费 :  50+40， 浮动盈亏 :0  ，订单盈亏：1\n\n\n\n\n\n\n\n","slug":"交易/交易下单时金额变化","published":1,"updated":"2025-02-18T06:27:33.022Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3t00238gjd2p3x1h26","content":"<p>账户信息:</p>\n<p>​\t余额 : 100000 信用 : 0 净值 : 100000 可用保证金 : 100000 已用保证金 : 0 预付款比例 : 0 仓息 : 手续费 : 盈亏 : 0</p>\n<p>​\t净值 &#x3D; 余额+信用+浮动盈亏（平仓后，浮动盈亏转为余额）</p>\n<p>​\t净值 &#x3D; 可用保证金+已用保证金</p>\n<p>​\t浮动盈亏&#x3D;订单盈亏+手续费+隔夜仓息</p>\n<p>下单时：</p>\n<p>​\t余额 : 100000 信用 : 0 净值（通过公式计算） : 100000 可用保证金 : 100000 已用保证金 : 0 预付款比例 : 0 仓息 : 手续费 : 盈亏 : 0</p>\n<p>​\t</p>\n<p>占用10元的保证金：   浮动盈亏：+1  ，开仓手续费：-50</p>\n<p>​\t余额 : 100000 信用 : 0 净值（通过公式计算） : 100000+1 -50 可用保证金 : 100000 +1 -50  -10  已用保证金 : 10 预付款比例 : 0 仓息 : 手续费 :50  ， 浮动盈亏 : -50 +1  ，订单盈亏：1</p>\n<p>发生平仓：释放占用的10元的保证金：   浮动盈亏：+1，开仓手续费：-50 ， 关仓手续费：-40</p>\n<p>​\t余额 : 100000 -50-40 +1 信用 : 0  净值（通过公式计算） : 100000+1 -50-40  可用保证金 : 100000 +1 -50 -40  -10+10  已用保证金 : 0  预付款比例 : 0 仓息 : 手续费 :  50+40， 浮动盈亏 :0  ，订单盈亏：1</p>\n","excerpt":"","more":"<p>账户信息:</p>\n<p>​\t余额 : 100000 信用 : 0 净值 : 100000 可用保证金 : 100000 已用保证金 : 0 预付款比例 : 0 仓息 : 手续费 : 盈亏 : 0</p>\n<p>​\t净值 &#x3D; 余额+信用+浮动盈亏（平仓后，浮动盈亏转为余额）</p>\n<p>​\t净值 &#x3D; 可用保证金+已用保证金</p>\n<p>​\t浮动盈亏&#x3D;订单盈亏+手续费+隔夜仓息</p>\n<p>下单时：</p>\n<p>​\t余额 : 100000 信用 : 0 净值（通过公式计算） : 100000 可用保证金 : 100000 已用保证金 : 0 预付款比例 : 0 仓息 : 手续费 : 盈亏 : 0</p>\n<p>​\t</p>\n<p>占用10元的保证金：   浮动盈亏：+1  ，开仓手续费：-50</p>\n<p>​\t余额 : 100000 信用 : 0 净值（通过公式计算） : 100000+1 -50 可用保证金 : 100000 +1 -50  -10  已用保证金 : 10 预付款比例 : 0 仓息 : 手续费 :50  ， 浮动盈亏 : -50 +1  ，订单盈亏：1</p>\n<p>发生平仓：释放占用的10元的保证金：   浮动盈亏：+1，开仓手续费：-50 ， 关仓手续费：-40</p>\n<p>​\t余额 : 100000 -50-40 +1 信用 : 0  净值（通过公式计算） : 100000+1 -50-40  可用保证金 : 100000 +1 -50 -40  -10+10  已用保证金 : 0  预付款比例 : 0 仓息 : 手续费 :  50+40， 浮动盈亏 :0  ，订单盈亏：1</p>\n"},{"title":"学习it网站推荐","date":"2024-06-26T03:06:14.000Z","_content":"\n分享一些好的网站，个人学习常用的网站，作为分享后续持续更新.\n\n## 网站资源\n\n### 技术学习网站\n- 盗版书网站：https://zh.singlelogin.re/\n- 架构师学习 [https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览](https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览 \"https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览\")\n  ![](学习it网站推荐/image_PEAqPgamQe.png)\n- 源码学习：[https://doocs.github.io/source-code-hunter/#/](https://doocs.github.io/source-code-hunter/#/ \"https://doocs.github.io/source-code-hunter/#/\")\n  ![](学习it网站推荐/image_qBL4LWSs2U.png)\n- 互联网 Java 工程师进阶知识完全扫盲:  [https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲](https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲 \"https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲\")\n  ![](学习it网站推荐/image_RtiUPlWbme.png)\n- 叶良辰の学习笔记 [https://yangzhiwen911.github.io/zh/guide/](https://yangzhiwen911.github.io/zh/guide/ \"https://yangzhiwen911.github.io/zh/guide/\")\n  ![](学习it网站推荐/image_tMLd_Cap6a.png)\n- 图灵Java架构师学习路线(点击链接看新版本) [https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map](https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map \"https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map\")\n  ![](学习it网站推荐/image_-m-m1AZh7M.png)\n- [深入架构原理与实践](https://www.thebyte.com.cn/ \"深入架构原理与实践\") [https://www.thebyte.com.cn/](https://www.thebyte.com.cn/ \"https://www.thebyte.com.cn/\");\n  ![](学习it网站推荐/image_zZOb0Uu1MN.png)\n- Kubernetes 实践指南 [https://imroc.cc/kubernetes/](https://imroc.cc/kubernetes/ \"https://imroc.cc/kubernetes/\");\n  vip破解视频  [https://share.xiaole88.com/其他东西/老齐的IT加油站](https://share.xiaole88.com/其他东西/老齐的IT加油站 \"https://share.xiaole88.com/其他东西/老齐的IT加油站\")\n  [https://share.xiaole88.com/K8渗透工具箱](https://share.xiaole88.com/K8渗透工具箱 \"https://share.xiaole88.com/K8渗透工具箱\")\n\n### 工具网站：\n\n- [https://www.flickr.com/](https://www.flickr.com/ \"https://www.flickr.com/\")   好的照片不能我一个人分享\n\n- [https://markmap.js.org/repl](https://markmap.js.org/repl \"https://markmap.js.org/repl\")  将markmap 生成图例\n  ![](学习it网站推荐/image_bUw4GOE3i3.png)\n\n- 苹果id相关：\n  \n  [https://appleid.stryun.top/](https://appleid.stryun.top/ \"https://appleid.stryun.top/\")\n  \n  [https://apple.hutaosubconverter.com/hutao](https://apple.hutaosubconverter.com/hutao \"https://apple.hutaosubconverter.com/hutao\")\n\n### 营销方向学习：\n\n- 宣传图生成 [https://design.palxp.cn/home?tempid=1188](https://design.palxp.cn/home?tempid=1188 \"https://design.palxp.cn/home?tempid=1188\")\n  \n  ![](学习it网站推荐/image_SOZXE0ImbY.png)\n","source":"_posts/分享/学习it网站推荐.md","raw":"---\n\ntitle: 学习it网站推荐\ndate: 2024-06-26 11:06:14\ncategories: 分享\ntag: 网站资源\n\n---\n\n分享一些好的网站，个人学习常用的网站，作为分享后续持续更新.\n\n## 网站资源\n\n### 技术学习网站\n- 盗版书网站：https://zh.singlelogin.re/\n- 架构师学习 [https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览](https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览 \"https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览\")\n  ![](学习it网站推荐/image_PEAqPgamQe.png)\n- 源码学习：[https://doocs.github.io/source-code-hunter/#/](https://doocs.github.io/source-code-hunter/#/ \"https://doocs.github.io/source-code-hunter/#/\")\n  ![](学习it网站推荐/image_qBL4LWSs2U.png)\n- 互联网 Java 工程师进阶知识完全扫盲:  [https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲](https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲 \"https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲\")\n  ![](学习it网站推荐/image_RtiUPlWbme.png)\n- 叶良辰の学习笔记 [https://yangzhiwen911.github.io/zh/guide/](https://yangzhiwen911.github.io/zh/guide/ \"https://yangzhiwen911.github.io/zh/guide/\")\n  ![](学习it网站推荐/image_tMLd_Cap6a.png)\n- 图灵Java架构师学习路线(点击链接看新版本) [https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map](https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map \"https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map\")\n  ![](学习it网站推荐/image_-m-m1AZh7M.png)\n- [深入架构原理与实践](https://www.thebyte.com.cn/ \"深入架构原理与实践\") [https://www.thebyte.com.cn/](https://www.thebyte.com.cn/ \"https://www.thebyte.com.cn/\");\n  ![](学习it网站推荐/image_zZOb0Uu1MN.png)\n- Kubernetes 实践指南 [https://imroc.cc/kubernetes/](https://imroc.cc/kubernetes/ \"https://imroc.cc/kubernetes/\");\n  vip破解视频  [https://share.xiaole88.com/其他东西/老齐的IT加油站](https://share.xiaole88.com/其他东西/老齐的IT加油站 \"https://share.xiaole88.com/其他东西/老齐的IT加油站\")\n  [https://share.xiaole88.com/K8渗透工具箱](https://share.xiaole88.com/K8渗透工具箱 \"https://share.xiaole88.com/K8渗透工具箱\")\n\n### 工具网站：\n\n- [https://www.flickr.com/](https://www.flickr.com/ \"https://www.flickr.com/\")   好的照片不能我一个人分享\n\n- [https://markmap.js.org/repl](https://markmap.js.org/repl \"https://markmap.js.org/repl\")  将markmap 生成图例\n  ![](学习it网站推荐/image_bUw4GOE3i3.png)\n\n- 苹果id相关：\n  \n  [https://appleid.stryun.top/](https://appleid.stryun.top/ \"https://appleid.stryun.top/\")\n  \n  [https://apple.hutaosubconverter.com/hutao](https://apple.hutaosubconverter.com/hutao \"https://apple.hutaosubconverter.com/hutao\")\n\n### 营销方向学习：\n\n- 宣传图生成 [https://design.palxp.cn/home?tempid=1188](https://design.palxp.cn/home?tempid=1188 \"https://design.palxp.cn/home?tempid=1188\")\n  \n  ![](学习it网站推荐/image_SOZXE0ImbY.png)\n","slug":"分享/学习it网站推荐","published":1,"updated":"2025-02-18T06:25:33.700Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3t00248gjd9tum3v6h","content":"<p>分享一些好的网站，个人学习常用的网站，作为分享后续持续更新.</p>\n<h2 id=\"网站资源\"><a href=\"#网站资源\" class=\"headerlink\" title=\"网站资源\"></a>网站资源</h2><h3 id=\"技术学习网站\"><a href=\"#技术学习网站\" class=\"headerlink\" title=\"技术学习网站\"></a>技术学习网站</h3><ul>\n<li>盗版书网站：<a href=\"https://zh.singlelogin.re/\">https://zh.singlelogin.re/</a></li>\n<li>架构师学习 <a href=\"https://bugstack.cn/md/other/guide-to-reading.html#%E4%B8%80%E3%80%81%E6%9C%AC%E7%AB%99%E7%9F%A5%E8%AF%86%E9%98%85%E8%A7%88\" title=\"https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览\">https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_PEAqPgamQe.png\" class></li>\n<li>源码学习：<a href=\"https://doocs.github.io/source-code-hunter/#/\" title=\"https://doocs.github.io/source-code-hunter/#/\">https://doocs.github.io/source-code-hunter/#/</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_qBL4LWSs2U.png\" class></li>\n<li>互联网 Java 工程师进阶知识完全扫盲:  <a href=\"https://doocs.github.io/advanced-java/#/?id=%E4%BA%92%E8%81%94%E7%BD%91-java-%E5%B7%A5%E7%A8%8B%E5%B8%88%E8%BF%9B%E9%98%B6%E7%9F%A5%E8%AF%86%E5%AE%8C%E5%85%A8%E6%89%AB%E7%9B%B2\" title=\"https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲\">https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_RtiUPlWbme.png\" class></li>\n<li>叶良辰の学习笔记 <a href=\"https://yangzhiwen911.github.io/zh/guide/\" title=\"https://yangzhiwen911.github.io/zh/guide/\">https://yangzhiwen911.github.io/zh/guide/</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_tMLd_Cap6a.png\" class></li>\n<li>图灵Java架构师学习路线(点击链接看新版本) <a href=\"https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map\" title=\"https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map\">https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_-m-m1AZh7M.png\" class></li>\n<li><a href=\"https://www.thebyte.com.cn/\" title=\"深入架构原理与实践\">深入架构原理与实践</a> <a href=\"https://www.thebyte.com.cn/\" title=\"https://www.thebyte.com.cn/\">https://www.thebyte.com.cn/</a>;<img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_zZOb0Uu1MN.png\" class></li>\n<li>Kubernetes 实践指南 <a href=\"https://imroc.cc/kubernetes/\" title=\"https://imroc.cc/kubernetes/\">https://imroc.cc/kubernetes/</a>;<br>vip破解视频  <a href=\"https://share.xiaole88.com/%E5%85%B6%E4%BB%96%E4%B8%9C%E8%A5%BF/%E8%80%81%E9%BD%90%E7%9A%84IT%E5%8A%A0%E6%B2%B9%E7%AB%99\" title=\"https://share.xiaole88.com/其他东西/老齐的IT加油站\">https://share.xiaole88.com/其他东西/老齐的IT加油站</a><br><a href=\"https://share.xiaole88.com/K8%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E7%AE%B1\" title=\"https://share.xiaole88.com/K8渗透工具箱\">https://share.xiaole88.com/K8渗透工具箱</a></li>\n</ul>\n<h3 id=\"工具网站：\"><a href=\"#工具网站：\" class=\"headerlink\" title=\"工具网站：\"></a>工具网站：</h3><ul>\n<li><p><a href=\"https://www.flickr.com/\" title=\"https://www.flickr.com/\">https://www.flickr.com/</a>   好的照片不能我一个人分享</p>\n</li>\n<li><p><a href=\"https://markmap.js.org/repl\" title=\"https://markmap.js.org/repl\">https://markmap.js.org/repl</a>  将markmap 生成图例</p>\n<img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_bUw4GOE3i3.png\" class>\n</li>\n<li><p>苹果id相关：</p>\n<p><a href=\"https://appleid.stryun.top/\" title=\"https://appleid.stryun.top/\">https://appleid.stryun.top/</a></p>\n<p><a href=\"https://apple.hutaosubconverter.com/hutao\" title=\"https://apple.hutaosubconverter.com/hutao\">https://apple.hutaosubconverter.com/hutao</a></p>\n</li>\n</ul>\n<h3 id=\"营销方向学习：\"><a href=\"#营销方向学习：\" class=\"headerlink\" title=\"营销方向学习：\"></a>营销方向学习：</h3><ul>\n<li><p>宣传图生成 <a href=\"https://design.palxp.cn/home?tempid=1188\" title=\"https://design.palxp.cn/home?tempid=1188\">https://design.palxp.cn/home?tempid=1188</a></p>\n<img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_SOZXE0ImbY.png\" class></li>\n</ul>\n","excerpt":"","more":"<p>分享一些好的网站，个人学习常用的网站，作为分享后续持续更新.</p>\n<h2 id=\"网站资源\"><a href=\"#网站资源\" class=\"headerlink\" title=\"网站资源\"></a>网站资源</h2><h3 id=\"技术学习网站\"><a href=\"#技术学习网站\" class=\"headerlink\" title=\"技术学习网站\"></a>技术学习网站</h3><ul>\n<li>盗版书网站：<a href=\"https://zh.singlelogin.re/\">https://zh.singlelogin.re/</a></li>\n<li>架构师学习 <a href=\"https://bugstack.cn/md/other/guide-to-reading.html#%E4%B8%80%E3%80%81%E6%9C%AC%E7%AB%99%E7%9F%A5%E8%AF%86%E9%98%85%E8%A7%88\" title=\"https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览\">https://bugstack.cn/md/other/guide-to-reading.html#一、本站知识阅览</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_PEAqPgamQe.png\" class></li>\n<li>源码学习：<a href=\"https://doocs.github.io/source-code-hunter/#/\" title=\"https://doocs.github.io/source-code-hunter/#/\">https://doocs.github.io/source-code-hunter/#/</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_qBL4LWSs2U.png\" class></li>\n<li>互联网 Java 工程师进阶知识完全扫盲:  <a href=\"https://doocs.github.io/advanced-java/#/?id=%E4%BA%92%E8%81%94%E7%BD%91-java-%E5%B7%A5%E7%A8%8B%E5%B8%88%E8%BF%9B%E9%98%B6%E7%9F%A5%E8%AF%86%E5%AE%8C%E5%85%A8%E6%89%AB%E7%9B%B2\" title=\"https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲\">https://doocs.github.io/advanced-java/#/?id=互联网-java-工程师进阶知识完全扫盲</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_RtiUPlWbme.png\" class></li>\n<li>叶良辰の学习笔记 <a href=\"https://yangzhiwen911.github.io/zh/guide/\" title=\"https://yangzhiwen911.github.io/zh/guide/\">https://yangzhiwen911.github.io/zh/guide/</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_tMLd_Cap6a.png\" class></li>\n<li>图灵Java架构师学习路线(点击链接看新版本) <a href=\"https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map\" title=\"https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map\">https://www.processon.com/view/link/5eccea8fe0b34d5f263038f0#map</a><img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_-m-m1AZh7M.png\" class></li>\n<li><a href=\"https://www.thebyte.com.cn/\" title=\"深入架构原理与实践\">深入架构原理与实践</a> <a href=\"https://www.thebyte.com.cn/\" title=\"https://www.thebyte.com.cn/\">https://www.thebyte.com.cn/</a>;<img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_zZOb0Uu1MN.png\" class></li>\n<li>Kubernetes 实践指南 <a href=\"https://imroc.cc/kubernetes/\" title=\"https://imroc.cc/kubernetes/\">https://imroc.cc/kubernetes/</a>;<br>vip破解视频  <a href=\"https://share.xiaole88.com/%E5%85%B6%E4%BB%96%E4%B8%9C%E8%A5%BF/%E8%80%81%E9%BD%90%E7%9A%84IT%E5%8A%A0%E6%B2%B9%E7%AB%99\" title=\"https://share.xiaole88.com/其他东西/老齐的IT加油站\">https://share.xiaole88.com/其他东西/老齐的IT加油站</a><br><a href=\"https://share.xiaole88.com/K8%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7%E7%AE%B1\" title=\"https://share.xiaole88.com/K8渗透工具箱\">https://share.xiaole88.com/K8渗透工具箱</a></li>\n</ul>\n<h3 id=\"工具网站：\"><a href=\"#工具网站：\" class=\"headerlink\" title=\"工具网站：\"></a>工具网站：</h3><ul>\n<li><p><a href=\"https://www.flickr.com/\" title=\"https://www.flickr.com/\">https://www.flickr.com/</a>   好的照片不能我一个人分享</p>\n</li>\n<li><p><a href=\"https://markmap.js.org/repl\" title=\"https://markmap.js.org/repl\">https://markmap.js.org/repl</a>  将markmap 生成图例</p>\n<img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_bUw4GOE3i3.png\" class>\n</li>\n<li><p>苹果id相关：</p>\n<p><a href=\"https://appleid.stryun.top/\" title=\"https://appleid.stryun.top/\">https://appleid.stryun.top/</a></p>\n<p><a href=\"https://apple.hutaosubconverter.com/hutao\" title=\"https://apple.hutaosubconverter.com/hutao\">https://apple.hutaosubconverter.com/hutao</a></p>\n</li>\n</ul>\n<h3 id=\"营销方向学习：\"><a href=\"#营销方向学习：\" class=\"headerlink\" title=\"营销方向学习：\"></a>营销方向学习：</h3><ul>\n<li><p>宣传图生成 <a href=\"https://design.palxp.cn/home?tempid=1188\" title=\"https://design.palxp.cn/home?tempid=1188\">https://design.palxp.cn/home?tempid=1188</a></p>\n<img src=\"/2024/06/26/%E5%88%86%E4%BA%AB/%E5%AD%A6%E4%B9%A0it%E7%BD%91%E7%AB%99%E6%8E%A8%E8%8D%90/image_SOZXE0ImbY.png\" class></li>\n</ul>\n"},{"title":"设信道带宽为16kHz,信噪比为30dB,则该信道的信道容量大约为","date":"2024-10-22T09:19:02.000Z","_content":"根据香农信道容量公式：\n\n\\[\nC = B \\log_2(1 + S/N)\n\\]\n\n其中：\n- \\( C \\) 是信道容量（单位：比特每秒，bps），\n- \\( B \\) 是信道带宽（单位：赫兹，Hz），\n- \\( S/N \\) 是信噪比，通常以线性值表示。\n\n### 已知条件：\n- 信道带宽 \\( B = 16 \\, \\text{kHz} = 16,000 \\, \\text{Hz} \\),\n- 信噪比 \\( \\text{S/N} = 30 \\, \\text{dB} \\).\n\n首先，将信噪比从 dB 转换为线性值：\n\\[\nS/N = 10^{30/10} = 10^3 = 1000\n\\]\n\n将这些值代入香农公式：\n\\[\nC = 16000 \\log_2(1 + 1000)\n\\]\n\n计算出 \\( \\log_2(1001) \\)，然后再乘以带宽 \\( B \\)。\n\n我们来计算这个值。\n\n根据计算结果，信道容量大约为 **159,476 bps**（比特每秒）。","source":"_posts/计算机考试/设信道带宽为16kHz-信噪比为30dB-则该信道的信道容量大约为.md","raw":"---\ntitle: 设信道带宽为16kHz,信噪比为30dB,则该信道的信道容量大约为\ndate: 2024-10-22 17:19:02\ncategories: 计算机考试\ntag: 自学公式\n---\n根据香农信道容量公式：\n\n\\[\nC = B \\log_2(1 + S/N)\n\\]\n\n其中：\n- \\( C \\) 是信道容量（单位：比特每秒，bps），\n- \\( B \\) 是信道带宽（单位：赫兹，Hz），\n- \\( S/N \\) 是信噪比，通常以线性值表示。\n\n### 已知条件：\n- 信道带宽 \\( B = 16 \\, \\text{kHz} = 16,000 \\, \\text{Hz} \\),\n- 信噪比 \\( \\text{S/N} = 30 \\, \\text{dB} \\).\n\n首先，将信噪比从 dB 转换为线性值：\n\\[\nS/N = 10^{30/10} = 10^3 = 1000\n\\]\n\n将这些值代入香农公式：\n\\[\nC = 16000 \\log_2(1 + 1000)\n\\]\n\n计算出 \\( \\log_2(1001) \\)，然后再乘以带宽 \\( B \\)。\n\n我们来计算这个值。\n\n根据计算结果，信道容量大约为 **159,476 bps**（比特每秒）。","slug":"计算机考试/设信道带宽为16kHz-信噪比为30dB-则该信道的信道容量大约为","published":1,"updated":"2025-02-18T06:24:40.777Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3u00278gjdg1mwg5i3","content":"<p>根据香农信道容量公式：</p>\n<p>[<br>C &#x3D; B \\log_2(1 + S&#x2F;N)<br>]</p>\n<p>其中：</p>\n<ul>\n<li>( C ) 是信道容量（单位：比特每秒，bps），</li>\n<li>( B ) 是信道带宽（单位：赫兹，Hz），</li>\n<li>( S&#x2F;N ) 是信噪比，通常以线性值表示。</li>\n</ul>\n<h3 id=\"已知条件：\"><a href=\"#已知条件：\" class=\"headerlink\" title=\"已知条件：\"></a>已知条件：</h3><ul>\n<li>信道带宽 ( B &#x3D; 16 , \\text{kHz} &#x3D; 16,000 , \\text{Hz} ),</li>\n<li>信噪比 ( \\text{S&#x2F;N} &#x3D; 30 , \\text{dB} ).</li>\n</ul>\n<p>首先，将信噪比从 dB 转换为线性值：<br>[<br>S&#x2F;N &#x3D; 10^{30&#x2F;10} &#x3D; 10^3 &#x3D; 1000<br>]</p>\n<p>将这些值代入香农公式：<br>[<br>C &#x3D; 16000 \\log_2(1 + 1000)<br>]</p>\n<p>计算出 ( \\log_2(1001) )，然后再乘以带宽 ( B )。</p>\n<p>我们来计算这个值。</p>\n<p>根据计算结果，信道容量大约为 <strong>159,476 bps</strong>（比特每秒）。</p>\n","excerpt":"","more":"<p>根据香农信道容量公式：</p>\n<p>[<br>C &#x3D; B \\log_2(1 + S&#x2F;N)<br>]</p>\n<p>其中：</p>\n<ul>\n<li>( C ) 是信道容量（单位：比特每秒，bps），</li>\n<li>( B ) 是信道带宽（单位：赫兹，Hz），</li>\n<li>( S&#x2F;N ) 是信噪比，通常以线性值表示。</li>\n</ul>\n<h3 id=\"已知条件：\"><a href=\"#已知条件：\" class=\"headerlink\" title=\"已知条件：\"></a>已知条件：</h3><ul>\n<li>信道带宽 ( B &#x3D; 16 , \\text{kHz} &#x3D; 16,000 , \\text{Hz} ),</li>\n<li>信噪比 ( \\text{S&#x2F;N} &#x3D; 30 , \\text{dB} ).</li>\n</ul>\n<p>首先，将信噪比从 dB 转换为线性值：<br>[<br>S&#x2F;N &#x3D; 10^{30&#x2F;10} &#x3D; 10^3 &#x3D; 1000<br>]</p>\n<p>将这些值代入香农公式：<br>[<br>C &#x3D; 16000 \\log_2(1 + 1000)<br>]</p>\n<p>计算出 ( \\log_2(1001) )，然后再乘以带宽 ( B )。</p>\n<p>我们来计算这个值。</p>\n<p>根据计算结果，信道容量大约为 <strong>159,476 bps</strong>（比特每秒）。</p>\n"},{"title":"亿赛通电子文档安全管理系统XStream反序列化漏洞任意文件上传利用","date":"2024-09-29T09:50:52.000Z","_content":"一、产品简介\n亿赛通电子文档安全管理系统（简称：CDG）是一款电子文档安全加密软件，该系统利用驱动层透明加密技术，通过对电子文档的加密保护，防止内部员工泄密和外部人员非法窃取企业核心重要数据资产，对电子文档进行全生命周期防护，系统具有透明加密、主动加密、智能加密等多种加密方式，用户可根据部门涉密程度的不同（如核心部门和普通部门），部署力度轻重不一的梯度式文档加密防护，实现技术、管理、审计进行有机的结合，在内部构建起立体化的整体信息防泄露体系，使得成本、效率和安全三者达到平衡，实现电子文档的数据安全。\n二、漏洞描述\n亿赛通电子文档安全管理系统UploadFileFromClientServiceForClient接口处存在任意文件上传漏洞，未经授权的攻击者可通过此漏洞上传恶意后门文件，从而获取服务器权限。\n三、影响范围\n未知\n四、复现环境\nFOFA：app=“亿赛通-电子文档安全管理系统”\n五、漏洞复现\n1.访问存在漏洞网站，抓包\n2.POC\n```angular2html\nPOST /CDGServer3/UploadFileFromClientServiceForClient?AFMALANMJCEOENIBDJMKFHBANGEPKHNOFJBMIFJPFNKFOKHJNMLCOIDDJGNEIPOLOKGAFAFJHDEJPHEPLFJHDGPBNELNFIICGFNGEOEFBKCDDCGJEPIKFHJFAOOHJEPNNCLFHDAFDNCGBAEELJFFHABJPDPIEEMIBOECDMDLEPBJGBGCGLEMBDFAGOGM HTTP/1.1\nHost: IP：port\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nSec-Fetch-Dest: document\nSec-Fetch-Mode: navigate\nSec-Fetch-Site: none\nSec-Fetch-User: ?1\nUpgrade-Insecure-Requests: 1\n\n\n上传的文件内容\n```\n3.测试，上传成功\n4.访问ip:port/tttT.jsp\n\n\n利用源码：https://github.com/candyadmin/CDGXStreamDeserRCE\n教程：\nhttps://www.yuque.com/u34516370/hi2ux9/nibcqge2832vptra\nhttps://blog.csdn.net/uuzeray/article/details/136690493\n","source":"_posts/黑客/亿赛通电子文档安全管理系统XStream反序列化漏洞任意文件上传利用.md","raw":"---\ntitle: 亿赛通电子文档安全管理系统XStream反序列化漏洞任意文件上传利用\ndate: 2024-09-29 17:50:52\ncategories: 黑客\ntag: 漏洞\n---\n一、产品简介\n亿赛通电子文档安全管理系统（简称：CDG）是一款电子文档安全加密软件，该系统利用驱动层透明加密技术，通过对电子文档的加密保护，防止内部员工泄密和外部人员非法窃取企业核心重要数据资产，对电子文档进行全生命周期防护，系统具有透明加密、主动加密、智能加密等多种加密方式，用户可根据部门涉密程度的不同（如核心部门和普通部门），部署力度轻重不一的梯度式文档加密防护，实现技术、管理、审计进行有机的结合，在内部构建起立体化的整体信息防泄露体系，使得成本、效率和安全三者达到平衡，实现电子文档的数据安全。\n二、漏洞描述\n亿赛通电子文档安全管理系统UploadFileFromClientServiceForClient接口处存在任意文件上传漏洞，未经授权的攻击者可通过此漏洞上传恶意后门文件，从而获取服务器权限。\n三、影响范围\n未知\n四、复现环境\nFOFA：app=“亿赛通-电子文档安全管理系统”\n五、漏洞复现\n1.访问存在漏洞网站，抓包\n2.POC\n```angular2html\nPOST /CDGServer3/UploadFileFromClientServiceForClient?AFMALANMJCEOENIBDJMKFHBANGEPKHNOFJBMIFJPFNKFOKHJNMLCOIDDJGNEIPOLOKGAFAFJHDEJPHEPLFJHDGPBNELNFIICGFNGEOEFBKCDDCGJEPIKFHJFAOOHJEPNNCLFHDAFDNCGBAEELJFFHABJPDPIEEMIBOECDMDLEPBJGBGCGLEMBDFAGOGM HTTP/1.1\nHost: IP：port\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8\nAccept-Encoding: gzip, deflate, br\nAccept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\nSec-Fetch-Dest: document\nSec-Fetch-Mode: navigate\nSec-Fetch-Site: none\nSec-Fetch-User: ?1\nUpgrade-Insecure-Requests: 1\n\n\n上传的文件内容\n```\n3.测试，上传成功\n4.访问ip:port/tttT.jsp\n\n\n利用源码：https://github.com/candyadmin/CDGXStreamDeserRCE\n教程：\nhttps://www.yuque.com/u34516370/hi2ux9/nibcqge2832vptra\nhttps://blog.csdn.net/uuzeray/article/details/136690493\n","slug":"黑客/亿赛通电子文档安全管理系统XStream反序列化漏洞任意文件上传利用","published":1,"updated":"2025-02-18T06:27:08.573Z","comments":1,"layout":"post","photos":[],"_id":"cm7a4vg3v00288gjdgmjcd68z","content":"<p>一、产品简介<br>亿赛通电子文档安全管理系统（简称：CDG）是一款电子文档安全加密软件，该系统利用驱动层透明加密技术，通过对电子文档的加密保护，防止内部员工泄密和外部人员非法窃取企业核心重要数据资产，对电子文档进行全生命周期防护，系统具有透明加密、主动加密、智能加密等多种加密方式，用户可根据部门涉密程度的不同（如核心部门和普通部门），部署力度轻重不一的梯度式文档加密防护，实现技术、管理、审计进行有机的结合，在内部构建起立体化的整体信息防泄露体系，使得成本、效率和安全三者达到平衡，实现电子文档的数据安全。<br>二、漏洞描述<br>亿赛通电子文档安全管理系统UploadFileFromClientServiceForClient接口处存在任意文件上传漏洞，未经授权的攻击者可通过此漏洞上传恶意后门文件，从而获取服务器权限。<br>三、影响范围<br>未知<br>四、复现环境<br>FOFA：app&#x3D;“亿赛通-电子文档安全管理系统”<br>五、漏洞复现<br>1.访问存在漏洞网站，抓包<br>2.POC</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs angular2html\">POST /CDGServer3/UploadFileFromClientServiceForClient?AFMALANMJCEOENIBDJMKFHBANGEPKHNOFJBMIFJPFNKFOKHJNMLCOIDDJGNEIPOLOKGAFAFJHDEJPHEPLFJHDGPBNELNFIICGFNGEOEFBKCDDCGJEPIKFHJFAOOHJEPNNCLFHDAFDNCGBAEELJFFHABJPDPIEEMIBOECDMDLEPBJGBGCGLEMBDFAGOGM HTTP/1.1<br>Host: IP：port<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br>Accept-Encoding: gzip, deflate, br<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Sec-Fetch-Dest: document<br>Sec-Fetch-Mode: navigate<br>Sec-Fetch-Site: none<br>Sec-Fetch-User: ?1<br>Upgrade-Insecure-Requests: 1<br><br><br>上传的文件内容<br></code></pre></td></tr></table></figure>\n<p>3.测试，上传成功<br>4.访问ip:port&#x2F;tttT.jsp</p>\n<p>利用源码：<a href=\"https://github.com/candyadmin/CDGXStreamDeserRCE\">https://github.com/candyadmin/CDGXStreamDeserRCE</a><br>教程：<br><a href=\"https://www.yuque.com/u34516370/hi2ux9/nibcqge2832vptra\">https://www.yuque.com/u34516370/hi2ux9/nibcqge2832vptra</a><br><a href=\"https://blog.csdn.net/uuzeray/article/details/136690493\">https://blog.csdn.net/uuzeray/article/details/136690493</a></p>\n","excerpt":"","more":"<p>一、产品简介<br>亿赛通电子文档安全管理系统（简称：CDG）是一款电子文档安全加密软件，该系统利用驱动层透明加密技术，通过对电子文档的加密保护，防止内部员工泄密和外部人员非法窃取企业核心重要数据资产，对电子文档进行全生命周期防护，系统具有透明加密、主动加密、智能加密等多种加密方式，用户可根据部门涉密程度的不同（如核心部门和普通部门），部署力度轻重不一的梯度式文档加密防护，实现技术、管理、审计进行有机的结合，在内部构建起立体化的整体信息防泄露体系，使得成本、效率和安全三者达到平衡，实现电子文档的数据安全。<br>二、漏洞描述<br>亿赛通电子文档安全管理系统UploadFileFromClientServiceForClient接口处存在任意文件上传漏洞，未经授权的攻击者可通过此漏洞上传恶意后门文件，从而获取服务器权限。<br>三、影响范围<br>未知<br>四、复现环境<br>FOFA：app&#x3D;“亿赛通-电子文档安全管理系统”<br>五、漏洞复现<br>1.访问存在漏洞网站，抓包<br>2.POC</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs angular2html\">POST /CDGServer3/UploadFileFromClientServiceForClient?AFMALANMJCEOENIBDJMKFHBANGEPKHNOFJBMIFJPFNKFOKHJNMLCOIDDJGNEIPOLOKGAFAFJHDEJPHEPLFJHDGPBNELNFIICGFNGEOEFBKCDDCGJEPIKFHJFAOOHJEPNNCLFHDAFDNCGBAEELJFFHABJPDPIEEMIBOECDMDLEPBJGBGCGLEMBDFAGOGM HTTP/1.1<br>Host: IP：port<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8<br>Accept-Encoding: gzip, deflate, br<br>Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2<br>Sec-Fetch-Dest: document<br>Sec-Fetch-Mode: navigate<br>Sec-Fetch-Site: none<br>Sec-Fetch-User: ?1<br>Upgrade-Insecure-Requests: 1<br><br><br>上传的文件内容<br></code></pre></td></tr></table></figure>\n<p>3.测试，上传成功<br>4.访问ip:port&#x2F;tttT.jsp</p>\n<p>利用源码：<a href=\"https://github.com/candyadmin/CDGXStreamDeserRCE\">https://github.com/candyadmin/CDGXStreamDeserRCE</a><br>教程：<br><a href=\"https://www.yuque.com/u34516370/hi2ux9/nibcqge2832vptra\">https://www.yuque.com/u34516370/hi2ux9/nibcqge2832vptra</a><br><a href=\"https://blog.csdn.net/uuzeray/article/details/136690493\">https://blog.csdn.net/uuzeray/article/details/136690493</a></p>\n"},{"title":"docker常用命令","date":"2025-02-20T07:26:30.000Z","_content":"\n新建数据库：\n\n```bash\ndocker run -d --restart=always  --name my-mysql -e MYSQL_ROOT_PASSWORD='password' -p 3306:3306 -e TZ=Asia/Shanghai  mysql:8.0.39\n```","source":"_posts/docker/docker常用命令.md","raw":"---\ntitle: docker常用命令\ndate: 2025-02-20 15:26:30\ncategories: docker\ntag: 命令\n---\n\n新建数据库：\n\n```bash\ndocker run -d --restart=always  --name my-mysql -e MYSQL_ROOT_PASSWORD='password' -p 3306:3306 -e TZ=Asia/Shanghai  mysql:8.0.39\n```","slug":"docker/docker常用命令","published":1,"updated":"2025-02-20T07:27:22.473Z","comments":1,"layout":"post","photos":[],"_id":"cm7e5cdy400001gjd96tu8p26","content":"<p>新建数据库：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker run -d --restart=always  --name my-mysql -e MYSQL_ROOT_PASSWORD=<span class=\"hljs-string\">&#x27;password&#x27;</span> -p 3306:3306 -e TZ=Asia/Shanghai  mysql:8.0.39<br></code></pre></td></tr></table></figure>","excerpt":"","more":"<p>新建数据库：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker run -d --restart=always  --name my-mysql -e MYSQL_ROOT_PASSWORD=<span class=\"hljs-string\">&#x27;password&#x27;</span> -p 3306:3306 -e TZ=Asia/Shanghai  mysql:8.0.39<br></code></pre></td></tr></table></figure>"},{"title":"mysql-数据备份脚本","date":"2025-02-19T09:31:43.000Z","_content":"\n\n备份：\n\n```bash\ndocker exec mysql-container mysqldump -u root -p'password' --all-databases > /path/to/backup/all_databases_backup.sql\n```\n还原：\n\n```bash\ndocker exec -i my-mysql mysql  -u root -p'password'    < /opt/mysql_back/mydatabase_backup.sql  \n```\n\n\n\n\n\n","source":"_posts/mysql/mysql-数据备份脚本.md","raw":"---\ntitle: mysql-数据备份脚本\ndate: 2025-02-19 17:31:43\ncategories: mysql\ntag: 备份\n---\n\n\n备份：\n\n```bash\ndocker exec mysql-container mysqldump -u root -p'password' --all-databases > /path/to/backup/all_databases_backup.sql\n```\n还原：\n\n```bash\ndocker exec -i my-mysql mysql  -u root -p'password'    < /opt/mysql_back/mydatabase_backup.sql  \n```\n\n\n\n\n\n","slug":"mysql/mysql-数据备份脚本","published":1,"updated":"2025-02-20T07:27:22.479Z","comments":1,"layout":"post","photos":[],"_id":"cm7e5cdy900031gjdbypv7qk6","content":"<p>备份：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker <span class=\"hljs-built_in\">exec</span> mysql-container mysqldump -u root -p<span class=\"hljs-string\">&#x27;password&#x27;</span> --all-databases &gt; /path/to/backup/all_databases_backup.sql<br></code></pre></td></tr></table></figure>\n<p>还原：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker <span class=\"hljs-built_in\">exec</span> -i my-mysql mysql  -u root -p<span class=\"hljs-string\">&#x27;password&#x27;</span>    &lt; /opt/mysql_back/mydatabase_backup.sql  <br></code></pre></td></tr></table></figure>\n\n\n\n\n\n","excerpt":"","more":"<p>备份：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker <span class=\"hljs-built_in\">exec</span> mysql-container mysqldump -u root -p<span class=\"hljs-string\">&#x27;password&#x27;</span> --all-databases &gt; /path/to/backup/all_databases_backup.sql<br></code></pre></td></tr></table></figure>\n<p>还原：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">docker <span class=\"hljs-built_in\">exec</span> -i my-mysql mysql  -u root -p<span class=\"hljs-string\">&#x27;password&#x27;</span>    &lt; /opt/mysql_back/mydatabase_backup.sql  <br></code></pre></td></tr></table></figure>\n\n\n\n\n\n"},{"title":"linux-常用命令","date":"2025-02-20T09:47:37.000Z","_content":"\nlinux自启动：\n\n```bash\ncd /etc/systemd/system/\nvi openvpn-client.service\n```\n\n```bash\n[Unit]\nDescription=OpenVPN client service\nAfter=network.target\n \n[Service]\nType=simple\nExecStart= /usr/sbin/openvpn --config /opt/openvpn/huawei-5600g.ovpn\nRestart=always\n \n[Install]\nWantedBy=multi-user.target\n```\n```bash\nsystemctl daemon-reload\nsystemctl enable openvpn-client.service\n```\n","source":"_posts/linux/linux-常用命令.md","raw":"---\ntitle: linux-常用命令\ndate: 2025-02-20 17:47:37\ncategories: linux\ntag: 常用命令\n---\n\nlinux自启动：\n\n```bash\ncd /etc/systemd/system/\nvi openvpn-client.service\n```\n\n```bash\n[Unit]\nDescription=OpenVPN client service\nAfter=network.target\n \n[Service]\nType=simple\nExecStart= /usr/sbin/openvpn --config /opt/openvpn/huawei-5600g.ovpn\nRestart=always\n \n[Install]\nWantedBy=multi-user.target\n```\n```bash\nsystemctl daemon-reload\nsystemctl enable openvpn-client.service\n```\n","slug":"linux/linux-常用命令","published":1,"updated":"2025-02-20T09:50:44.189Z","comments":1,"layout":"post","photos":[],"_id":"cm7e5cdy900041gjd2mjr4fj9","content":"<p>linux自启动：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">cd</span> /etc/systemd/system/<br>vi openvpn-client.service<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">[Unit]<br>Description=OpenVPN client service<br>After=network.target<br> <br>[Service]<br>Type=simple<br>ExecStart= /usr/sbin/openvpn --config /opt/openvpn/huawei-5600g.ovpn<br>Restart=always<br> <br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">systemctl daemon-reload<br>systemctl <span class=\"hljs-built_in\">enable</span> openvpn-client.service<br></code></pre></td></tr></table></figure>\n","excerpt":"","more":"<p>linux自启动：</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\"><span class=\"hljs-built_in\">cd</span> /etc/systemd/system/<br>vi openvpn-client.service<br></code></pre></td></tr></table></figure>\n\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">[Unit]<br>Description=OpenVPN client service<br>After=network.target<br> <br>[Service]<br>Type=simple<br>ExecStart= /usr/sbin/openvpn --config /opt/openvpn/huawei-5600g.ovpn<br>Restart=always<br> <br>[Install]<br>WantedBy=multi-user.target<br></code></pre></td></tr></table></figure>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><code class=\"hljs bash\">systemctl daemon-reload<br>systemctl <span class=\"hljs-built_in\">enable</span> openvpn-client.service<br></code></pre></td></tr></table></figure>\n"}],"PostAsset":[{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\img.png","slug":"img.png","post":"cm7a4vg3k000l8gjdhmb47yos","modified":0,"renderable":0},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806195901.png","slug":"微信截图_20240806195901.png","post":"cm7a4vg3k000l8gjdhmb47yos","modified":0,"renderable":0},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200410.png","slug":"微信截图_20240806200410.png","post":"cm7a4vg3k000l8gjdhmb47yos","modified":0,"renderable":0},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200518.png","slug":"微信截图_20240806200518.png","post":"cm7a4vg3k000l8gjdhmb47yos","modified":0,"renderable":0},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200751.png","slug":"微信截图_20240806200751.png","post":"cm7a4vg3k000l8gjdhmb47yos","modified":0,"renderable":0},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200831.png","slug":"微信截图_20240806200831.png","post":"cm7a4vg3k000l8gjdhmb47yos","modified":0,"renderable":0},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200853.png","slug":"微信截图_20240806200853.png","post":"cm7a4vg3k000l8gjdhmb47yos","modified":0,"renderable":0},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200913.png","slug":"微信截图_20240806200913.png","post":"cm7a4vg3k000l8gjdhmb47yos","modified":0,"renderable":0},{"_id":"source\\_posts\\linux\\使用图形化对linux磁盘进行扩容\\微信截图_20240806200924.png","slug":"微信截图_20240806200924.png","post":"cm7a4vg3k000l8gjdhmb47yos","modified":0,"renderable":0},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_-m-m1AZh7M.png","slug":"image_-m-m1AZh7M.png","post":"cm7a4vg3t00248gjd9tum3v6h","modified":0,"renderable":0},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_bUw4GOE3i3.png","slug":"image_bUw4GOE3i3.png","post":"cm7a4vg3t00248gjd9tum3v6h","modified":0,"renderable":0},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_PEAqPgamQe.png","slug":"image_PEAqPgamQe.png","post":"cm7a4vg3t00248gjd9tum3v6h","modified":0,"renderable":0},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_qBL4LWSs2U.png","slug":"image_qBL4LWSs2U.png","post":"cm7a4vg3t00248gjd9tum3v6h","modified":0,"renderable":0},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_RtiUPlWbme.png","slug":"image_RtiUPlWbme.png","post":"cm7a4vg3t00248gjd9tum3v6h","modified":0,"renderable":0},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_SOZXE0ImbY.png","slug":"image_SOZXE0ImbY.png","post":"cm7a4vg3t00248gjd9tum3v6h","modified":0,"renderable":0},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_tMLd_Cap6a.png","slug":"image_tMLd_Cap6a.png","post":"cm7a4vg3t00248gjd9tum3v6h","modified":0,"renderable":0},{"_id":"source\\_posts\\分享\\学习it网站推荐\\image_zZOb0Uu1MN.png","slug":"image_zZOb0Uu1MN.png","post":"cm7a4vg3t00248gjd9tum3v6h","modified":0,"renderable":0}],"PostCategory":[{"post_id":"cm7a4vg3g00088gjd2gtf1mly","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3i000f8gjdg037g4po"},{"post_id":"cm7a4vg3b00018gjda45v8l4v","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3k000j8gjd9jhc6y05"},{"post_id":"cm7a4vg3h00098gjd9bayeq03","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3k000m8gjd0rry3cr4"},{"post_id":"cm7a4vg3h000d8gjdcj5neqao","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3l000p8gjd9ptjf9aq"},{"post_id":"cm7a4vg3d00038gjddnru1t6w","category_id":"cm7a4vg3h000a8gjd3voefj9i","_id":"cm7a4vg3m000s8gjd6yxne37v"},{"post_id":"cm7a4vg3i000e8gjd70apegn2","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3m000v8gjd38bufo54"},{"post_id":"cm7a4vg3j000i8gjdgn1ka85m","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3n000z8gjdh0s17bb8"},{"post_id":"cm7a4vg3g00078gjd1f662wrg","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3n00118gjdbtxi9xni"},{"post_id":"cm7a4vg3k000l8gjdhmb47yos","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3o00168gjdamuahwpo"},{"post_id":"cm7a4vg3l000o8gjd6zpp3uay","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3o00188gjdf82yg8r4"},{"post_id":"cm7a4vg3m000u8gjdd1n224xz","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7a4vg3p001a8gjd6jzpfrv3"},{"post_id":"cm7a4vg3l000r8gjdd7n25r41","category_id":"cm7a4vg3m000x8gjd72fv3rf5","_id":"cm7a4vg3p001d8gjd4h169z0l"},{"post_id":"cm7a4vg3n000y8gjd8inehu90","category_id":"cm7a4vg3o00158gjd63c26pva","_id":"cm7a4vg3p001f8gjdf42w4ja6"},{"post_id":"cm7a4vg3n00108gjd2qeggfk5","category_id":"cm7a4vg3p001c8gjd06e2bmte","_id":"cm7a4vg3q001k8gjd92theb5t"},{"post_id":"cm7a4vg3o00148gjd872m7uzz","category_id":"cm7a4vg3p001c8gjd06e2bmte","_id":"cm7a4vg3r001n8gjdgvy4e5wf"},{"post_id":"cm7a4vg3o00178gjd1p7p6ny6","category_id":"cm7a4vg3q001j8gjdhjcm7m4z","_id":"cm7a4vg3r001q8gjdfrsefkya"},{"post_id":"cm7a4vg3t00238gjd2p3x1h26","category_id":"cm7a4vg3u00258gjd73fqfv6b","_id":"cm7a4vg3v002c8gjd779zgumg"},{"post_id":"cm7a4vg3t00248gjd9tum3v6h","category_id":"cm7a4vg3v00298gjd4qfxd6s7","_id":"cm7a4vg3w002g8gjd8b6s7jjo"},{"post_id":"cm7a4vg3u00278gjdg1mwg5i3","category_id":"cm7a4vg3v002d8gjd0nuw8psq","_id":"cm7a4vg3w002k8gjd5la290hm"},{"post_id":"cm7a4vg3v00288gjdgmjcd68z","category_id":"cm7a4vg3w002h8gjda7ds706c","_id":"cm7a4vg3w002m8gjd0lxc0oxf"},{"post_id":"cm7e5cdy900031gjdbypv7qk6","category_id":"cm7a4vg3q001j8gjdhjcm7m4z","_id":"cm7e5cdyb00071gjd26c88472"},{"post_id":"cm7e5cdy900041gjd2mjr4fj9","category_id":"cm7a4vg3e00048gjd06hy2h43","_id":"cm7e5cdyb00081gjd3a44efbl"},{"post_id":"cm7e5cdy400001gjd96tu8p26","category_id":"cm7e5cdy600011gjdb312c8y3","_id":"cm7e5cdyb000a1gjde51qayv7"}],"PostTag":[{"post_id":"cm7a4vg3b00018gjda45v8l4v","tag_id":"cm7a4vg3f00058gjd7j80b5h5","_id":"cm7a4vg3h000c8gjd932102ow"},{"post_id":"cm7a4vg3d00038gjddnru1t6w","tag_id":"cm7a4vg3h000b8gjdgyv64pgn","_id":"cm7a4vg3k000k8gjd43ug3auk"},{"post_id":"cm7a4vg3g00078gjd1f662wrg","tag_id":"cm7a4vg3i000h8gjd4y3g11th","_id":"cm7a4vg3l000q8gjd3mw8fupe"},{"post_id":"cm7a4vg3g00088gjd2gtf1mly","tag_id":"cm7a4vg3l000n8gjdcxp6ehv1","_id":"cm7a4vg3m000w8gjd75vwdpq5"},{"post_id":"cm7a4vg3h00098gjd9bayeq03","tag_id":"cm7a4vg3m000t8gjdcsuicjin","_id":"cm7a4vg3n00138gjdb1hk31gd"},{"post_id":"cm7a4vg3h000d8gjdcj5neqao","tag_id":"cm7a4vg3n00128gjd172xhuo5","_id":"cm7a4vg3p001b8gjd29wvc1st"},{"post_id":"cm7a4vg3i000e8gjd70apegn2","tag_id":"cm7a4vg3o00198gjd5pio449o","_id":"cm7a4vg3p001g8gjdde5r8g4k"},{"post_id":"cm7a4vg3j000i8gjdgn1ka85m","tag_id":"cm7a4vg3p001e8gjd2o204p80","_id":"cm7a4vg3q001l8gjde93f53ar"},{"post_id":"cm7a4vg3k000l8gjdhmb47yos","tag_id":"cm7a4vg3p001i8gjd7jrkd6nb","_id":"cm7a4vg3r001o8gjddtfi3kyr"},{"post_id":"cm7a4vg3l000o8gjd6zpp3uay","tag_id":"cm7a4vg3n00128gjd172xhuo5","_id":"cm7a4vg3r001r8gjd12vs8tmd"},{"post_id":"cm7a4vg3l000r8gjdd7n25r41","tag_id":"cm7a4vg3r001p8gjd6wz924fd","_id":"cm7a4vg3r001t8gjd38pdaysu"},{"post_id":"cm7a4vg3m000u8gjdd1n224xz","tag_id":"cm7a4vg3p001i8gjd7jrkd6nb","_id":"cm7a4vg3r001v8gjdg4lp83wb"},{"post_id":"cm7a4vg3n000y8gjd8inehu90","tag_id":"cm7a4vg3r001u8gjdd8wa0jh8","_id":"cm7a4vg3r001x8gjd85zs2i24"},{"post_id":"cm7a4vg3n00108gjd2qeggfk5","tag_id":"cm7a4vg3r001w8gjd37qg9boi","_id":"cm7a4vg3s001z8gjd18gedgkv"},{"post_id":"cm7a4vg3o00148gjd872m7uzz","tag_id":"cm7a4vg3r001y8gjd7uo561ri","_id":"cm7a4vg3s00218gjdgjyvgcyz"},{"post_id":"cm7a4vg3o00178gjd1p7p6ny6","tag_id":"cm7a4vg3s00208gjddsqt7srq","_id":"cm7a4vg3s00228gjd25nj480i"},{"post_id":"cm7a4vg3t00238gjd2p3x1h26","tag_id":"cm7a4vg3u00268gjd222o2v6j","_id":"cm7a4vg3v002b8gjd4ueibmny"},{"post_id":"cm7a4vg3t00248gjd9tum3v6h","tag_id":"cm7a4vg3v002a8gjd2jrx4i7h","_id":"cm7a4vg3w002f8gjd716dfaqz"},{"post_id":"cm7a4vg3u00278gjdg1mwg5i3","tag_id":"cm7a4vg3w002e8gjdbdvq4ee7","_id":"cm7a4vg3w002j8gjd1ost2lna"},{"post_id":"cm7a4vg3v00288gjdgmjcd68z","tag_id":"cm7a4vg3w002i8gjd7zdp4l0q","_id":"cm7a4vg3w002l8gjdem1xed16"},{"post_id":"cm7e5cdy400001gjd96tu8p26","tag_id":"cm7e5cdy800021gjdar898gq0","_id":"cm7e5cdyb00061gjd5ylxan4x"},{"post_id":"cm7e5cdy900031gjdbypv7qk6","tag_id":"cm7e5cdya00051gjd0e4n8uy0","_id":"cm7e5cdyb000b1gjd8qtec9qx"},{"post_id":"cm7e5cdy900041gjd2mjr4fj9","tag_id":"cm7e5cdyb00091gjd7aj16rqu","_id":"cm7e5cdyb000c1gjddcfvgufd"}],"Tag":[{"name":"docker","_id":"cm7a4vg3f00058gjd7j80b5h5"},{"name":"并发","_id":"cm7a4vg3h000b8gjdgyv64pgn"},{"name":"git","_id":"cm7a4vg3i000h8gjd4y3g11th"},{"name":"报警","_id":"cm7a4vg3l000n8gjdcxp6ehv1"},{"name":"查找进程","_id":"cm7a4vg3m000t8gjdcsuicjin"},{"name":"openvpn","_id":"cm7a4vg3n00128gjd172xhuo5"},{"name":"网络","_id":"cm7a4vg3o00198gjd5pio449o"},{"name":"nginx","_id":"cm7a4vg3p001e8gjd2o204p80"},{"name":"扩容磁盘","_id":"cm7a4vg3p001i8gjd7jrkd6nb"},{"name":"翻墙","_id":"cm7a4vg3r001p8gjd6wz924fd"},{"name":"lua表达式","_id":"cm7a4vg3r001u8gjdd8wa0jh8"},{"name":"状态机","_id":"cm7a4vg3r001w8gjd37qg9boi"},{"name":"打印异常日志","_id":"cm7a4vg3r001y8gjd7uo561ri"},{"name":"事务","_id":"cm7a4vg3s00208gjddsqt7srq"},{"name":"账户资金","_id":"cm7a4vg3u00268gjd222o2v6j"},{"name":"网站资源","_id":"cm7a4vg3v002a8gjd2jrx4i7h"},{"name":"自学公式","_id":"cm7a4vg3w002e8gjdbdvq4ee7"},{"name":"漏洞","_id":"cm7a4vg3w002i8gjd7zdp4l0q"},{"name":"命令","_id":"cm7e5cdy800021gjdar898gq0"},{"name":"备份","_id":"cm7e5cdya00051gjd0e4n8uy0"},{"name":"常用命令","_id":"cm7e5cdyb00091gjd7aj16rqu"}]}}